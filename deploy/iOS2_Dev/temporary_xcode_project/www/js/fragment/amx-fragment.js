(function(){var a=adf.mf.api.amx.TypeHandler.register(adf.mf.api.amx.AmxTag.NAMESPACE_AMX,"fragment");a.prototype.render=function(a){var c=document.createElement("div");c.className="amx-fragment";for(var a=a.renderDescendants(),d=0,e=a.length;d<e;++d)c.appendChild(a[d]);return c};a.prototype.createChildrenNodes=function(a){null==a.getAttribute("src")?a.setState(null==a.getAttributeExpression("src")?adf.mf.api.amx.AmxNodeStates.UNRENDERED:adf.mf.api.amx.AmxNodeStates.INITIAL):this._createChildrenFromFragment(a);
return!0};a.prototype.updateChildren=function(a,c){if(c.hasChanged("src"))return adf.mf.api.amx.AmxNodeChangeResult.REPLACE;if(c.hasChanged("_facetsToBeCreated")){var d=a.isRendered();this._createFacets(a,d);if(d&&1==c.getSize())return adf.mf.api.amx.AmxNodeChangeResult.NONE}return adf.mf.api.amx.AmxNodeChangeResult.RERENDER};a.prototype.visitChildren=function(a,c,d){var e=this._getFragmentUri(a),g=!1;null==this._fragmentStack?(this._fragmentStack=[e],g=!0):this._fragmentStack.push(e);try{if(a.visitStampedChildren(null,
null,null,c,d))return!0}finally{g?delete this._fragmentStack:this._fragmentStack.pop()}e=a.getAttribute("_facetVisitData");if(null!=e)for(var g=0,h=e.length;g<h;++g){var k=e[g],m=k.name,n=k.attributes,k=k.key;this._setupFacetContext(n);try{if(a.visitStampedChildren(k,[m],null,c,d))return!0}finally{this._tearDownFacetContext(n)}}return!1};a.prototype.__removeFacet=function(a,c){for(var d=c.getAttribute("facetName"),e=a.getAttribute("_facetVisitData"),g=c.getId(),d=a.getChildren(d,g),h=d.length-1;0<=
h;--h)if(a.removeChild(d[h]),null!=e)for(var k=0,m=e.length;k<m;++k)if(e[k].key==g){e.splice(k,1);break}};a.prototype._setupFacetContext=function(a){if(null!=a)for(var c=0,d=a.length;c<d;++c){var e=a[c];adf.mf.api.pushVariable(e.name,e.value)}};a.prototype._tearDownFacetContext=function(a){if(null!=a)for(var c=0,d=a.length;c<d;++c)adf.mf.api.popVariable(a[c].name)};a.prototype._getFragmentUri=function(a){var c=a.getAttribute("_uri");if(null==c&&(c=a.getAttribute("src"),null!=c))if(null==this._fragmentStack||
"/"==c[0])c=adf.mf.api.amx.buildRelativePath(c);else{var d=this._fragmentStack[this._fragmentStack.length-1],e=d.lastIndexOf("/");0<=e&&(c=d.substring(0,e)+"/"+c)}a.setAttributeResolvedValue("_uri",c);return c};a.prototype._createChildrenFromFragment=function(a){var c=this._getFragmentUri(a);if(null==c)a.setState(adf.mf.api.amx.AmxNodeStates.UNRENDERED);else{var d=this._fragmentStack;if(d)if(adf.mf.environment.profile.dtMode){if(0<=d.indexOf(c))return a.setState(adf.mf.api.amx.AmxNodeStates.UNRENDERED),
!0}else if(d.length>=(adf.mf.api.amx.fragmentRecursionLimit||25)&&0<=d.indexOf(c))return a.setState(adf.mf.api.amx.AmxNodeStates.UNRENDERED),adf.mf.internal.amx.errorHandlerImpl(null,Error(adf.mf.resource.getInfoString("AMXErrorBundle","ERROR_FRAGMENT_RECURSIVE_LOOP"))),adf.mf.log.logInfoResource("AMXInfoBundle",adf.mf.log.level.SEVERE,"fragmentHandler.prototype._createChildrenFromFragment","amx_fragment_RECURSION",a.getId(),c),!0;c=adf.mf.internal.amx.__getAmxTagForPage(c);if("resolved"==c.state())return this._handleLoadedFragment(a,
c),!0;"rejected"==c.state()?a.setState(adf.mf.api.amx.AmxNodeStates.INITIAL):this._loadFragment(a,c);return!1}};a.prototype._handleLoadedFragment=function(a,c){if(a.getState()==adf.mf.api.amx.AmxNodeStates.WAITING_ON_EL_EVALUATION)a.setState(adf.mf.api.amx.AmxNodeStates.INITIAL);else{var d=this;c.done(function(c){d._fragmentLoaded(a,c)})}};a.prototype._loadFragment=function(a,c){a.setState(adf.mf.api.amx.AmxNodeStates.INITIAL);adf.mf.api.amx.showLoadingIndicator();c.done(function(){try{var c=new adf.mf.internal.amx.AmxNodeUpdateArguments;
c.setAffectedAttribute(a,"_fragmentLoaded");adf.mf.api.amx.markNodeForUpdate(c)}finally{adf.mf.api.amx.hideLoadingIndicator()}}).fail(function(c,e){adf.mf.log.logInfoResource("AMXInfoBundle",adf.mf.log.level.SEVERE,"amx-fragment._loadFragment","MSG_ERROR_IN_SCRIPT","amx-fragment._loadFragment","Error loading fragment '"+a.getAttribute("src")+"': "+c);e instanceof Error&&adf.mf.internal.amx.errorHandlerImpl(null,e);adf.mf.api.amx.hideLoadingIndicator()})};a.prototype._fragmentLoaded=function(a,c){var d=
c.buildAmxNode(a,null);a.addChild(d)};a.prototype._createFacets=function(a,c){var d=a.getAttribute("_facetsToBeCreated");a.setAttributeResolvedValue("_facetsToBeCreated",null);var e=a.getAttribute("_facetVisitData");null==e&&(e=[],a.setAttributeResolvedValue("_facetVisitData",e));for(var g=c?new adf.mf.internal.amx.AmxNodeUpdateArguments:null,h=0,k=d.length;h<k;++h){var m=d[h],n=m.getAttribute("facetName"),o=m.getId();e.push({key:o,name:n,attributes:m.getAttribute("_attributeData")});for(var n=a.createStampedChildren(o,
[n]),o=0,s=n.length;o<s;++o)n[o].__setRenderingParent(m);c&&0<n.length&&g.setAffectedAttribute(m,"_facetCreated");m.setState(adf.mf.api.amx.AmxNodeStates.ABLE_TO_RENDER)}c&&0<g.getAffectedNodes().length&&adf.mf.api.amx.markNodeForUpdate(g)}})();