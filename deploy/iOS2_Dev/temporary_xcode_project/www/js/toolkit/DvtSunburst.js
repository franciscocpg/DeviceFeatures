var DvtSunburstRotationEvent=function(a,b){this.Init(!1===b?DvtSunburstRotationEvent.TYPE_INPUT:DvtSunburstRotationEvent.TYPE);this._startAngle=a};DvtObj.createSubclass(DvtSunburstRotationEvent,DvtBaseComponentEvent,"DvtSunburstRotationEvent");DvtSunburstRotationEvent.TYPE="sunburstRotation";DvtSunburstRotationEvent.TYPE_INPUT="sunburstRotationInput";DvtSunburstRotationEvent.prototype.getStartAngle=function(){return this._startAngle};var DvtBaseSunburst=function(a,b,c){this.Init(a,b,c)};
DvtObj.createSubclass(DvtBaseSunburst,DvtBaseTreeView,"DvtBaseSunburst");DvtBaseSunburst._ROTATION_SHAPE_RADIUS=15;DvtBaseSunburst._ROTATION_SHAPE_RADIUS_TOUCH=60;DvtBaseSunburst._ANIMATION_TYPE_FAN="fan";DvtBaseSunburst._BACKGROUND_INLINE_DEFAULT="";DvtBaseSunburst._BUFFER_SPACE=3;DvtBaseSunburst._MIN_BUFFER_SPACE=2;DvtBaseSunburst.prototype.Init=function(a,b,c){DvtBaseSunburst.superclass.Init.call(this,a,b,c);this.Defaults=new DvtSunburstDefaults;this._angleExtent=2*Math.PI};
DvtBaseSunburst.prototype.Parse=function(a){return(new DvtSunburstParser(this)).parse(a)};DvtBaseSunburst.prototype.ApplyParsedProperties=function(a){DvtBaseSunburst.superclass.ApplyParsedProperties.call(this,a);this._rotation=a.rotation;this._rotateCursor=DvtAgent.isPlatformIE()?"url("+this.__getResources().cursorRotate+"), auto":"url("+this.__getResources().cursorRotate+") 8 8, auto";this._startAngle=(360-a.startAngle)*DvtSunburstNode.TWO_PI/360;this._startAngle>Math.PI&&(this._startAngle-=DvtSunburstNode.TWO_PI)};
DvtBaseSunburst.prototype.Layout=function(a){var b=Math.max(Math.ceil(DvtBaseSunburst._BUFFER_SPACE*Math.min(a.w,a.h)/400),DvtBaseSunburst._MIN_BUFFER_SPACE);a.x+=b;a.y+=b;a.w-=2*b;a.h-=2*b;this.LayoutBreadcrumbs(a);this.LayoutLegend(a);this._totalRadius=Math.floor(Math.min(a.w,a.h)/2);this._root&&DvtSunburstLayout.layout(this._totalRadius,this._root,this._startAngle,this._angleExtent,this.Sorting)};
DvtBaseSunburst.prototype.Render=function(a,b){this.RenderBackground(a,DvtBaseSunburst._BACKGROUND_INLINE_DEFAULT);this.RenderBreadcrumbs(a);this.RenderLegend(a);this._translatePt=new DvtPoint(b.x+b.w/2,b.y+b.h/2);if(this.__isRotationEnabled()&&this.HasValidData()){var c=DvtAgent.isTouchDevice()?DvtBaseSunburst._ROTATION_SHAPE_RADIUS_TOUCH:DvtBaseSunburst._ROTATION_SHAPE_RADIUS,c=new DvtCircle(this.getCtx(),b.x+b.w/2,b.y+b.h/2,this._totalRadius+c);c.setInvisibleFill();c.setCursor(this._rotateCursor);
a.addChild(c);this.__getEventManager().associate(c,new DvtBaseTreePeer(null,DvtSunburstEventManager.ROTATION_ID))}c=new DvtContainer(this.getCtx());c.setTranslate(this._translatePt.x,this._translatePt.y);a.addChild(c);if(this.HasValidData()){var d=new DvtContainer(this.getCtx());c.addChild(d);this._root.render(d);this._selectedLayer=new DvtContainer(this.getCtx());c.addChild(this._selectedLayer);this._hoverLayer=new DvtContainer(this.getCtx());c.addChild(this._hoverLayer)}else this.RenderEmptyText(a)};
DvtBaseSunburst.prototype.CreateEventManager=function(a,b,c,d){return new DvtSunburstEventManager(a,b,c,d)};
DvtBaseSunburst.prototype.GetDisplayAnimation=function(a,b){if(this.AnimationOnDisplay===DvtBaseSunburst._ANIMATION_TYPE_FAN&&this.HasValidData()){this._animateAngleExtent(0);var c=new DvtCustomAnimation(this.getCtx(),this,this.AnimationDuration);c.getAnimator().addProp(DvtAnimator.TYPE_NUMBER,this,this._getAngleExtent,this._animateAngleExtent,2*Math.PI);return c}return DvtBaseSunburst.superclass.GetDisplayAnimation.call(this,a,b)};
DvtBaseSunburst.prototype.GetDeleteContainer=function(){var a=DvtBaseSunburst.superclass.GetDeleteContainer.call(this);a&&a.setTranslate(this._translatePt.x,this._translatePt.y);return a};
DvtBaseSunburst.prototype.OnAnimationEnd=function(){if(!this.AnimationStopped){this._container.removeChildren();var a=new DvtRectangle(0,0,this.Width,this.Height);this.Layout(a);this.Render(this._container,a);for(var a=this._selectionHandler?this._selectionHandler.getSelection():[],b=0;b<a.length;b++)a[b].setSelected(!0)}this._angleExtent<2*Math.PI&&this._animateAngleExtent(2*Math.PI);DvtBaseSunburst.superclass.OnAnimationEnd.call(this)};DvtBaseSunburst.prototype.__moveToHoverLayer=function(a){this._hoverLayer.addChild(a)};
DvtBaseSunburst.prototype.__moveToSelectedLayer=function(a){this._selectedLayer.addChild(a);DvtAgent.isBrowserSafari()||(this._selectedLayer.removeAllDrawEffects(),this._selectedLayer.addDrawEffect(DvtBaseTreeNode.__NODE_SELECTED_SHADOW))};DvtBaseSunburst.prototype._getAngleExtent=function(){return this._angleExtent};DvtBaseSunburst.prototype._animateAngleExtent=function(a){this._angleExtent=a;this.Layout(new DvtRectangle(0,0,this.Width,this.Height));this._root&&this._root.updateShapes(!0)};
DvtBaseSunburst.prototype.__startRotation=function(a,b){this.__setRotationAnchor(this._calcAngle(a,b))};DvtBaseSunburst.prototype.__setRotationAnchor=function(a){this._currentAngle=a;this._rotationMask=new DvtRect(this.getCtx(),0,0,this.Width,this.Height);this._rotationMask.setInvisibleFill();this._rotationMask.setCursor(this._rotateCursor);this.addChild(this._rotationMask);this.__getEventManager().associate(this._rotationMask,new DvtBaseTreePeer(null,DvtSunburstEventManager.ROTATION_ID))};
DvtBaseSunburst.prototype.__continueRotation=function(a,b){this.__rotate(this._calcAngle(a,b))};DvtBaseSunburst.prototype.__rotate=function(a){var b=a-this._currentAngle;this._currentAngle=a;this._updateStartAngle(b);a=360-Math.round(180*this._startAngle/Math.PI);this.__dispatchEvent(new DvtSunburstRotationEvent(a,!1))};
DvtBaseSunburst.prototype.__endRotation=function(){this._currentAngle=null;this.removeChild(this._rotationMask);this._rotationMask=null;var a=360-Math.round(180*this._startAngle/Math.PI);this.__dispatchEvent(new DvtSunburstRotationEvent(a,!1));this.__dispatchEvent(new DvtSunburstRotationEvent(a,!0))};
DvtBaseSunburst.prototype.__expandCollapseNode=function(a,b){this.__setNavigableIdToFocus(a.getId());b?this.__dispatchEvent(new DvtSunburstExpandCollapseEvent(DvtSunburstExpandCollapseEvent.TYPE_EXPAND,a.getId())):(this.render(DvtBaseTreeParser.applyDisclosure(this.LastXml,a.getId(),!1),this.Width,this.Height),this.__dispatchEvent(new DvtSunburstExpandCollapseEvent(DvtSunburstExpandCollapseEvent.TYPE_COLLAPSE,a.getId())))};
DvtBaseSunburst.prototype._calcAngle=function(a,b){return Math.atan2(b-this._translatePt.y,a-this._translatePt.x)};DvtBaseSunburst.prototype._updateStartAngle=function(a){this._startAngle+=a;this._startAngle<-Math.PI?this._startAngle+=2*Math.PI:this._startAngle>Math.PI&&(this._startAngle-=2*Math.PI);this.Layout(new DvtRectangle(0,0,this.Width,this.Height));this._root&&this._root.updateShapes(!0)};
DvtBaseSunburst.prototype.__getNodeUnderPoint=function(a,b){return this._root.getNodeUnderPoint(a-this._translatePt.x,b-this._translatePt.y)};DvtBaseSunburst.prototype.__showDropSiteFeedback=function(a){(a=DvtBaseSunburst.superclass.__showDropSiteFeedback.call(this,a))&&a.setTranslate(this._translatePt.x,this._translatePt.y);return a};DvtBaseSunburst.prototype.__isRotationEnabled=function(){return"on"==this._rotation};
DvtBaseSunburst.prototype.getShapesForViewSwitcher=function(a){var b={};if(this._root)for(var c=[this._root];0<c.length;){var d=c.splice(0,1)[0],e=d.getId(),g=d.getDisplayable();if(e&&g&&(b[e]=g,b[e+"_text"]=d._text,a&&(e=g.getParent())))g=e.getChildIndex(g),e.addChildAt(d._text,g+1);(d=d.getChildNodes())&&(c=c.concat(d))}return b};var DvtSunburst=function(){};DvtObj.createSubclass(DvtSunburst,DvtBaseSunburst,"DvtSunburst");
DvtSunburst.newInstance=function(a,b,c){var d=new DvtSunburst;d.Init(a,b,c);return d};DvtSunburst.getDefaults=function(a){return(new DvtSunburstDefaults).getDefaults(a)};
DvtSunburst.prototype.render=function(a,b,c){a?(this.Options=this.Defaults.calcOptions(a),DvtAgent.isEnvironmentBrowser()||(this.Options.animationOnDisplay="none",this.Options.animationOnDataChange="none")):this.Options||(this.Options=this.GetDefaults());a=(new DvtSunburstJsonUtils).toXml(this.Options);DvtSunburst.superclass.render.call(this,a,b,c)};var DvtSunburstParser=function(a){this.Init(a)};DvtObj.createSubclass(DvtSunburstParser,DvtBaseTreeParser,"DvtSunburstParser");
DvtSunburstParser.ATTR_ROTATION="r";DvtSunburstParser.ATTR_START_ANGLE="sa";DvtSunburstParser.ATTR_LABEL_H_ALIGN="ha";DvtSunburstParser.ATTR_RADIUS="r";DvtSunburstParser.prototype.CreateNode=function(a,b,c){return new DvtSunburstNode(a,b,c)};
DvtSunburstParser.prototype.ParseRootAttributes=function(a){var b=DvtSunburstParser.superclass.ParseRootAttributes.call(this,a);b.rotation=a.getAttr(DvtSunburstParser.ATTR_ROTATION);b.startAngle=a.getAttr(DvtSunburstParser.ATTR_START_ANGLE);if(null===b.startAngle||isNaN(b.startAngle))b.startAngle=90;return b};
DvtSunburstParser.prototype.ParseNodeAttributes=function(a){var b=DvtSunburstParser.superclass.ParseNodeAttributes.call(this,a);b.labelHalign=a.getAttr(DvtSunburstParser.ATTR_LABEL_H_ALIGN);b.radius=a.getAttr(DvtSunburstParser.ATTR_RADIUS);return b};
DvtSunburstParser.prototype.ParseAdditionalNodeStyles=function(a,b,c,d){d[DvtSunburstNode.NODE_DEFAULT_COLOR_STYLE]=a.getStyle("border-color");d[DvtSunburstNode.NODE_HOVER_COLOR_STYLE]=b.getStyle("border-color");d[DvtSunburstNode.NODE_SELECTED_INNER_COLOR_STYLE]=c.getStyle("-tr-inner-color");d[DvtSunburstNode.NODE_SELECTED_OUTER_COLOR_STYLE]=c.getStyle("-tr-outer-color")};
var DvtSunburstNode=function(a,b,c){this.Init(a,b,c);this._labelDisplay=b.labelDisplay?b.labelDisplay:"auto";this._labelHalign=b.labelHalign;this._radius=b.radius};DvtObj.createSubclass(DvtSunburstNode,DvtBaseTreeNode,"DvtSunburstNode");DvtSunburstNode.LABEL_ALIGN_START="s";DvtSunburstNode.LABEL_ALIGN_END="e";DvtSunburstNode._DEFAULT_NODE_STROKE_COLOR="#FFFFFF";DvtSunburstNode._NODE_SELECTED_INNER_STROKE_COLOR="#FFFFFF";DvtSunburstNode._NODE_SELECTED_OUTER_STROKE_COLOR="#000000";
DvtSunburstNode._NODE_HOVER_STROKE_COLOR="#FFFFFF";DvtSunburstNode.TEXT_BUFFER_HORIZ=6;DvtSunburstNode._EXPAND_ICON_SIZE=16;DvtSunburstNode.ROOT_NODE_MARGIN=2;DvtSunburstNode.TWO_PI=2*Math.PI;DvtSunburstNode.NODE_DEFAULT_COLOR_STYLE="NODE_DEFAULT_COLOR_STYLE";DvtSunburstNode.NODE_HOVER_COLOR_STYLE="NODE_HOVER_COLOR_STYLE";DvtSunburstNode.NODE_SELECTED_INNER_COLOR_STYLE="NODE_SELECTED_INNER_COLOR_STYLE";DvtSunburstNode.NODE_SELECTED_OUTER_COLOR_STYLE="NODE_SELECTED_OUTER_COLOR_STYLE";
DvtSunburstNode._CENTER_ARTIFICIAL_ROOT_RADIUS=0.25;DvtSunburstNode._CENTER_NODE_RADIUS=0.5;DvtSunburstNode._CENTER_WITH_CONTENT_RADIUS=1;
DvtSunburstNode.prototype.render=function(a){if(this._hasLayout){this._nodeContainer=a;this._shape=this._createShapeNode();a.addChild(this._shape);var b=this.GetTemplate();if(this._showRootContent()&&b){var c=Math.sqrt(2),d=this._outerRadius*c-2*DvtSunburstNode.ROOT_NODE_MARGIN;this._x=-this._outerRadius/c+DvtSunburstNode.ROOT_NODE_MARGIN;this._y=-this._outerRadius/c+DvtSunburstNode.ROOT_NODE_MARGIN;var c=this.GetElAttributes(),e=this.GetAfContext();e.setELContext(c);0<d&&0<d&&(e.setAvailableWidth(d),
e.setAvailableHeight(d),e.setFontSize(this.GetTextSize()),this._contentRoot=b=DvtAfComponentFactory.parseAndLayout(e,b,this._shape),c=b.getDimensions(),b.setTranslate(this._x+(d-c.w)/2,this._y+(d-c.h)/2))}else this._text=this._createTextNode(this._shape),null!=this._text&&(this._shape.addChild(this._text),this._pattern&&(c=this._text.measureDimensions(),this._textBackground=new DvtRect(this.getView().getCtx(),c.x,c.y,c.w,c.h),this._textBackground.setSolidFill("#FFFFFF"),this._textBackground.setMouseEnabled(!1),
this._shape.addChild(this._textBackground),d=this._text.getMatrix(),d.isIdentity()||this._textBackground.setMatrix(d),this._shape.addChild(this._text)));this._shape.setAriaRole("img");this._shape.setAriaProperty("label",this._datatip);this.renderChildren(a)}};
DvtSunburstNode.prototype.setSelected=function(a){"off"!=this.Selectable&&(DvtSunburstNode.superclass.setSelected.call(this,a),this.isSelected()?(this._shape.setSelected(!0),this.getView().__moveToSelectedLayer(this._shape)):(this._shape.setSelected(!1),this._nodeContainer&&this._nodeContainer.addChild(this._shape)))};
DvtSunburstNode.prototype.showHoverEffect=function(){this._shape&&this._hasLayout&&(this._shape.showHoverEffect(),this.isSelected()?this.getView().__moveToSelectedLayer(this._shape):this.getView().__moveToHoverLayer(this._shape))};DvtSunburstNode.prototype.hideHoverEffect=function(){this._shape&&this._hasLayout&&!this.isShowingKeyboardFocusEffect()&&(this._shape.hideHoverEffect(),!this.isSelected()&&this._nodeContainer&&this._nodeContainer.addChild(this._shape))};
DvtSunburstNode.prototype.isExpandCollapseEnabled=function(){return"i"==this._drilling||"ir"==this._drilling};
DvtSunburstNode.prototype.getNextNavigable=function(a){var b,c,d,e;if(a.type==DvtMouseEvent.CLICK)return DvtSunburstNode.superclass.getNextNavigable.call(this,a);b=a.keyCode;if(b==DvtKeyboardEvent.SPACE&&a.ctrlKey)return this;for(e=this;e.GetParent();)e=e.GetParent();c=this.GetNodesAtDepth(e,this.GetDepth());d=DvtSunburstNode._findNodeIndex(this,c);var g=this._startAngle+this._angleExtent/2,g=DvtSunburstNode._normalizedRadToDeg(g);switch(b){case DvtKeyboardEvent.UP_ARROW:if(this===e||180<g){if(b=
this.GetLastVisitedChild())if(c=b._startAngle+b._angleExtent/2,c=DvtSunburstNode._normalizedRadToDeg(c),180<c)return b;a=DvtKeyboardHandler.getNextAdjacentNavigable(this,a,this.getDescendantNodes())}else a=this._navigateToParent();break;case DvtKeyboardEvent.DOWN_ARROW:if(this===e||0<=g&&180>=g){if(b=this.GetLastVisitedChild())if(c=b._startAngle+b._angleExtent/2,c=DvtSunburstNode._normalizedRadToDeg(c),0<=c&&180>=c)return b;a=DvtKeyboardHandler.getNextAdjacentNavigable(this,a,this.getDescendantNodes())}else a=
this._navigateToParent();break;case DvtKeyboardEvent.LEFT_ARROW:a=1==c.length?this:0==d?c[c.length-1]:c[d-1];break;case DvtKeyboardEvent.RIGHT_ARROW:a=1==c.length?this:d==c.length-1?c[0]:c[d+1];break;default:a=this}a.MarkAsLastVisitedChild();return a};DvtSunburstNode.prototype._navigateToParent=function(){var a=this.GetParent(),b;a?(b=a,a.MarkAsLastVisitedChild()):b=this;b.MarkAsLastVisitedChild();return b};
DvtSunburstNode._normalizedRadToDeg=function(a){a=DvtMath.radsToDegrees(a);0>a?a+=360:360<a&&(a-=360);return a};DvtSunburstNode.prototype.getKeyboardBoundingBox=function(){if(this._shape){var a=this._shape.getDimensions(),b=new DvtPoint(a.x,a.y),b=this._shape.localToStage(b);a.x=b.x;a.y=b.y;return a}return new DvtRectangle(0,0,0,0)};
DvtSunburstNode.prototype.getContextMenuLocation=function(){return this._shape.localToStage(DvtSunburstNode._calcPointOnArc(0.5*(this._outerRadius+this._innerRadius),this._startAngle+this._angleExtent/2))};DvtSunburstNode.prototype.setLayoutParams=function(a,b,c,d){this._innerRadius=a;this._outerRadius=b;this._startAngle=c;this._angleExtent=d;this._hasLayout=!0};DvtSunburstNode.prototype.GetFill=function(){return this.isArtificialRoot()?DvtSolidFill.invisibleFill():DvtSunburstNode.superclass.GetFill.call(this)};
DvtSunburstNode.prototype.GetAnimationParams=function(){var a=DvtColorUtils.getRed(this._color),b=DvtColorUtils.getGreen(this._color),c=DvtColorUtils.getBlue(this._color);return[this._innerRadius,this._outerRadius,this._startAngle,this._angleExtent,a,b,c]};DvtSunburstNode.prototype.SetAnimationParams=function(a){this.setLayoutParams(a[0],a[1],a[2],a[3]);var b=Math.round(a[4]),c=Math.round(a[5]),a=Math.round(a[6]);this._color=DvtColorUtils.makeRGB(b,c,a);this.updateShapes(!1)};
DvtSunburstNode.prototype.animateUpdate=function(a,b){b._hasLayout&&0<b._angleExtent?DvtSunburstNode.superclass.animateUpdate.call(this,a,b):this.animateInsert(a)};DvtSunburstNode.prototype.getNodeUnderPoint=function(a,b){if(this.contains(a,b))return this;for(var c=this.getChildNodes(),d=0;d<c.length;d++){var e=c[d].getNodeUnderPoint(a,b);if(e)return e}return null};
DvtSunburstNode.prototype.contains=function(a,b){var c=DvtSunburstNode._calcRadius(a,b),d=DvtSunburstNode._calcAngle(a,b);return this.ContainsRadius(c)&&this.ContainsAngle(d)};DvtSunburstNode.prototype.ContainsAngle=function(a){for(;a<this._startAngle;)a+=DvtSunburstNode.TWO_PI;for(;a-this._startAngle>DvtSunburstNode.TWO_PI;)a-=DvtSunburstNode.TWO_PI;return a>=this._startAngle&&a<=this._startAngle+this._angleExtent};
DvtSunburstNode.prototype.ContainsRadius=function(a){return a>=this._innerRadius&&a<=this._outerRadius};DvtSunburstNode._calcPointOnArc=function(a,b){var c=Math.cos(b)*a,d=Math.sin(b)*a;return{x:c,y:d}};DvtSunburstNode._containsRect=function(a,b){return b.contains(a.x,a.y)&&b.contains(a.x+a.w,a.y)&&b.contains(a.x+a.w,a.y+a.h)&&b.contains(a.x,a.y+a.h)};
DvtSunburstNode._calcAngle=function(a,b){var c=Math.atan2(b,a);0>c?c+=DvtSunburstNode.TWO_PI:c>DvtSunburstNode.TWO_PI&&(c-=DvtSunburstNode.TWO_PI);return c};DvtSunburstNode._calcRadius=function(a,b){return Math.sqrt(a*a+b*b)};
DvtSunburstNode.prototype._createShapeNode=function(){if(!this._angleExtent||0>=this._angleExtent)return null;var a=this._createPathCmd(),a=new DvtPath(this.getView().getCtx(),a);this.getView().__getEventManager().associate(a,this);a.setAlpha(this.getAlpha());a.setFill(this.GetFill());var b=this.getResolvedColor(DvtSunburstNode._DEFAULT_NODE_STROKE_COLOR,DvtSunburstNode.NODE_DEFAULT_COLOR_STYLE),c=this.getResolvedColor(DvtSunburstNode._NODE_SELECTED_INNER_STROKE_COLOR,DvtSunburstNode.NODE_SELECTED_INNER_COLOR_STYLE),
d=this.getResolvedColor(DvtSunburstNode._NODE_SELECTED_OUTER_STROKE_COLOR,DvtSunburstNode.NODE_SELECTED_OUTER_COLOR_STYLE),e=this.getResolvedColor(DvtSunburstNode._NODE_HOVER_STROKE_COLOR,DvtSunburstNode.NODE_HOVER_COLOR_STYLE);a.setStroke(new DvtSolidStroke(b,0.3));a.setHoverStroke(new DvtSolidStroke(e,1,3));a.setSelectedStroke(new DvtSolidStroke(c,1,1.5),new DvtSolidStroke(d,1,3.5));a.setSelectedHoverStroke(new DvtSolidStroke(e,1,3));a.setSelectable(null!=this.getView().__getNodeSelection()&&"off"!=
this.Selectable);this.isArtificialRoot()&&(a.setAlpha(0.0010),a.setMouseEnabled(!1));return a};
DvtSunburstNode.prototype._createPathCmd=function(){var a,b,c,d;this._angleExtent<DvtSunburstNode.TWO_PI?(a=DvtSunburstNode._calcPointOnArc(this._outerRadius,this._startAngle),b=DvtSunburstNode._calcPointOnArc(this._outerRadius,this._startAngle+this._angleExtent),c=DvtSunburstNode._calcPointOnArc(this._innerRadius,this._startAngle+this._angleExtent),d=DvtSunburstNode._calcPointOnArc(this._innerRadius,this._startAngle),a=DvtPathUtils.moveTo(a.x,a.y)+DvtPathUtils.arcTo(this._outerRadius,this._outerRadius,
this._angleExtent,1,b.x,b.y)+DvtPathUtils.lineTo(c.x,c.y)+DvtPathUtils.arcTo(this._innerRadius,this._innerRadius,this._angleExtent,0,d.x,d.y)+DvtPathUtils.closePath()):(a=DvtSunburstNode._calcPointOnArc(this._outerRadius,this._startAngle),b=DvtSunburstNode._calcPointOnArc(this._outerRadius,this._startAngle+this._angleExtent/2),c=DvtSunburstNode._calcPointOnArc(this._innerRadius,this._startAngle),d=DvtSunburstNode._calcPointOnArc(this._innerRadius,this._startAngle+this._angleExtent/2),a=DvtPathUtils.moveTo(a.x,
a.y)+DvtPathUtils.arcTo(this._outerRadius,this._outerRadius,this._angleExtent/2,1,b.x,b.y)+DvtPathUtils.arcTo(this._outerRadius,this._outerRadius,this._angleExtent/2,1,a.x,a.y),0<this._innerRadius&&(a+=DvtPathUtils.moveTo(d.x,d.y)+DvtPathUtils.arcTo(this._innerRadius,this._innerRadius,this._angleExtent/2,0,c.x,c.y)+DvtPathUtils.arcTo(this._innerRadius,this._innerRadius,this._angleExtent/2,0,d.x,d.y)),a+=DvtPathUtils.closePath());return a};
DvtSunburstNode.prototype._createExpandCollapseButton=function(a){if(!a||!this.isExpandCollapseEnabled())return null;var b=this._disclosed?this._getCollapseButton():this._getExpandButton(),c=DvtSunburstNode._calcPointOnArc(this._outerRadius,this._startAngle+this._angleExtent/2);b.setTranslate(c.x-DvtSunburstNode._EXPAND_ICON_SIZE/2,c.y-DvtSunburstNode._EXPAND_ICON_SIZE/2);a.addChild(b);a=this._disclosed?this.getView().__getResources().collapse:this.getView().__getResources().expand;this.getView().__getEventManager().associate(b,
new DvtBaseTreePeer(this,this.getId(),a));return b};DvtSunburstNode.prototype._createTextNode=function(a){if(!this._textStr||!a||!this._labelDisplay||"off"==this._labelDisplay)return null;var b=!1;"auto"==this._labelDisplay?b=!DvtAgent.isPlatformIE()&&DvtAgent.getOS()==DvtAgent.WINDOWS_OS?!1:!0:"rotated"==this._labelDisplay&&(b=!0);return b&&this._angleExtent<2*Math.PI?this._createTextRotated(a):this._createTextHoriz(a)};
DvtSunburstNode.prototype._createTextHoriz=function(a){var b;if(0==this._innerRadius)b={x:0,y:0};else{b=DvtSunburstNode._calcPointOnArc((this._innerRadius+this._outerRadius)/2,this._startAngle+this._angleExtent/2);var c=3*this.GetTextSize()/2,d=DvtSunburstNode._calcAngle(b.x-c/2,b.y),c=DvtSunburstNode._calcAngle(b.x+c/2,b.y);if(!this.ContainsAngle(d)||!this.ContainsAngle(c))b=null}if(b){d=new DvtOutputText(this.getView().getCtx(),this._textStr,b.x,b.y,null);d.setFontSize(this.GetTextSize());this.ApplyLabelTextStyle(d);
d.alignCenter();d.alignMiddle();d.setMouseEnabled(!1);for(var c=DvtTextUtils.guessTextDimensions(d),e=b.x,g=b.x,h=b.y-c.h/2,k=b.y+c.h/2;this.contains(e,h)&&this.contains(e,k);)e--;for(;this.contains(g,h)&&this.contains(g,k);)g++;e+=3;g-=3;b=2*Math.min(b.x-e,g-b.x);b<c.w&&(d.setX((e+g)/2),b=g-e);return DvtTextUtils.fitText(d,b,c.h,a)?d:null}};
DvtSunburstNode.prototype._createTextRotated=function(a){var b=Math.max(this._innerRadius,10),c=this._outerRadius-b-DvtSunburstNode.TEXT_BUFFER_HORIZ,d=1.1*this._angleExtent*(b+DvtSunburstNode.TEXT_BUFFER_HORIZ);if(6>=d)return null;var e=new DvtOutputText(this.getView().getCtx(),this._textStr,0,0);e.setFontSize(this.GetTextSize());this.ApplyLabelTextStyle(e);if(!DvtTextUtils.fitText(e,c,d,a))return null;d=(b+this._outerRadius)/2;if(this._labelHalign==DvtSunburstNode.LABEL_ALIGN_START||this._labelHalign==
DvtSunburstNode.LABEL_ALIGN_END){a.addChild(e);var a=e.getDimensions().w,g=0.75*DvtSunburstNode.TEXT_BUFFER_HORIZ;this._labelHalign==DvtSunburstNode.LABEL_ALIGN_START?d=b+g+a/2:this._labelHalign==DvtSunburstNode.LABEL_ALIGN_END&&(d=b+c-g-a/2)}b=DvtSunburstNode._calcPointOnArc(d,this._startAngle+this._angleExtent/2);e.alignCenter();e.alignMiddle();c=this._startAngle+this._angleExtent/2;c=c>=DvtSunburstNode.TWO_PI?c-DvtSunburstNode.TWO_PI:c;c=0>c?c+DvtSunburstNode.TWO_PI:c;c>0.5*Math.PI&&c<1.5*Math.PI&&
(c+=Math.PI);e.setRotation(c);e.setTranslate(b.x,b.y);e.setMouseEnabled(!1);return e};DvtSunburstNode._findNodeIndex=function(a,b){for(var c=0;c<b.length;c++)if(a===b[c])return c;return-1};DvtSunburstNode.prototype.handleMouseOver=function(){this._expandButton||(this._expandButton=this._createExpandCollapseButton(this._shape));DvtSunburstNode.superclass.handleMouseOver.call(this)};
DvtSunburstNode.prototype.handleMouseOut=function(){this._expandButton&&this._shape&&(this._shape.removeChild(this._expandButton),this._expandButton=null);DvtSunburstNode.superclass.handleMouseOut.call(this)};
DvtSunburstNode.prototype.updateShapes=function(a){if(this._shape&&(this._shape.setCmds(this._createPathCmd()),this._showRootContent()||(this._text&&this._shape.removeChild(this._text),this._text=this._createTextNode(this._shape),this._textBackground&&(this._shape.removeChild(this._textBackground),this._textBackground=null)),this._shape.setFill(this.GetFill()),a))for(var a=this.getChildNodes(),b=0;b<a.length;b++)a[b].updateShapes(!0)};
DvtSunburstNode.prototype.getDropSiteFeedback=function(){return this._shape instanceof DvtCircle?new DvtCircle(this.getView().getCtx(),this._shape.getCx(),this._shape.getCy(),this._shape.getRadius()):this._shape instanceof DvtPath?new DvtPath(this.getView().getCtx(),this._shape.getCmds()):null};
DvtSunburstNode.prototype._getExpandButton=function(){var a=this.getView().getCtx(),b=this.getView().__getResources(),c=new DvtImage(a,b.expandUp,0,0,DvtSunburstNode._EXPAND_ICON_SIZE,DvtSunburstNode._EXPAND_ICON_SIZE),d=new DvtImage(a,b.expandOver,0,0,DvtSunburstNode._EXPAND_ICON_SIZE,DvtSunburstNode._EXPAND_ICON_SIZE),b=new DvtImage(a,b.expandDown,0,0,DvtSunburstNode._EXPAND_ICON_SIZE,DvtSunburstNode._EXPAND_ICON_SIZE);c.setInvisibleFill();d.setInvisibleFill();b.setInvisibleFill();a=new DvtButton(a,
c,d,b);a.addEvtListener(DvtMouseEvent.CLICK,this.expandCollapseNode,!1,this);return a};
DvtSunburstNode.prototype._getCollapseButton=function(){var a=this.getView().getCtx(),b=this.getView().__getResources(),c=new DvtImage(a,b.collapseUp,0,0,DvtSunburstNode._EXPAND_ICON_SIZE,DvtSunburstNode._EXPAND_ICON_SIZE),d=new DvtImage(a,b.collapseOver,0,0,DvtSunburstNode._EXPAND_ICON_SIZE,DvtSunburstNode._EXPAND_ICON_SIZE),b=new DvtImage(a,b.collapseDown,0,0,DvtSunburstNode._EXPAND_ICON_SIZE,DvtSunburstNode._EXPAND_ICON_SIZE);c.setInvisibleFill();d.setInvisibleFill();b.setInvisibleFill();a=new DvtButton(a,
c,d,b);a.addEvtListener(DvtMouseEvent.CLICK,this.expandCollapseNode,!1,this);return a};DvtSunburstNode.prototype.expandCollapseNode=function(){this._disclosed=!this._disclosed;this.getView().__expandCollapseNode(this,this._disclosed)};DvtSunburstNode.prototype.isDisclosed=function(){return this._disclosed};DvtSunburstNode.prototype._showRootContent=function(){return!this._parent&&0==this._innerRadius&&this._angleExtent==DvtSunburstNode.TWO_PI};
DvtSunburstNode.prototype.hasRootContent=function(){return this.GetTemplate()?!0:!1};DvtSunburstNode.prototype.__getRadius=function(){return null!=this._radius?Number(this._radius):this.GetParent()?1:this.isArtificialRoot()?DvtSunburstNode._CENTER_ARTIFICIAL_ROOT_RADIUS:this.hasRootContent()?DvtSunburstNode._CENTER_WITH_CONTENT_RADIUS:DvtSunburstNode._CENTER_NODE_RADIUS};var DvtSunburstLayout={};DvtObj.createSubclass(DvtSunburstLayout,DvtObj,"DvtSunburstLayout");
DvtSunburstLayout.layout=function(a,b,c,d,e){var g=DvtSunburstLayout._calcLargestRadius(b);DvtSunburstLayout._layout(a/g,b,c,d,e,0)};
DvtSunburstLayout._layout=function(a,b,c,d,e,g){var h=g+b.__getRadius()*a;b.setLayoutParams(g,h,c,d);g=b.getChildNodes();if(null!=g&&b.isDisclosed()){e==DvtBaseTreeParser.SORTING_ON&&(g=g.slice(0),g.sort(function(a,b){return b.getSize()-a.getSize()}));DvtAgent.isRightToLeft(b.getView().getCtx())&&(g=g.slice(0).reverse());for(var k=0,b=0;b<g.length;b++)k+=0<g[b].getSize()?g[b].getSize():0;for(b=0;b<g.length;b++){var m=g[b];if(!(0>=m.getSize())){var n=m.getSize()/k*d;DvtSunburstLayout._layout(a,m,c,
n,e,h);c+=n}}}};DvtSunburstLayout._calcLargestRadius=function(a){var b=0,c=a.getChildNodes();if(c&&0<c.length){for(var d=0;d<c.length;d++)var e=DvtSunburstLayout._calcLargestRadius(c[d]),b=Math.max(b,e);return b+a.__getRadius()}return a.__getRadius()};var DvtSunburstExpandCollapseEvent=function(a,b){this.Init(a);this._id=b?b:null};DvtObj.createSubclass(DvtSunburstExpandCollapseEvent,DvtBaseComponentEvent,"DvtSunburstExpandCollapseEvent");DvtSunburstExpandCollapseEvent.TYPE_EXPAND="sunburstExpand";
DvtSunburstExpandCollapseEvent.TYPE_COLLAPSE="sunburstCollapse";DvtSunburstExpandCollapseEvent.prototype.getId=function(){return this._id};var DvtSunburstEventManager=function(a,b,c,d){DvtBaseTreeEventManager.call(this,a,b,c,d)};DvtObj.createSubclass(DvtSunburstEventManager,DvtBaseTreeEventManager,"DvtSunburstEventManager");DvtSunburstEventManager.ROTATION_ID="_rotationShape";
DvtSunburstEventManager.prototype.OnMouseDown=function(a){var b=this.GetLogicalObject(a.target);b&&b.getId&&b.getId()==DvtSunburstEventManager.ROTATION_ID&&!this._bRotating?(this._bRotating=!0,a=this._context.pageToStageCoords(a.pageX,a.pageY),this.GetView().__startRotation(a.x,a.y)):DvtSunburstEventManager.superclass.OnMouseDown.call(this,a)};
DvtSunburstEventManager.prototype.OnMouseMove=function(a){this._bRotating?(a=this._context.pageToStageCoords(a.pageX,a.pageY),this.GetView().__continueRotation(a.x,a.y)):DvtSunburstEventManager.superclass.OnMouseMove.call(this,a)};DvtSunburstEventManager.prototype.OnMouseUp=function(a){this._bRotating?(this._bRotating=!1,this.GetView().__endRotation()):DvtSunburstEventManager.superclass.OnMouseUp.call(this,a)};
DvtSunburstEventManager.prototype.ProcessKeyboardEvent=function(a){var b=!0,c=a.keyCode,d=this.getFocus(),e=this.GetView();d.isExpandCollapseEnabled()&&(DvtKeyboardEvent.isPlus(a)&&!d.isDisclosed()||DvtKeyboardEvent.isMinus(a)&&d.isDisclosed()||a.ctrlKey&&c==DvtKeyboardEvent.ENTER)?(d.expandCollapseNode(),a.preventDefault()):e&&e.__isRotationEnabled()&&(c==DvtKeyboardEvent.LEFT_ARROW||c==DvtKeyboardEvent.RIGHT_ARROW)&&!a.ctrlKey&&a.altKey&&a.shiftKey?(c=c==DvtKeyboardEvent.LEFT_ARROW?-5*(Math.PI/
180):5*(Math.PI/180),e.__setRotationAnchor(0),e.__rotate(c),e.__endRotation(),a.preventDefault()):b=DvtSunburstEventManager.superclass.ProcessKeyboardEvent.call(this,a);return b};DvtSunburstEventManager.ROTATE_KEY="rotateKey";
DvtSunburstEventManager.prototype.HandleImmediateTouchStartInternal=function(a){var b=this.GetLogicalObject(a.target);b&&b.getId&&b.getId()==DvtSunburstEventManager.ROTATION_ID&&this.TouchManager.processAssociatedTouchAttempt(a,DvtSunburstEventManager.ROTATE_KEY,this.RotateStartTouch,this)};DvtSunburstEventManager.prototype.HandleImmediateTouchMoveInternal=function(a){this.TouchManager.processAssociatedTouchMove(a,DvtSunburstEventManager.ROTATE_KEY)};
DvtSunburstEventManager.prototype.HandleImmediateTouchEndInternal=function(a){this.TouchManager.processAssociatedTouchEnd(a,DvtSunburstEventManager.ROTATE_KEY)};
DvtSunburstEventManager.prototype.RotateStartTouch=function(a,b){if(1>=this.TouchManager.getTouchIdsForObj(DvtSunburstEventManager.ROTATE_KEY).length){this.TouchManager.saveProcessedTouch(b.identifier,DvtSunburstEventManager.ROTATE_KEY,null,DvtSunburstEventManager.ROTATE_KEY,DvtSunburstEventManager.ROTATE_KEY,this.RotateMoveTouch,this.RotateEndTouch,this);this.TouchManager.setTooltipEnabled(b.identifier,!1);var c=this._context.pageToStageCoords(b.pageX,b.pageY);this.GetView().__startRotation(c.x,
c.y);a.blockTouchHold()}};DvtSunburstEventManager.prototype.RotateMoveTouch=function(a,b){var c=this._context.pageToStageCoords(b.pageX,b.pageY);this.GetView().__continueRotation(c.x,c.y);a.preventDefault()};DvtSunburstEventManager.prototype.RotateEndTouch=function(){this.GetView().__endRotation()};var DvtSunburstBundle=function(){};DvtObj.createSubclass(DvtSunburstBundle,DvtBundle,"DvtSunburstBundle");DvtSunburstBundle._defaults={COLOR:"Color",SIZE:"Size"};
DvtSunburstBundle.prototype.GetDefaultStringForKey=function(a){return DvtSunburstBundle._defaults[a]};DvtSunburstBundle.prototype.GetBundlePrefix=function(){return"DvtSunburstBundle"};var DvtSunburstDefaults=function(){this.Init({skyros:DvtSunburstDefaults.VERSION_1,alta:{}})};DvtObj.createSubclass(DvtSunburstDefaults,DvtBaseTreeDefaults,"DvtSunburstDefaults");DvtSunburstDefaults.VERSION_1={rotation:"on"};var DvtSunburstJsonUtils=function(){};
DvtObj.createSubclass(DvtSunburstJsonUtils,DvtBaseTreeJsonUtils,"DvtSunburstJsonUtils");DvtSunburstJsonUtils.prototype.GetComponentName=function(){return"sunburst"};DvtSunburstJsonUtils.prototype.WriteComponentAttributes=function(a){var b=DvtSunburstJsonUtils.superclass.WriteComponentAttributes.call(this,a),b=b+this.WriteAttr("r",a.rotation),b=b+this.WriteAttr("sa",(a.startAngle+360)%360),a=a.animationOnDisplay;return b="auto"==a?b+this.WriteAttr("adi","fan"):b+this.WriteAttr("adi",a)};
DvtSunburstJsonUtils.prototype.WriteNodeAttributes=function(a,b){var c=DvtSunburstJsonUtils.superclass.WriteNodeAttributes.call(this,a,b),c=c+this.WriteAttr("ld",b.labelDisplay?b.labelDisplay:a.nodeDefaults.labelDisplay),d=b.labelHalign?b.labelHalign:a.nodeDefaults.labelHalign;"inner"==d?c+=this.WriteAttr("ha","s"):"outer"==d&&(c+=this.WriteAttr("ha","e"));d=b.radius;null!=d&&!isNaN(d)&&(c+=this.WriteAttr(DvtSunburstParser.ATTR_RADIUS,d));return c};
DvtSunburstJsonUtils.prototype.WriteResourcesElement=function(a){var b="<resources",c=new DvtSunburstBundle,b=b+this.WriteAttr("legendSize",c.getTranslatedString("SIZE")),b=b+this.WriteAttr("legendColor",c.getTranslatedString("COLOR")),b=b+this.WriteAttr("cursorRotate",a._resources.rotateCursor),b=b+this.WriteAttr("alta","true");return b+"/>\n"};
DvtSunburstJsonUtils.prototype.WriteStyleElement=function(a){var b=DvtSunburstJsonUtils.superclass.WriteStyleElement.call(this,a),c=a.animationUpdateColor;c&&(b+=this.WriteAttr("top","-tr-animation-update-color: "+c));(c=a.nodeDefaults.borderColor)&&(b+=this.WriteAttr("node","border-color: "+c));(c=a.nodeDefaults.hoverColor)&&(b+=this.WriteAttr("node-hover","border-color: "+c));(a=a.nodeDefaults.selectedColor)&&(b+=this.WriteAttr("node-selected","border-color: "+a));return b+"/>\n"};