var DvtAmxThematicMap=function(a,b,c){this.Init(a,b,c)};DvtObj.createSubclass(DvtAmxThematicMap,DvtContainer,"DvtAmxThematicMap");DvtAmxThematicMap._LEGEND_COMPONET_GAP=10;DvtAmxThematicMap.prototype.Init=function(a,b,c){DvtAmxThematicMap.superclass.Init.call(this,a);this._tmap=new DvtThematicMap(a,b,c);this._tmapContainer=new DvtContainer(a);this._tmapContainer.addChild(this._tmap);this.addChild(this._tmapContainer);this.Defaults=new DvtThematicMapDefaults};
DvtAmxThematicMap.newInstance=function(a,b,c){return new DvtAmxThematicMap(a,b,c)};DvtAmxThematicMap.prototype.render=function(a,b,c){this.Options=this.Defaults.calcOptions(a);this._width=b;this._height=c;b=new DvtRectangle(0,0,b,c);this._renderLegend(this,b);this._tmap.render(a,b.w,b.h)};
DvtAmxThematicMap.prototype._renderLegend=function(a,b){this._legend&&(a.removeChild(this._legend),this._legend=null);var c=new DvtRectangle(DvtAmxThematicMap._LEGEND_COMPONET_GAP,DvtAmxThematicMap._LEGEND_COMPONET_GAP,b.w-2*DvtAmxThematicMap._LEGEND_COMPONET_GAP,b.h-2*DvtAmxThematicMap._LEGEND_COMPONET_GAP),d=this.Options,e=d.legend.rendered,g=d.legend.scrolling,h=DvtJSONUtils.clone(d.legend);this._addLegendData(this.Options,h);if(e&&!(h.sections&&0==h.sections.length)){e=d.legend.position;delete h.position;
h.layout.gapRatio=this.getGapRatio();h.hideAndShowBehavior="none";h.rolloverBehavior="none";h.scrolling=d.legend.scrolling;var k=DvtLegend.newInstance(this._tmap.getCtx(),null,null);null!=this._tmap.getId()&&k.setId(this._tmap.getId()+"legend");a.addChild(k);"auto"==e&&"asNeeded"!==g?e="bottom":"auto"==e&&"asNeeded"==g&&(e="end");g=DvtAgent.isRightToLeft(a.getCtx());"start"==e?e=g?"right":"left":"end"==e&&(e=g?"left":"right");h.orientation="left"==e||"right"==e?"vertical":"horizontal";g="top"==e||
"bottom"==e;g=k.getPreferredSize(h,g?c.w:d.layout.legendMaxSize*c.w,g?d.layout.legendMaxSize*c.h:c.h);if(0<g.w&&0<g.h)switch(k.render(h,g.w,g.h),this._legend=k,d=DvtThematicMapDefaults.getGapSize(this,d.layout.legendGap),DvtLayoutUtils.position(c,e,k,g.w,g.h,d),e){case "top":this._tmapContainer.setTranslateY(g.h+DvtAmxThematicMap._LEGEND_COMPONET_GAP);case "bottom":b.h-=g.h+DvtAmxThematicMap._LEGEND_COMPONET_GAP;break;case "left":this._tmapContainer.setTranslateX(g.w+DvtAmxThematicMap._LEGEND_COMPONET_GAP);
case "right":b.w-=g.w+DvtAmxThematicMap._LEGEND_COMPONET_GAP}}};DvtAmxThematicMap.prototype.getGapRatio=function(){if(null!==this.Options.layout.gapRatio&&!isNaN(this.Options.layout.gapRatio))return this.Options.layout.gapRatio;var a=Math.min(this._width/400,1),b=Math.min(this._height/300,1);return Math.min(a,b)};
DvtAmxThematicMap.prototype._addLegendData=function(a,b){b.title=a.legend?a.legend.title:null;b.sections=[];if(a&&a.legend&&a.legend.sections)for(var c=0;c<a.legend.sections.length;c++){var d=a.legend.sections[c];d&&b.sections.push({title:d.title,items:d.items,sections:d.sections})}return b};var DvtThematicMap=function(a,b,c){this.Init(a,b,c)};DvtObj.createSubclass(DvtThematicMap,DvtAbstractPanZoomComponent,"DvtThematicMap");DvtThematicMap._FEATURES_OFF_PAN=1;DvtThematicMap._FEATURES_OFF_ZOOM=2;
DvtThematicMap._FEATURES_OFF_PAN_ZOOM=3;DvtThematicMap._FEATURES_OFF_ZOOMTOFIT=4;DvtThematicMap._FEATURES_OFF_PAN_ZOOMTOFIT=5;DvtThematicMap._FEATURES_OFF_ZOOM_ZOOMTOFIT=6;DvtThematicMap._FEATURES_OFF_ALL=7;DvtThematicMap._COLLAPSIBLE_PANEL_OFFSET=5;DvtThematicMap._ELEM_RESOURCES_CONTROLPANEL="controlPanelResources";DvtThematicMap._ELEM_RESOURCES_LEGEND="legendResources";DvtThematicMap._ELEM_RESOURCES_PANEL_DRAWER="panelDrawerResources";DvtThematicMap.DEFAULT_MAX_ZOOM_FACTOR=6;
DvtThematicMap.prototype.Init=function(a,b,c){DvtThematicMap.superclass.Init.call(this,a);this._callback=b;this._callbackObj=c;this._createHandlers();this._layers=[];this._drillAnimFadeOutObjs=[];this._legendButtonImages=this._legendXml=this._legendPanel=this._legend=null;this._bBaseMapChanged=!1;this._drilledRowKeys=[];this._initDrilled={};this._processingInitDrilled=!1;this._drillDataLayer={};this._childToParent={};this._drilled=[];this._areaLayers=new DvtContainer(this.getCtx());this._dataAreaLayers=
new DvtContainer(this.getCtx());this._dataPointLayers=new DvtContainer(this.getCtx());this._labelLayers=new DvtContainer(this.getCtx());this._initialZooming=!1;this._panning=this._zooming=!0;this._maxZoomFactor=DvtThematicMap.DEFAULT_MAX_ZOOM_FACTOR;this._isMarkerZoomBehaviorFixed=!0;this._selectedAreas={};this.setDisplayedControls(DvtPanZoomControlPanel.CONTROLS_ALL);this.Defaults=new DvtThematicMapDefaults};DvtThematicMap.newInstance=function(a,b,c){return new DvtThematicMap(a,b,c)};
DvtThematicMap.prototype.SetOptions=function(a){this.Options=this.Defaults.calcOptions(a);DvtAgent.isEnvironmentBrowser()||(this.Options.animationOnDisplay="none",this.Options.animationOnMapChange="none",this.Options.animationOnDrill="none");this.Options.skin||(this.Options.skin="alta")};DvtThematicMap.prototype.setStyleDefaults=function(a){this._styleDefaults=a};DvtThematicMap.prototype.getStyleDefaults=function(){return this._styleDefaults};
DvtThematicMap.prototype.render=function(a,b,c){a&&"object"==typeof a&&this.SetOptions(a);DvtThematicMap.superclass.render.call(this,a,b,c)};DvtThematicMap.prototype.getMaxZoomFactor=function(){return this._zooming?this._maxZoomFactor:1};DvtThematicMap.prototype.setMaxZoomFactor=function(a){this._maxZoomFactor=a};DvtThematicMap.prototype.isMarkerZoomBehaviorFixed=function(){return this._isMarkerZoomBehaviorFixed};
DvtThematicMap.prototype.setMarkerZoomBehavior=function(a){this._isMarkerZoomBehaviorFixed="fixed"==a};DvtThematicMap.prototype.getMarkerStyle=function(){return this._markerStyle};DvtThematicMap.prototype.setMarkerStyle=function(a){this._markerStyle=a};DvtThematicMap.prototype.getEventHandler=function(){return this._eventHandler};DvtThematicMap.prototype.addPointLayer=function(a){this._layers.push(a)};DvtThematicMap.prototype.addLayer=function(a){this._layers.push(a)};
DvtThematicMap.prototype.getLayer=function(a){for(var b=0;b<this._layers.length;b++)if(this._layers[b].getLayerName()==a)return this._layers[b]};DvtThematicMap.prototype.getAllLayers=function(){return this._layers};DvtThematicMap.prototype.getAreaLayerContainer=function(){return this._areaLayers};DvtThematicMap.prototype.getDataAreaContainer=function(){return this._dataAreaLayers};DvtThematicMap.prototype.getDataPointContainer=function(){return this._dataPointLayers};
DvtThematicMap.prototype.getLabelContainer=function(){return this._labelLayers};DvtThematicMap.prototype.setMapName=function(a){this._bBaseMapChanged=this._mapName&&this._mapName!=a;this._mapName=a};DvtThematicMap.prototype.setAnimationOnDisplay=function(a){this._animationOnDisplay=a};DvtThematicMap.prototype.setAnimationOnMapChange=function(a){this._animationOnMapChange=a};DvtThematicMap.prototype.setAnimationDuration=function(a){this._animationDuration=parseFloat(a)};
DvtThematicMap.prototype.getAnimationDuration=function(){return this._animationDuration};DvtThematicMap.prototype.setDisplayTooltips=function(a){this._displayTooltips=a};DvtThematicMap.prototype.getDisplayTooltips=function(){return this._displayTooltips};
DvtThematicMap.prototype.setFeaturesOff=function(a){this._featuresOff=parseInt(a);DvtThematicMap.superclass.setFeaturesOff.call(this,this._featuresOff);a=this.getDisplayedControls();if(this._featuresOff==DvtThematicMap._FEATURES_OFF_PAN||this._featuresOff==DvtThematicMap._FEATURES_OFF_PAN_ZOOM||this._featuresOff==DvtThematicMap._FEATURES_OFF_PAN_ZOOMTOFIT||this._featuresOff==DvtThematicMap._FEATURES_OFF_ALL)a&=~DvtPanZoomControlPanel.CONTROLS_CENTER_BUTTON,this.setPanning(!1);if(this._featuresOff==
DvtThematicMap._FEATURES_OFF_ZOOM||this._featuresOff==DvtThematicMap._FEATURES_OFF_PAN_ZOOM||this._featuresOff==DvtThematicMap._FEATURES_OFF_ZOOM_ZOOMTOFIT||this._featuresOff==DvtThematicMap._FEATURES_OFF_ALL)a&=~DvtPanZoomControlPanel.CONTROLS_ZOOM,this.setZooming(!1);if(this._featuresOff==DvtThematicMap._FEATURES_OFF_ZOOMTOFIT||this._featuresOff==DvtThematicMap._FEATURES_OFF_PAN_ZOOMTOFIT||this._featuresOff==DvtThematicMap._FEATURES_OFF_ZOOM_ZOOMTOFIT||this._featuresOff==DvtThematicMap._FEATURES_OFF_ALL)a&=
~DvtPanZoomControlPanel.CONTROLS_ZOOM_TO_FIT_BUTTON;this.setDisplayedControls(a)};DvtThematicMap.prototype.setInitialCenterX=function(a){this._initialCenterX=parseFloat(a)};DvtThematicMap.prototype.setInitialCenterY=function(a){this._initialCenterY=parseFloat(a)};DvtThematicMap.prototype.setInitialZoom=function(a){this._initialZoom=parseFloat(a)};DvtThematicMap.prototype.setAnimationOnDrill=function(a){"alphaFade"==a&&(this._animationOnDrill=a)};
DvtThematicMap.prototype.setDrillMode=function(a){this._drillMode=a;this._eventHandler.setDrillMode(a)};DvtThematicMap.prototype.setInitialZooming=function(a){this._initialZooming=a};DvtThematicMap.prototype.setDrillZoomToFit=function(a){this._drillZoomToFit="true"==a};DvtThematicMap.prototype.getLegendPanel=function(){return this._legendPanel};
DvtThematicMap.prototype.loadXml=function(a,b,c,d){this.Options?(new DvtThematicMapJsonParser(this)).parse(this.Options):null==a||0==a.length||DvtThematicMap.superclass.loadXml.call(this,a,b,c,d)};
DvtThematicMap.prototype.LoadXmlInitial=function(a,b){this._bRendered=!1;this._pzcContainer&&(this._layers=[],this._drilledRowKeys=[],this._initDrilled={},this._drillDataLayer={},this._childToParent={},this._drilled=[],this.removeChild(this._legendPanel),this._legendButtonImages=this._legendXml=this._legend=this._legendPanel=null,this.setFeaturesOff(0),this.setDisplayedControls(DvtPanZoomControlPanel.CONTROLS_ALL),this._panning=this._zooming=!0,this._oldPzc=this._pzc,this._areaLayers=new DvtContainer(this.getCtx()),
this._dataAreaLayers=new DvtContainer(this.getCtx()),this._dataPointLayers=new DvtContainer(this.getCtx()),this._labelLayers=new DvtContainer(this.getCtx()),this._createHandlers());this._eventHandler.hideTooltip();this.GetXmlDomParser().loadXmlInitial(b)};
DvtThematicMap.prototype._createHandlers=function(){this._eventHandler=new DvtThematicMapEventManager(this.getCtx(),this.__dispatchEvent,this);this._eventHandler.addListeners(this);DvtAgent.isTouchDevice()?this._keyboardHandler=null:(this._keyboardHandler=new DvtThematicMapKeyboardHandler(this,this._eventHandler),this._eventHandler.setKeyboardHandler(this._keyboardHandler))};
DvtThematicMap.prototype.HandleLegendResize=function(a){DvtAgent.isRightToLeft(this.getCtx())||this._legendPanel.setTranslateX(this.GetWidth()-5-a.getWidth())};
DvtThematicMap.prototype._renderLegend=function(){if(this._legendXml){this._legendPanel&&(this._legendPanel.destroy(),this.removeChild(this._legendPanel));var a="true"==this._legendXml.getAttr("disclosed"),b="fixed"==this._legendXml.getAttr("display")||DvtAgent.isEnvironmentBatik();if(!b||a){var c=this._legendXml.getAttr("maxWidth"),d=c.indexOf("%"),c=-1!=d?parseFloat(c.substring(0,d))/100*this.GetWidth():parseFloat(c),d=this.GetHeight()-2*DvtThematicMap._COLLAPSIBLE_PANEL_OFFSET;if(this.getSkinName()==
DvtCSSStyle.SKIN_ALTA)this._legendPanel=new DvtPanelDrawer(this.getCtx(),null,this,"pd"),this._legendPanel.addEvtListener(DvtPanelDrawerEvent.TYPE,this.HandleLegendEvent,!1,this),this._legendPanel.setMaxWidth(c),this._legendPanel.setMaxHeight(d),this._legendPanel.setFixed(b),DvtAgent.isRightToLeft(this.getCtx())?(this._legendPanel.setDiscloseDirection(DvtPanelDrawer.DIR_RIGHT),this._legendPanel.setTranslateX(0)):this._legendPanel.setTranslateX(this.GetWidth());else{this._legendPanel=new DvtCollapsiblePanel(this.getCtx(),
c,d,e,this.getLegendButtonImages(),this.getControlPanelStyleMap(),a,b);this._legendPanel.addEvtListener(DvtCollapsiblePanelEvent.TYPE,this.HandleLegendEvent,!1,this);this._legendPanel.addEvtListener(DvtResizeEvent.RESIZE_EVENT,this.HandleLegendResize,!1,this);var c=this._legendXml.getAttr("expandTooltip"),d=this._legendXml.getAttr("collapseTooltip"),e=DvtAgent.isRightToLeft(this.getCtx())?DvtCollapsiblePanel.COLLAPSE_NORTHWEST:DvtCollapsiblePanel.COLLAPSE_NORTHEAST;this._legendPanel.setButtonTooltips(c,
d)}this._legend=new DvtCommonLegend(this.getCtx(),this._legendPanel.getMaxContentWidth(),this._legendPanel.getMaxContentHeight(),this.getLegendButtonImages(),this.getLegendStyleMap());this._legend.setXML(this._legendXml);this.addChild(this._legendPanel);this.addChild(this._legend);this._legend.render();var g;if(this.getSkinName()==DvtCSSStyle.SKIN_ALTA){this._legendPanel.setMaxContainerHeight(this._legend.getDimensions().h);this.removeChild(this._legend);var e=new DvtImage(this.getCtx(),this.getResourcesMap()[DvtPanelDrawer.PANEL_LEGEND_ICON_ENA],
0,0,DvtPanelDrawer.IMAGE_SIZE,DvtPanelDrawer.IMAGE_SIZE),c=new DvtImage(this.getCtx(),this.getResourcesMap()[DvtPanelDrawer.PANEL_LEGEND_ICON_OVR],0,0,DvtPanelDrawer.IMAGE_SIZE,DvtPanelDrawer.IMAGE_SIZE),d=new DvtImage(this.getCtx(),this.getResourcesMap()[DvtPanelDrawer.PANEL_LEGEND_ICON_DWN],0,0,DvtPanelDrawer.IMAGE_SIZE,DvtPanelDrawer.IMAGE_SIZE),h=this.getResourcesMap()[DvtPanelDrawer.PANEL_LEGEND_TIP];this._legendPanel.addPanel(this._legend,e,c,d,h,DvtPanelDrawer.PANEL_LEGEND);this._legendPanel.renderComponent();
a&&this._legendPanel.setDisclosed(!0,!0)}else this._legendPanel.addContent(this._legend),g=this._legendPanel.getDimensions(),this._legendPanel.setTranslate(DvtAgent.isRightToLeft(this.getCtx())?5:this.GetWidth()-5-g.w-g.x,5),g.w+=5;if(this._isFixedLegend=b)g||(g=this._legendPanel.getDimensions()),this._legendWidth=g.w}}};DvtThematicMap.prototype.InitComponentInternal=function(){DvtThematicMap.superclass.InitComponentInternal.call(this)};
DvtThematicMap.prototype.RenderComponentInternal=function(){DvtThematicMap.superclass.RenderComponentInternal.call(this);var a=new DvtContainer(this.getCtx()),b=new DvtContainer(this.getCtx());this._pzc.addChild(a);this._pzc.getContentPane().addChild(b);this._render(a,b);if(this._topLayer){(this._controlPanel=this._pzc.getControlPanel())&&this._pzc.addChild(this._controlPanel);this._stopAnimation();var c=new DvtRectangle(0,0,this.GetWidth(),this.GetHeight());if(!this._bRendered&&!this._oldPzc)DvtBlackBoxAnimationHandler.isSupported(this._animationOnDisplay)&&
(this._animation=DvtBlackBoxAnimationHandler.getInAnimation(this.getCtx(),this._animationOnDisplay,this._pzc,c,this._animationDuration));else{var d=null;if(this._bBaseMapChanged&&!this._bRenderNullXml)d=this._animationOnMapChange;else if(this._topLayer&&this._topLayer.getLayerName()!=this._oldTopLayerName&&(d=this._topLayer.getAnimation(),!d)){var e=this._topLayer.getDataLayers(),g;for(g in e)if(e[g].getAnimation()){d=e[g].getAnimation();break}}d&&DvtBlackBoxAnimationHandler.isSupported(d)?(this._animation=
DvtBlackBoxAnimationHandler.getCombinedAnimation(this.getCtx(),d,this._oldPzc,this._pzc,c,this._animationDuration))&&this.addChild(this._oldPzc):this._pzc.getContentPane().removeChild(this._cpContainer)}this._animation&&(this._controlPanel&&this.addChild(this._controlPanel),this._eventHandler.hideTooltip(),this._eventHandler.removeListeners(this),this._animation.setOnEnd(this.OnAnimationEnd,this),this._animation.play());this._pzcContainer=a;this._cpContainer=b;this._topLayer&&(this._oldTopLayerName=
this._topLayer.getLayerName());this._bRendered=!0}};DvtThematicMap.prototype._calcMinZoom=function(){var a=this._pzc.getZoomToFitPadding(),b=this._topLayer.getLayerDim(),c=this._pzc.getSize();c.w=this._isFixedLegend?c.w-this._legendWidth:c.w;return Math.min((c.w-2*a)/b.w,(c.h-2*a)/b.h)};
DvtThematicMap.prototype._render=function(a,b){this._renderLegend();b.addChild(this._areaLayers);b.addChild(this._dataAreaLayers);this.isMarkerZoomBehaviorFixed()?a.addChild(this._dataPointLayers):b.addChild(this._dataPointLayers);a.addChild(this._labelLayers);var c=this._pzc.getContentPane().getMatrix();this._topLayerRendered=!1;for(var d=0;d<this._layers.length;d++){var e=this._layers[d];if(!this._topLayerRendered&&e instanceof DvtMapAreaLayer||!(e instanceof DvtMapAreaLayer))e.render(c),!this._topLayerRendered&&
e instanceof DvtMapAreaLayer&&(this._topLayerRendered=!0,this._topLayer=e)}this._topLayer&&(c=this.getNavigableAreas(),0==c.length&&(c=this.getNavigableObjects()),this._keyboardHandler&&this._eventHandler.setInitialFocus(c[0]),this._pzc.setMinZoom(null),this._pzc.setMaxZoom(null),this._pzc.setZoomingEnabled(!0),this._pzc.setPanningEnabled(!0),!this._bBaseMapChanged&&!this._bRenderNullXml&&null!=this._initialZoom?(this._pzc.zoomTo(this._initialZoom),this._pzc.panTo(this._initialCenterX,this._initialCenterY)):
this._initialZooming?this._zoomData():this._pzc.zoomToFit(null,this._topLayer.getLayerDim()),this._processInitialDrilled(),this._updateZoomLimits(),this._pzc.setZoomingEnabled(this._zooming),this._pzc.setPanningEnabled(this._panning))};
DvtThematicMap.prototype.updateLayer=function(a){this._bRendered=!1;this._stopAnimation();var b=this.GetXmlStringParser();if(b&&(a=b.parse(a)))this.GetXmlDomParser().ParseDataLayers(a,this._pzc.getContentPane().getMatrix(),this._topLayer.getLayerName()),this._renderLegend(),this._bRendered=!0;this._updateZoomLimits()};DvtThematicMap.prototype._updateZoomLimits=function(){var a=this._calcMinZoom();this._pzc.setMinZoom(a);this._pzc.setMaxZoom(a*this.getMaxZoomFactor())};
DvtThematicMap.prototype.OnUpdateLayerEnd=function(){this._processInitialDrilled();this._initialZooming?this._zoomData():null==this._initialZoom&&this._pzc.zoomToFit(null,this._topLayer.getLayerDim())};DvtThematicMap.prototype.getMapName=function(){return this._mapName};DvtThematicMap.prototype.getDrillMode=function(){return this._drillMode};
DvtThematicMap.prototype.setResources=function(a){for(var a=a.getChildNodes(),b=0;b<a.length;b++){var c=a[b],d=c.getName();if(d==DvtThematicMap._ELEM_RESOURCES_CONTROLPANEL)DvtThematicMap.superclass.setButtonImages.call(this,c);else if(d==DvtThematicMap._ELEM_RESOURCES_LEGEND)this._legendButtonImages=c;else if(d==DvtThematicMap._ELEM_RESOURCES_PANEL_DRAWER){c=c.getAttributes();for(d=0;d<c.length;d++){var e=c[d];this.getResourcesMap()[e.name]=e.value}}}};
DvtThematicMap.prototype.getLegendButtonImages=function(){return this._legendButtonImages};DvtThematicMap.prototype.setLegendXml=function(a){this._legendXml=a};DvtThematicMap.prototype.setRolloverBehavior=function(a){this._rolloverBehavior=a};DvtThematicMap.prototype.getRolloverBehavior=function(){return this._rolloverBehavior};DvtThematicMap.prototype.GetXmlDomParser=function(){return new DvtThematicMapParser(this)};
DvtThematicMap.prototype._transformContainers=function(a){var b=new DvtMatrix;b.translate(a.getTx(),a.getTy());this.isMarkerZoomBehaviorFixed()&&this._dataPointLayers.setMatrix(b);this._labelLayers.setMatrix(b)};
DvtThematicMap.prototype.HandleControlPanelEvent=function(a){DvtThematicMap.superclass.HandleControlPanelEvent.call(this,a);var b=new DvtSetPropertyEvent;b.addParam(DvtPanZoomControlPanel.CONTROL_PANEL_BEHAVIOR_KEY,a.getSubType()==DvtPanZoomControlPanelEvent.SUBTYPE_SHOW?DvtAbstractPanZoomComponent.CONTROL_PANEL_BEHAVIOR_INIT_EXPANDED:DvtAbstractPanZoomComponent.CONTROL_PANEL_BEHAVIOR_INIT_COLLAPSED);this.__dispatchEvent(b)};
DvtThematicMap.prototype.HandleLegendEvent=function(a){var b=new DvtSetPropertyEvent;b.addParam(DvtCommonLegend.LEGEND_DISCLOSED_KEY,a.getSubType()==DvtCollapsiblePanelEvent.SUBTYPE_SHOW);this.__dispatchEvent(b)};
DvtThematicMap.prototype._constrainPanning=function(a){var b=this._pzc.getZoomToFitPadding(),c=this._pzc.getSize(),b=new DvtRectangle(b,b,c.w-2*b,c.h-2*b),d=this._topLayer.getLayerDim(),e=d.x*a,c=d.y*a,g=d.w*a,a=d.h*a;g>b.w?(this._pzc.setMinPanX(b.x+b.w-(e+g)),this._pzc.setMaxPanX(b.x-e)):(d=0,this._isFixedLegend&&(DvtAgent.isRightToLeft(this.getCtx())?d=this._isZoomingToFit?2*-this._legendWidth:-this._legendWidth:this._isZoomingToFit||(d=this._legendWidth)),e=(b.x+b.w-d)/2-(e+g/2),this._pzc.setMinPanX(e),
this._pzc.setMaxPanX(e));a>b.h?(this._pzc.setMinPanY(b.y+b.h-(c+a)),this._pzc.setMaxPanY(b.y-c)):(b=(b.y+b.h)/2-(c+a/2),this._pzc.setMinPanY(b),this._pzc.setMaxPanY(b))};
DvtThematicMap.prototype._updateAnimator=function(a,b){var c=a.getAnimator();if(c){var d=this._pzc.getContentPane(),e=c.getDestVal(d,d.getMatrix);b&&(this._currentAnimMatrix=d.getMatrix(),c.addProp(DvtAnimator.TYPE_MATRIX,this,this._getCenteredObjsMatrix,this._setCenteredObjsMatrix,e));d=new DvtMatrix(1,0,0,1,e.getTx(),e.getTy());this.isMarkerZoomBehaviorFixed()&&c.addProp(DvtAnimator.TYPE_MATRIX,this._dataPointLayers,this._dataPointLayers.getMatrix,this._dataPointLayers.setMatrix,d);c.addProp(DvtAnimator.TYPE_MATRIX,
this._labelLayers,this._labelLayers.getMatrix,this._labelLayers.setMatrix,d)}};
DvtThematicMap.prototype.HandleZoomEvent=function(a){switch(a.getSubType()){case DvtZoomEvent.SUBTYPE_ADJUST_PAN_CONSTRAINTS:this._panning&&this._constrainPanning(a.getNewZoom());break;case DvtZoomEvent.SUBTYPE_ZOOMING:case DvtZoomEvent.SUBTYPE_ELASTIC_ANIM_BEGIN:this._updateAnimator(a,!0);break;case DvtZoomEvent.SUBTYPE_ZOOMED:if(null!=a.getNewZoom()){var b=this._pzc.getContentPane().getMatrix();a.addParam("panX",b.getTx());a.addParam("panY",b.getTy());a._animator=null;DvtEventDispatcher.dispatchEvent(this._callback,
this._callbackObj,this,a);this._transformContainers(b);for(var c=0;c<this._layers.length;c++)this._layers[c].HandleZoomEvent(a,b)}break;case DvtZoomEvent.SUBTYPE_ZOOM_AND_CENTER:this.fitSelectedRegions();break;case DvtZoomEvent.SUBTYPE_ZOOM_TO_FIT_BEGIN:this._isZoomingToFit=!0;this._isFixedLegend&&this._pzc.setSize(this.GetWidth()-this._legendWidth,this.GetHeight(),!0);break;case DvtZoomEvent.SUBTYPE_ZOOM_TO_FIT_END:this._isZoomingToFit=!1,this._isFixedLegend&&this._pzc.setSize(this.GetWidth(),this.GetHeight(),
!0),DvtEventDispatcher.dispatchEvent(this._callback,this._callbackObj,this,new DvtZoomEvent)}};
DvtThematicMap.prototype.HandlePanEvent=function(a){var b=a.getSubType();if(b==DvtPanEvent.SUBTYPE_ELASTIC_ANIM_BEGIN)this._updateAnimator(a,!1);else if(b==DvtPanEvent.SUBTYPE_PANNED&&null!=a.getNewX()){var c=this._pzc.getContentPane().getMatrix();a.addParam("zoom",this._pzc.getZoom());a.addParam("panX",c.getTx());a.addParam("panY",c.getTy());a._animator=null;DvtEventDispatcher.dispatchEvent(this._callback,this._callbackObj,this,a);this._transformContainers(c);for(a=0;a<this._layers.length;a++)this._layers[a].HandlePanEvent(c)}this._legendPanel&&
(this.getSkinName()==DvtCSSStyle.SKIN_ALTA?b===DvtPanEvent.SUBTYPE_DRAG_PAN_BEGIN?this._legendPanel.setMouseEnabled(!1):b===DvtPanEvent.SUBTYPE_DRAG_PAN_END&&this._legendPanel.setMouseEnabled(!0):(c=this.getControlPanelStyleMap(),a=this._legendPanel._background.getStroke().clone(),b===DvtPanEvent.SUBTYPE_DRAG_PAN_BEGIN?(this._legend.setAlpha(c[DvtPanZoomControlPanel.BG_DRAG_ALPHA]),a.setAlpha(c[DvtPanZoomControlPanel.FRAME_DRAG_ALPHA]),this._legendPanel._background.setStroke(a),this._legendPanel._buttonFrame&&
this._legendPanel._buttonFrame.setAlpha(c[DvtPanZoomControlPanel.FRAME_DRAG_ALPHA]),this._legendPanel.setMouseEnabled(!1)):b===DvtPanEvent.SUBTYPE_DRAG_PAN_END&&(this._legend.setAlpha(1),a.setAlpha(c[DvtPanZoomControlPanel.FRAME_ROLLOUT_ALPHA]),this._legendPanel._background.setStroke(a),this._legendPanel._buttonFrame&&this._legendPanel._buttonFrame.setAlpha(c[DvtPanZoomControlPanel.FRAME_ROLLOUT_ALPHA]),this._legendPanel.setMouseEnabled(!0))))};
DvtThematicMap.prototype.CreatePanZoomCanvas=function(a,b){"none"==this._drillMode&&(this._featuresOff==DvtThematicMap._FEATURES_OFF_ALL||!this._zooming&&this.getSkinName()==DvtCSSStyle.SKIN_ALTA)&&this.setControlPanelBehavior(DvtAbstractPanZoomComponent.CONTROL_PANEL_BEHAVIOR_HIDDEN);this._pzc=DvtThematicMap.superclass.CreatePanZoomCanvas.call(this,a,b);if(this.getControlPanelBehavior()!=DvtAbstractPanZoomComponent.CONTROL_PANEL_BEHAVIOR_HIDDEN&&"none"!=this._drillMode){var c=[DvtObj.createCallback(this,
this.drillUp),DvtObj.createCallback(this,this.drillDown),DvtObj.createCallback(this,this.resetMap)];this._pzc.setControlPanel(new DvtThematicMapControlPanel(this.getCtx(),this._drillMode,this._buttonImages,c,this._pzc,this.getPanZoomResources(),this.getDisplayedControls(),this))}this._eventHandler.setPanZoomCanvas(this._pzc);return this._pzc};DvtThematicMap.prototype.setZooming=function(a){this._zooming=a};DvtThematicMap.prototype.setPanning=function(a){this._panning=a};
DvtThematicMap.prototype.addDisclosedRowKey=function(a){this._drilledRowKeys.push(a)};DvtThematicMap.prototype.addDrilledLayer=function(a,b){this._initDrilled[a]=b};
DvtThematicMap.prototype._processInitialDrilled=function(){this._processingInitDrilled=!0;for(var a=0;a<this._layers.length;a++){var b=this._layers[a].getLayerName();b in this._initDrilled&&(this._selectedAreas[b]=this._initDrilled[b][1],this._clickedLayerName=b,this._clickedDataLayerId=this._initDrilled[b][0],this.drillDown())}this._processingInitDrilled=!1};
DvtThematicMap.prototype.resetMap=function(){this._stopAnimation();for(var a=[],b=[],c=this._layers.length-1;-1<c;c--)this._layers[c].getLayerName()==this._topLayer.getLayerName()?this._layers[c].reset(b):this._layers[c].reset(a);for(c=0;c<a.length;c++)if(a[c]){var d=a[c].getParent();d&&d.removeChild(a[c])}for(c=0;c<b.length;c++)b[c]&&b[c].setAlpha(1);this._drilledRowKeys=[];this.fitMap();this._drilled=[];this._controlPanel&&"none"!=this._drillMode&&(this._controlPanel.setEnabledDrillDownButton(!1),
this._controlPanel.setEnabledDrillUpButton(!1))};
DvtThematicMap.prototype._zoomData=function(){var a=this._dataAreaLayers.getDimensions(),b=this._dataPointLayers.getDimensions();if(this.isMarkerZoomBehaviorFixed()){var c=this._pzc.getContentPane().getMatrix();b.w/=c.getA();b.h/=c.getD();b.x/=c.getA();b.y/=c.getD()}a=a.getUnion(b);this._stopAnimation();DvtAgent.isEnvironmentBrowser()&&(this._animation=new DvtAnimator(this.getCtx(),0.3));0<a.w&&0<a.h?this._pzc.zoomToFit(this._animation,a):this._pzc.zoomToFit(this._animation,this._topLayer.getLayerDim());
this._animation&&this._animation.play()};DvtThematicMap.prototype._zoomToFitBounds=function(a){var b=new DvtAnimator(this.getCtx(),0.3);this._pzc.zoomToFit(b,a);b.play()};DvtThematicMap.prototype.fitRegion=function(a){a||(a=this._zoomToFitObject);a||(a=this._clickedObject);this._zoomToFitBounds(a.getDimensions())};
DvtThematicMap.prototype.fitSelectedRegions=function(){if(this._clickedDataLayerId){var a=this.getLayer(this._clickedLayerName).getDataLayer(this._clickedDataLayerId);if(a&&(a=a._selectionHandler)){for(var a=a.getSelection(),b=0;b<a.length;b++)a[b]=a[b].getDisplayable();if(0<a.length){for(var c=a[0].getDimensions(),b=1;b<a.length;b++)c=c.getUnion(a[b].getDimensions());this._zoomToFitBounds(c)}}}};
DvtThematicMap.prototype.fitMap=function(){var a=new DvtAnimator(this.getCtx(),0.3);this._pzc.zoomToFit(a);a.play()};DvtThematicMap.prototype.getDrillParentLayer=function(a){return this.getLayer(DvtBaseMapManager.getParentLayerName(this._mapName,a))};DvtThematicMap.prototype.getDrillChildLayer=function(a){return this.getLayer(DvtBaseMapManager.getChildLayerName(this._mapName,a))};
DvtThematicMap.prototype.getNavigableAreas=function(){var a=[];if(this._topLayer)for(var b=0;b<this._layers.length;b++){var c=this._layers[b].getDataLayers(),d;for(d in c)a=this._topLayer.getLayerName()==this._layers[b].getLayerName()?a.concat(c[d].getNavigableAreaObjects()):a.concat(c[d].getNavigableDisclosedAreaObjects())}return a};
DvtThematicMap.prototype.getNavigableObjects=function(){var a=[];if(this._topLayer)for(var b=0;b<this._layers.length;b++){var c=this._layers[b].getDataLayers();if(this._topLayer.getLayerName()==this._layers[b].getLayerName()||!(this._layers[b]instanceof DvtMapAreaLayer))for(var d in c)a=a.concat(c[d].getDataObjects())}return a};
DvtThematicMap.prototype._setCenteredObjsMatrix=function(a){this._currentAnimMatrix=a;if(this.isMarkerZoomBehaviorFixed()){for(var b=this.getNavigableObjects(),c=0;c<b.length;c++)b[c].HandleZoomEvent(a);b=this._labelLayers.getNumChildren();for(c=0;c<b;c++)for(var d=this._labelLayers.getChildAt(c),e=d.getNumChildren(),g=0;g<e;g++){var h=d.getChildAt(g);h instanceof DvtMapLabel&&h.update(a)}}};DvtThematicMap.prototype._getCenteredObjsMatrix=function(){return this._currentAnimMatrix};
DvtThematicMap.prototype.drillDown=function(){this._stopAnimation();var a=this.getDrillChildLayer(this._clickedLayerName),b=this.getLayer(this._clickedLayerName),c=[];if(a){this._drillDataLayer[this._clickedLayerName]=this._clickedDataLayerId;var d=this._selectedAreas[this._clickedLayerName];!this._processingInitDrilled&&"single"==this._drillMode&&(this._drilled.pop(),b.reset(c,d),a.reset(this._drillAnimFadeOutObjs));for(var e=[],g=0;g<d.length;g++){var h=d[g],k=b.getChildrenForArea(h);e.push(k[0]);
for(var m=0;m<k.length;m++)this._childToParent[k[m]]=d[g];a.discloseAreas(k,c);(k=b.getDataLayer(this._clickedDataLayerId))&&k.drill(h,this._drillAnimFadeOutObjs);this._drilled.push(h)}this._handleDrillAnimations(this._drillAnimFadeOutObjs,c,!1);this._updateDrillButton(a.getLayerName());this._clickedLayerName=a.getLayerName();this._selectedAreas[this._clickedLayerName]=e}};
DvtThematicMap.prototype.drillUp=function(){this._stopAnimation();for(var a=this.getLayer(this._clickedLayerName),b=this.getDrillParentLayer(this._clickedLayerName),c=[],d=[],e=this._selectedAreas[this._clickedLayerName],g=0;g<e.length;g++){var h=this._childToParent[e[g]];d.push(h);if(-1!=DvtArrayUtils.getIndex(this._drilled,h)){var k=b.getChildrenForArea(h);a.undiscloseAreas(k,this._drillAnimFadeOutObjs);b.getDataLayer(this._drillDataLayer[b.getLayerName()]).undrill(h,c);h=DvtArrayUtils.getIndex(this._drilled,
h);-1!=h&&this._drilled.splice(h,1)}}this._handleDrillAnimations(this._drillAnimFadeOutObjs,c,!0);this._clickedLayerName=b.getLayerName();this._clickedDataLayerId=this._drillDataLayer[this._clickedLayerName];this._selectedAreas[this._clickedLayerName]=d;this._updateDrillButton(this._clickedLayerName)};DvtThematicMap.prototype._stopAnimation=function(){this._animation&&(this._animation.stop(!0),this._animation=null)};
DvtThematicMap.prototype._handleDrillAnimations=function(a,b,c){this._pzc.getContentPane().getMatrix();if(this._drillZoomToFit&&!this._processingInitDrilled){var d=new DvtAnimator(this.getCtx(),0.3);DvtAgent.isEnvironmentBrowser()||(d=null);c?this._pzc.zoomToFit(d):this.fitSelectedRegions();d&&d.play()}this._stopAnimation();this._animation=DvtBlackBoxAnimationHandler.getCombinedAnimation(this.getCtx(),this._animationOnDrill,a,b,null,0.5);DvtAgent.isEnvironmentBrowser()||(this._animation=null);this._animation?
(this._eventHandler.hideTooltip(),this._eventHandler.removeListeners(this),this._animation.setOnEnd(this.OnDrillAnimationEnd,this),this._animation.play()):this._cleanUpDrilledObjects()};DvtThematicMap.prototype.setClickInfo=function(a,b,c){this._clickedLayerName=b;this._clickedDataLayerId=a;this._clickedObject=c};DvtThematicMap.prototype.setEventClientId=function(a){this._eventClientId=a};
DvtThematicMap.prototype.__dispatchEvent=function(a){var b=a.getType();b==DvtSelectionEvent.TYPE?this._handleSelectionEvent(a):b==DvtMapDrillEvent.TYPE?this._handleDrillEvent(a):(b==DvtShowPopupEvent.TYPE||b==DvtHidePopupEvent.TYPE)&&a.addParam("clientId",this._eventClientId);DvtEventDispatcher.dispatchEvent(this._callback,this._callbackObj,this,a)};
DvtThematicMap.prototype._handleSelectionEvent=function(a){this._clickedDataLayerId?(this._selectedRowKeys=a.getSelection(),this._selectedAreas[this._clickedLayerName]=this.getLayer(this._clickedLayerName).getDataLayer(this._clickedDataLayerId).getSelectedAreas(this._selectedRowKeys),this._updateDrillButton(this._clickedLayerName),a.addParam("clientId",this._clickedDataLayerId),this._clickedObject&&!(this._clickedObject instanceof DvtMarker)&&(this._zoomToFitObject=this._clickedObject)):(this._updateDrillButton(null),
this._zoomToFitObject=null)};DvtThematicMap.prototype._hideSelectionMenu=function(){this._selectionText&&(this.removeChild(this._selectionText),this._selectionText=null)};
DvtThematicMap.prototype._updateDrillButton=function(a){if(this._controlPanel&&this._drillMode&&"none"!=this._drillMode){var b=this.getDrillChildLayer(a),a=this.getDrillParentLayer(a);b?this._controlPanel.setEnabledDrillDownButton(!0):this._controlPanel.setEnabledDrillDownButton(!1);a?this._controlPanel.setEnabledDrillUpButton(!0):this._controlPanel.setEnabledDrillUpButton(!1)}};
DvtThematicMap.prototype._handleDrillEvent=function(a){a.addParam("clientId",this._eventClientId);this._drilledRowKeys="multiple"==this._drillMode?this._drilledRowKeys.concat(this._selectedRowKeys):this._selectedRowKeys;var b=a.getDrillType();b==DvtMapDrillEvent.DRILL_UP&&this.drillUp();b==DvtMapDrillEvent.DRILL_DOWN?this.drillDown():b==DvtMapDrillEvent.RESET&&this.resetMap();a.setDisclosed(this._drilledRowKeys)};
DvtThematicMap.prototype.destroy=function(){DvtThematicMap.superclass.destroy.call(this);this._eventHandler&&(this._eventHandler.destroy(),this._eventHandler=null)};DvtThematicMap.prototype.OnAnimationEnd=function(){this._controlPanel&&this._pzc.addChild(this._controlPanel);this._oldPzc&&(this.removeChild(this._oldPzc),this._oldPzc=null);this._animation=null;this._eventHandler.addListeners(this)};
DvtThematicMap.prototype.OnDrillAnimationEnd=function(){this._cleanUpDrilledObjects();this._animation=null;this._eventHandler.addListeners(this)};DvtThematicMap.prototype._cleanUpDrilledObjects=function(){if(0<this._drillAnimFadeOutObjs.length){for(var a=0;a<this._drillAnimFadeOutObjs.length;a++){var b=this._drillAnimFadeOutObjs[a];if(b)if(b instanceof DvtMapLabel)b.reset();else if(b.isDrilled&&b.isDrilled())b.setAlpha(0);else{var c=b.getParent();c&&c.removeChild(b)}}this._drillAnimFadeOutObjs=[]}};
DvtThematicMap.prototype._rolloverCallback=function(a){var b=a.getHideAttributes();this._fireRolloverEvent(DvtLegendItemRollOverEvent.MOUSEOVER==a.getMouseState()?DvtCategoryRolloverEvent.TYPE_OVER:DvtCategoryRolloverEvent.TYPE_OUT,b)};
DvtThematicMap.prototype._fireRolloverEvent=function(a,b){var c=new DvtCategoryRolloverEvent(a,b),d=[],e;for(e in this._areas)for(var g in this._areas[e])d.push(this._areas[e][g]);for(e in this._markers)for(g in this._markers[e])d.push(this._markers[e][g]);e=this._legend._hideAttrsLookUp;for(var h in e)g=new DvtThematicMapCategoryWrapper(e[h].getContentShape(),h),d.push(g);DvtCategoryRolloverHandler.processEvent(c,d,0.1)};
DvtThematicMap.prototype.getShapesForViewSwitcher=function(){var a={},b=this._topLayer.getDataLayers(),c;for(c in b){b=b[c].getAreaObjects();for(c=0;c<b.length;c++){var d=b[c],e=d.getDisplayable();a[d.getId()]=e}break}return a};DvtThematicMap.prototype.getAutomation=function(){this.Automation||(this.Automation=new DvtThematicMapAutomation(this));return this.Automation};
var DvtThematicMapDefaults=function(){this.Init({fusion:DvtThematicMapDefaults.DEFAULT,skyros:DvtThematicMapDefaults.SKIN_SKYROS,alta:DvtThematicMapDefaults.SKIN_ALTA})};DvtObj.createSubclass(DvtThematicMapDefaults,DvtBaseComponentDefaults,"DvtThematicMapDefaults");
DvtThematicMapDefaults.DEFAULT={skin:null,animationDuration:500,animationOnDisplay:"none",animationOnDrill:"none",animationOnMapChange:"none",controlPanelBehavior:"hidden",drilling:"off",initialZooming:"none",maintainDrill:"off",markerZoomBehavior:"fixed",panning:"none",tooltipDisplay:"auto",zooming:"none",styleDefaults:{areaStyle:"background-color:#B8CDEC;border-color:#FFFFFF;",dataAreaDefaults:{borderColor:"#FFFFFF",drilledInnerColor:"#FFFFFF",drilledOuterColor:"#000000",hoverColor:"#FFFFFF",opacity:1,
selectedInnerColor:"#FFFFFF",selectedOuterColor:"#000000"},dataMarkerDefaults:{borderColor:"#FFFFFF",borderStyle:"solid",borderWidth:"0.5px",color:"#000000",height:8,labelStyle:"font-family:Tahoma;font-size:13pt;color:#000000",opacity:0.4,scaleX:1,scaleY:1,shape:"circle",width:8},labelStyle:"font-family:Tahoma;font-size:11pt;"},legend:{position:"auto",rendered:!0,layout:{gapRatio:1}},layout:{gapRatio:null,legendMaxSize:0.3,legendGap:10}};DvtThematicMapDefaults.SKIN_SKYROS={styleDefaults:{backgroundColor:"#FFFFFF"}};
DvtThematicMapDefaults.SKIN_ALTA={skin:DvtCSSStyle.SKIN_ALTA,styleDefaults:{areaStyle:"background-color:#DDDDDD;border-color:#FFFFFF;",backgroundColor:"#FFFFFF",dataAreaDefaults:{drilledOuterColor:"#0572CE"},dataMarkerDefaults:{color:"rgb(51,51,51)",labelStyle:'font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:12px;color:#333333',opacity:1},labelStyle:'font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:12px;'}};
DvtThematicMapDefaults.DEFAULT_AREA_LAYER={animationOnLayerChange:"none",labelDisplay:"auto",labelType:"short"};DvtThematicMapDefaults.DEFAULT_DATA_LAYER={animationOnDataChange:"none",selection:"none"};DvtThematicMapDefaults.prototype.calcAreaLayerOptions=function(a){return DvtJSONUtils.merge(a,DvtThematicMapDefaults.DEFAULT_AREA_LAYER)};DvtThematicMapDefaults.prototype.calcDataLayerOptions=function(a){return DvtJSONUtils.merge(a,DvtThematicMapDefaults.DEFAULT_DATA_LAYER)};
DvtThematicMapDefaults.getGapSize=function(a,b){return Math.ceil(b*a.getGapRatio())};DvtThematicMap.prototype._getCurrentDragSource=function(){for(var a=0;a<this._layers.length;a++){var b=this._layers[a].getDataLayers(),c;for(c in b){var d=b[c].getDragSource();if(d&&d.getDragCandidate())return d}}return null};DvtThematicMap.prototype.isDragAvailable=function(a,b,c){this._dragAllowed=!1;return(a=this._getCurrentDragSource())?a.isDragAvailable(c):!1};
DvtThematicMap.prototype.getDragTransferable=function(a,b){var c=this._getCurrentDragSource();return c?c.getDragTransferable(a,b):null};DvtThematicMap.prototype.getDragOverFeedback=function(a,b){var c=this._getCurrentDragSource();return c?c.getDragOverFeedback(a,b):null};DvtThematicMap.prototype.getDragContext=function(a,b){var c=this._getCurrentDragSource();return c?c.getDragContext(a,b):null};
DvtThematicMap.prototype.getDragOffset=function(a,b){var c=this._getCurrentDragSource();return c?c.getDragOffset(a,b):null};DvtThematicMap.prototype.getPointerOffset=function(a,b){var c=this._getCurrentDragSource();return c?c.getPointerOffset(a,b):null};DvtThematicMap.prototype.initiateDrag=function(){var a=this._getCurrentDragSource();a&&a.initiateDrag()};DvtThematicMap.prototype.dragDropEnd=function(){var a=this._getCurrentDragSource();a&&a.dragDropEnd()};
DvtThematicMap.prototype.prepDrag=function(){this._panning?this._startDragDropTimer(1E3):this._dragAllowed=!0};DvtThematicMap.prototype.abortPrep=function(){this._stopDragDropTimer()};DvtThematicMap.prototype.recognizeDrag=function(){this._stopDragDropTimer();return this._dragAllowed};DvtThematicMap.prototype._startDragDropTimer=function(a){this._dragDropTimer=new DvtTimer(this.getCtx(),a,this._handleDragDropTimer,this,1);this._dragDropTimer.start()};
DvtThematicMap.prototype._handleDragDropTimer=function(){this._stopDragDropTimer();this._dragAllowed=!0};DvtThematicMap.prototype._stopDragDropTimer=function(){this._dragDropTimer&&(this._dragDropTimer.stop(),this._dragDropTimer=null)};DvtThematicMap.prototype._getCurrentDropTarget=function(a,b){for(var c=0;c<this._layers.length;c++)if(this._layers[c].getDropTarget){var d=this._layers[c].getDropTarget();if(d&&d.getDropSite(a,b))return d}return null};
DvtThematicMap.prototype.acceptDrag=function(a,b,c){var d=this._pzc.getZoom(),a=(a-this._pzc.getPanX())/d,b=(b-this._pzc.getPanY())/d;return(this._dropTarget=this._getCurrentDropTarget(a,b))?this._dropTarget.acceptDrag(a,b,c):null};DvtThematicMap.prototype.dragEnter=function(){return this._dropTarget?this._dropTarget.dragEnter():null};DvtThematicMap.prototype.dragExit=function(){return this._dropTarget?this._dropTarget.dragExit():null};
DvtThematicMap.prototype.getDropSite=function(a,b){var c=this._pzc.getZoom(),a=(a-this._pzc.getPanX())/c,b=(b-this._pzc.getPanY())/c;return this._dropTarget?this._dropTarget.getDropSite(a,b):null};var DvtThematicMapDropTarget=function(a,b){this._areaLayer=a;this._basemap=b};DvtObj.createSubclass(DvtThematicMapDropTarget,DvtDropTarget,"DvtThematicMapDropTarget");
DvtThematicMapDropTarget.prototype.acceptDrag=function(a,b){var c=this._areaLayer.__getObjectUnderPoint(a,b);if(c)c!=this._dropSite&&(this._areaLayer.__showDropSiteFeedback(c),this._dropSite=c);else return this._areaLayer.__showDropSiteFeedback(null),null;return this._areaLayer.getClientId()};DvtThematicMapDropTarget.prototype.dragExit=function(){this._areaLayer.__showDropSiteFeedback(null);this._dropSite=null};
DvtThematicMapDropTarget.prototype.getDropSite=function(a,b){var c=this._areaLayer.__getObjectUnderPoint(a,b);if(c){var d=DvtThematicMapProjections.inverseProject(a,b,this._basemap);return{regionId:c.getAreaName(),localX:d.x,localY:d.y}}return null};var DvtThematicMapAutomation=function(a){this._tmap=a};DvtObj.createSubclass(DvtThematicMapAutomation,DvtAutomation,"DvtThematicMapAutomation");
DvtThematicMapAutomation.prototype.GetSubIdForDomElement=function(a){return(a=this._tmap.getEventHandler().GetLogicalObject(a))&&(a instanceof DvtMapDataArea||a instanceof DvtMapDataMarker)?this._getSubId(a):null};DvtThematicMapAutomation.prototype.getDomElementForSubId=function(a){var b=a.indexOf(":"),c=a.indexOf("[");if(0<b&&0<c){var d=a.substring(0,b),b=a.substring(b+1,c),a=a.substring(c+1,a.length-1);return this._getDomElement(d,b,a)}return null};
DvtThematicMapAutomation.prototype.getData=function(a,b,c){return(b=this._getDataObject(a,b,c))?(a={},a.color=b.getDatatipColor(),a.tooltip=b.getDatatip(),b=b.getLabel(),a.label=b?b.getTextString():null,a):null};DvtThematicMapAutomation.prototype._getDomElement=function(a,b,c){return(a=this._getDataObject(a,b,c))?a.getDisplayable().getElem():null};
DvtThematicMapAutomation.prototype._getSubId=function(a){for(var b=this._tmap.getAllLayers(),c=0;c<b.length;c++){var d=b[c].getDataLayers(),e;for(e in d)if(a instanceof DvtMapDataArea)for(var g=d[e].getAreaObjects(),h=0;h<g.length;h++){if(g[h]===a)return this._getDataLayerId(e)+":area["+a.getId()+"]"}else if(a instanceof DvtMapDataMarker){g=d[e].getDataObjects();for(h=0;h<g.length;h++)if(g[h]===a)return this._getDataLayerId(e)+":marker["+a.getId()+"]"}}return null};
DvtThematicMapAutomation.prototype._getDataObject=function(a,b,c){for(var d=this._tmap.getAllLayers(),e=0;e<d.length;e++){var g=d[e].getDataLayers(),h;for(h in g)if(this._getDataLayerId(h)==a)if("area"==b)for(var k=g[h].getAreaObjects(),m=0;m<k.length;m++){if(k[m].getId()===c)return k[m]}else if("marker"==b){k=g[h].getDataObjects();for(m=0;m<k.length;m++)if(k[m].getId()===c)return k[m]}}return null};
DvtThematicMapAutomation.prototype._getDataLayerId=function(a){var b=a.lastIndexOf(":");return 0<b?a.substring(b+1):a};var DvtDrillablePath=function(a,b){this.Init(a,b)};DvtObj.createSubclass(DvtDrillablePath,DvtPath,"DvtDrillablePath");DvtDrillablePath.HOVER_STROKE_WIDTH=2;DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH=1;DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH=4;DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH=6;DvtDrillablePath.DISCLOSED_INNER_STROKE_WIDTH=2;
DvtDrillablePath.DISCLOSED_OUTER_STROKE_WIDTH=4;DvtDrillablePath.prototype.Init=function(a,b){DvtDrillablePath.superclass.Init.call(this,a);this._disclosedOuterShape=this._disclosedInnerShape=this._disclosedOuterStroke=this._disclosedInnerStroke=null;this._isDrilled=!1;this.Zoom=1;this._bSupportsVectorEffects=b};DvtDrillablePath.prototype.isDrilled=function(){return this._isDrilled};
DvtDrillablePath.prototype.setDrilled=function(a){this._isDrilled!=a&&(this._isDrilled=a,this.isDrilled()?(this._disclosedInnerShape=this.copyShape(),this._disclosedInnerShape.setFill(null),this._disclosedInnerShape.setMouseEnabled(!1),this._disclosedOuterShape=this.copyShape(),this._disclosedOuterShape.setFill(null),this._disclosedOuterShape.setMouseEnabled(!1),a=this.getParent(),a.addChild(this._disclosedOuterShape),a.addChild(this._disclosedInnerShape),this._disclosedInnerShape.setStroke(this._adjustStrokeZoomWidth(this._disclosedInnerStroke,
DvtDrillablePath.DISCLOSED_INNER_STROKE_WIDTH)),this._disclosedOuterShape.setStroke(this._adjustStrokeZoomWidth(this._disclosedOuterStroke,DvtDrillablePath.DISCLOSED_OUTER_STROKE_WIDTH)),this.setMouseEnabled(!1),this.IsShowingHoverEffect=!1):(this.isHoverEffectShown()&&(this.UpdateSelectionEffect(),this.InnerShape.setStroke(this._adjustStrokeZoomWidth(this.HoverInnerStroke,1),DvtDrillablePath.HOVER_STROKE_WIDTH)),this._disclosedOuterShape.getParent().removeChild(this._disclosedOuterShape),this._disclosedInnerShape.getParent().removeChild(this._disclosedInnerShape),
this.setMouseEnabled(!0),this.setAlpha(1)))};
DvtDrillablePath.prototype.setSelected=function(a){this.IsSelected!=a&&(a&&(this.isHoverEffectShown()?(this.CreateSelectedHoverStrokes(),this.SelectedHoverInnerStroke=this._adjustStrokeZoomWidth(this.SelectedHoverInnerStroke,DvtDrillablePath.HOVER_STROKE_WIDTH),this.SelectedHoverOuterStroke=this._adjustStrokeZoomWidth(this.SelectedHoverOuterStroke,DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH)):(this.SelectedInnerStroke=this._adjustStrokeZoomWidth(this.SelectedInnerStroke,DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH),
this.SelectedOuterStroke=this._adjustStrokeZoomWidth(this.SelectedOuterStroke,DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH))),DvtDrillablePath.superclass.setSelected.call(this,a))};
DvtDrillablePath.prototype.showHoverEffect=function(){this.isSelected()?(this.CreateSelectedHoverStrokes(),this.SelectedHoverInnerStroke=this._adjustStrokeZoomWidth(this.SelectedHoverInnerStroke,DvtDrillablePath.HOVER_STROKE_WIDTH),this.SelectedHoverOuterStroke=this._adjustStrokeZoomWidth(this.SelectedHoverOuterStroke,DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH)):this.HoverInnerStroke=this._adjustStrokeZoomWidth(this.HoverInnerStroke,DvtDrillablePath.HOVER_STROKE_WIDTH);DvtDrillablePath.superclass.showHoverEffect.call(this)};
DvtDrillablePath.prototype.CreateSelectedHoverStrokes=function(){this.SelectedHoverInnerStroke||(this.SelectedHoverInnerStroke=this.HoverInnerStroke.clone(),this.SelectedHoverInnerStroke.setWidth(DvtDrillablePath.HOVER_STROKE_WIDTH),this._bSupportsVectorEffects&&this.SelectedHoverInnerStroke.setFixedWidth(!0));this.SelectedHoverOuterStroke||(this.SelectedHoverOuterStroke=this.SelectedOuterStroke.clone(),this.SelectedHoverOuterStroke.setWidth(DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH),this._bSupportsVectorEffects&&
this.SelectedHoverOuterStroke.setFixedWidth(!0))};DvtDrillablePath.prototype.hideHoverEffect=function(){this.isSelected()&&(this.SelectedInnerStroke=this._adjustStrokeZoomWidth(this.SelectedInnerStroke,DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH),this.SelectedOuterStroke=this._adjustStrokeZoomWidth(this.SelectedOuterStroke,DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH));DvtDrillablePath.superclass.hideHoverEffect.call(this)};
DvtDrillablePath.prototype.setHoverStroke=function(a,b){DvtDrillablePath.superclass.setHoverStroke.call(this,a,b);this._bSupportsVectorEffects&&(this.HoverInnerStroke&&this.HoverInnerStroke.setFixedWidth(!0),this.HoverOuterStroke&&this.HoverOuterStroke.setFixedWidth(!0));return this};
DvtDrillablePath.prototype.setSelectedStroke=function(a,b){DvtDrillablePath.superclass.setSelectedStroke.call(this,a,b);this._bSupportsVectorEffects&&(this.SelectedInnerStroke&&this.SelectedInnerStroke.setFixedWidth(!0),this.SelectedOuterStroke&&this.SelectedOuterStroke.setFixedWidth(!0));return this};
DvtDrillablePath.prototype.setSelectedHoverStroke=function(a,b){DvtDrillablePath.superclass.setSelectedHoverStroke.call(this,a,b);this._bSupportsVectorEffects&&(this.SelectedHoverInnerStroke&&this.SelectedHoverInnerStroke.setFixedWidth(!0),this.SelectedHoverOuterStroke&&this.SelectedHoverOuterStroke.setFixedWidth(!0));return this};
DvtDrillablePath.prototype.setDisclosedStroke=function(a,b){(this._disclosedInnerStroke=a)&&this._bSupportsVectorEffects&&this._disclosedInnerStroke.setFixedWidth(!0);(this._disclosedOuterStroke=b)&&this._bSupportsVectorEffects&&this._disclosedOuterStroke.setFixedWidth(!0);return this};DvtDrillablePath.prototype.savePatternFill=function(a){this._ptFill=a};DvtDrillablePath.prototype.getSavedPatternFill=function(){return this._ptFill};
DvtDrillablePath.prototype._updateStrokeZoomWidth=function(a,b){if(!this._bSupportsVectorEffects){var c=a.getStroke();c&&(c=c.clone(),c.setWidth(b/this.Zoom),a.setStroke(c))}};DvtDrillablePath.prototype._adjustStrokeZoomWidth=function(a,b){if(!this._bSupportsVectorEffects){var c=a.clone();c.setWidth(b/this.Zoom);return c}return a};
DvtDrillablePath.prototype.handleZoomEvent=function(a){this.Zoom=a.getA();this.isDrilled()?(this._updateStrokeZoomWidth(this._disclosedInnerShape,DvtDrillablePath.DISCLOSED_INNER_STROKE_WIDTH),this._updateStrokeZoomWidth(this._disclosedOuterShape,DvtDrillablePath.DISCLOSED_OUTER_STROKE_WIDTH)):this.isSelected()?this.isHoverEffectShown()?(this._updateStrokeZoomWidth(this.InnerShape,DvtDrillablePath.HOVER_STROKE_WIDTH),this._updateStrokeZoomWidth(this,DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH)):
(this._updateStrokeZoomWidth(this.InnerShape,DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH),this._updateStrokeZoomWidth(this,DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH)):this.isHoverEffectShown()?this._updateStrokeZoomWidth(this.InnerShape,DvtDrillablePath.HOVER_STROKE_WIDTH):this._updateStrokeZoomWidth(this,1)};
(DvtBaseMapManager=this.DvtBaseMapManager)?(DvtBaseMapManager._UNPROCESSED_MAPS=DvtBaseMapManager._UNPROCESSED_MAPS,DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES=DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES):DvtBaseMapManager={_UNPROCESSED_MAPS:[[],[],[]],_UNPROCESSED_PARENT_UPDATES:[[],[],[]]};
"undefined"!=typeof DVT_ADVANCED_CLOSURE&&(goog.exportSymbol("DvtBaseMapManager",DvtBaseMapManager),goog.exportProperty(DvtBaseMapManager,"_UNPROCESSED_MAPS",DvtBaseMapManager._UNPROCESSED_MAPS),goog.exportProperty(DvtBaseMapManager,"_UNPROCESSED_PARENT_UPDATES",DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES));DvtObj.createSubclass(DvtBaseMapManager,DvtObj,"DvtBaseMapManager");DvtBaseMapManager.TYPE_LABELS=0;DvtBaseMapManager.TYPE_PATH=1;DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN=2;
DvtBaseMapManager.TYPE_LABELINFO=3;DvtBaseMapManager.TYPE_DIM=4;DvtBaseMapManager._INDEX="__index";DvtBaseMapManager._GLOBAL_MAPS={};DvtBaseMapManager.getBaseMapDim=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a][b];return c&&(c=c[DvtBaseMapManager.TYPE_DIM])?new DvtRectangle(c[0],c[1],c[2],c[3]):null};
DvtBaseMapManager.getAreaLabelInfo=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a][b];return c?c[DvtBaseMapManager.TYPE_LABELINFO]:null};DvtBaseMapManager.getAreaNames=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a][b];return c?c[DvtBaseMapManager.TYPE_LABELS]:null};
DvtBaseMapManager.getLongAreaLabel=function(a,b,c){DvtBaseMapManager._processUnprocessedMaps();var a=DvtBaseMapManager._GLOBAL_MAPS[a][b],d;a&&(d=a[DvtBaseMapManager.TYPE_LABELS]);return d&&d[c]?d[c][1]:null};DvtBaseMapManager.getCityCoordinates=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a];if(c&&(c=c.cities))if(c=c[DvtBaseMapManager.TYPE_PATH][b])return new DvtPoint(c[0],c[1]);return null};
DvtBaseMapManager.getCityLabel=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a];if(c&&(c=c.cities))if(c=c[DvtBaseMapManager.TYPE_LABELS][b])return c[1];return null};
DvtBaseMapManager.getAreaCenter=function(a,b,c){DvtBaseMapManager._processUnprocessedMaps();var d=DvtBaseMapManager._GLOBAL_MAPS[a];if(d&&(d=d[b])){if((d=d[DvtBaseMapManager.TYPE_LABELINFO])&&d[c])return DvtRectangle.create(d[c][0]).getCenter();a=DvtBaseMapManager._GLOBAL_MAPS[a][b][DvtBaseMapManager.TYPE_PATH][c];if(!a)return null;a=DvtPathUtils.createPathArray(a);return DvtPathUtils.getDimensions(a).getCenter()}return null};
DvtBaseMapManager.getChildLayerName=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a][b];return c?DvtBaseMapManager._GLOBAL_MAPS[a][DvtBaseMapManager._INDEX][c.__index+1]:null};DvtBaseMapManager.getParentLayerName=function(a,b){DvtBaseMapManager._processUnprocessedMaps();return DvtBaseMapManager._GLOBAL_MAPS[a][b]?DvtBaseMapManager._GLOBAL_MAPS[a][DvtBaseMapManager._INDEX][DvtBaseMapManager._GLOBAL_MAPS[a][b].__index-1]:null};
DvtBaseMapManager.getAreaPaths=function(a,b){DvtBaseMapManager._processUnprocessedMaps();return DvtBaseMapManager._GLOBAL_MAPS[a][b][DvtBaseMapManager.TYPE_PATH]};DvtBaseMapManager.getPathForArea=function(a,b,c){DvtBaseMapManager._processUnprocessedMaps();return DvtBaseMapManager._GLOBAL_MAPS[a][b][DvtBaseMapManager.TYPE_PATH][c]};
DvtBaseMapManager.getChildrenForLayerAreas=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager.getChildLayerName(a,b);return c&&(c=DvtBaseMapManager._GLOBAL_MAPS[a][c][DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN])?c:[]};DvtBaseMapManager.getMapLayerName=function(a,b){DvtBaseMapManager._processUnprocessedMaps();return DvtBaseMapManager._GLOBAL_MAPS[a][DvtBaseMapManager._INDEX][b]};
DvtBaseMapManager.registerBaseMapLayer=function(a,b,c,d,e,g,h,k){var m=DvtBaseMapManager._GLOBAL_MAPS[a];m||(m={},m[DvtBaseMapManager._INDEX]=[],DvtBaseMapManager._GLOBAL_MAPS[a]=m);a=m[b];a||(a={},m[b]=a,null!=h&&(m[DvtBaseMapManager._INDEX][h]=b));a[DvtBaseMapManager.TYPE_LABELS]=c;a[DvtBaseMapManager.TYPE_PATH]=d;a[DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN]=e;a[DvtBaseMapManager.TYPE_LABELINFO]=g;a[DvtBaseMapManager.TYPE_DIM]=k;a[DvtBaseMapManager._INDEX]=h};
DvtBaseMapManager.registerResourceBundle=function(a,b,c){var d=DvtBaseMapManager._GLOBAL_MAPS[a];d||(d={},DvtBaseMapManager._GLOBAL_MAPS[a]=d);a=d[b];a||(a={},d[b]=a);(a=d[b])&&(a[DvtBaseMapManager.TYPE_LABELS]=c)};DvtBaseMapManager.updateResourceBundle=function(a,b,c){if(a=DvtBaseMapManager._GLOBAL_MAPS[a])if(b=a[b])for(var d in c)b[DvtBaseMapManager.TYPE_LABELS][d]=c[d]};
DvtBaseMapManager.loadUnprocessedMaps=function(a,b){DvtBaseMapManager._UNPROCESSED_MAPS=a;DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES=b;DvtBaseMapManager._processUnprocessedMaps()};
DvtBaseMapManager._processUnprocessedMaps=function(){var a,b;if(DvtBaseMapManager._UNPROCESSED_MAPS){for(a=0;a<DvtBaseMapManager._UNPROCESSED_MAPS[0].length;a++)b=DvtBaseMapManager._UNPROCESSED_MAPS[0][a],DvtBaseMapManager.registerBaseMapLayer(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);for(a=0;a<DvtBaseMapManager._UNPROCESSED_MAPS[1].length;a++)b=DvtBaseMapManager._UNPROCESSED_MAPS[1][a],DvtBaseMapManager.registerResourceBundle(b[0],b[1],b[2]);for(a=0;a<DvtBaseMapManager._UNPROCESSED_MAPS[2].length;a++)b=
DvtBaseMapManager._UNPROCESSED_MAPS[2][a],DvtBaseMapManager.updateResourceBundle(b[0],b[1],b[2]);DvtBaseMapManager._UNPROCESSED_MAPS=null}if(DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES)for(a=0;a<DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES[0].length;a++){b=DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES[0][a];var c=b[1],d=b[2],e=DvtBaseMapManager._GLOBAL_MAPS[b[0]],g;if(e){if(c=e[c]){c[DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN]=b[3];g=c[DvtBaseMapManager.TYPE_DIM];a=c[DvtBaseMapManager._INDEX];
c=e[DvtBaseMapManager._INDEX];c.splice(a,0,d);e[d][DvtBaseMapManager._INDEX]=a;for(a+=1;a<c.length;a++)(d=e[c[a]])&&d[DvtBaseMapManager._INDEX]++}(c=e[b[2]])&&(c[DvtBaseMapManager.TYPE_DIM]=g)}}};DvtBaseMapManager.simplifyAreaPaths=function(a,b,c,d,e,g){if(0<g){b=1/(Math.min(d/b,e/c)*g);if(1>=b)return a;c=[];if(a)for(var h in a)d=a[h],isNaN(d)&&(d=DvtPathUtils.createPathArray(a[h])),c[h]=DvtPathUtils.simplifyPath(d,b);return c}return a};
var DvtThematicMapCategoryWrapper=function(a,b){this.Init(a,b)};DvtObj.createSubclass(DvtThematicMapCategoryWrapper,DvtObj,"DvtThematicMapCategoryWrapper");DvtThematicMapCategoryWrapper.prototype.Init=function(a,b){this._displayable=a;this._category=b};DvtThematicMapCategoryWrapper.prototype.getCategories=function(){return this._category};DvtThematicMapCategoryWrapper.prototype.getDisplayables=function(){return[this._displayable]};
var DvtMapDrillEvent=function(a){this.Init(DvtMapDrillEvent.TYPE);this._drillType=a};DvtObj.createSubclass(DvtMapDrillEvent,DvtBaseComponentEvent,"DvtMapDrillEvent");DvtMapDrillEvent.TYPE="drill";DvtMapDrillEvent.DRILL_UP=0;DvtMapDrillEvent.DRILL_DOWN=1;DvtMapDrillEvent.RESET=2;DvtMapDrillEvent.prototype.getDisclosed=function(){return this._disclosed};DvtMapDrillEvent.prototype.setDisclosed=function(a){this._disclosed=a};DvtMapDrillEvent.prototype.getDrillType=function(){return this._drillType};
DvtMapActionEvent=function(a,b,c){this.Init(DvtMapActionEvent.TYPE);this._clientId=a;this._rowKey=b;this._action=c};DvtObj.createSubclass(DvtMapActionEvent,DvtBaseComponentEvent,"DvtMapActionEvent");DvtMapActionEvent.TYPE="action";DvtMapActionEvent.prototype.getClientId=function(){return this._clientId};DvtMapActionEvent.prototype.getRowKey=function(){return this._rowKey};DvtMapActionEvent.prototype.getAction=function(){return this._action};
var DvtMapLabel=function(a,b,c,d,e,g){this.Init(a,b,c,d,e,g)};DvtObj.createSubclass(DvtMapLabel,DvtOutputText,"DvtMapLabel");
DvtMapLabel.prototype.Init=function(a,b,c,d,e,g){DvtMapLabel.superclass.Init.call(this,a,b,0,0);this._bSupportsVectorEffects=g;this._boundRectangle=[];this.setMouseEnabled(!1);this.alignCenter();this.alignMiddle();this._center=null;this._labelDisplay=d;this._parentContainer=e;if(c&&(this._boundRectangle.push(DvtRectangle.create(c[0])),1<c.length)){this._leaderLines=[];for(b=1;b<c.length;b++)d=c[b],this._boundRectangle.push(DvtRectangle.create(d[0])),d=new DvtPolyline(a,d[1]),d.setPixelHinting(!0),
e=new DvtSolidStroke("#000000"),this._bSupportsVectorEffects&&e.setFixedWidth(!0),d.setStroke(e),this._leaderLines.push(d)}};DvtMapLabel.prototype.addBounds=function(a){this._boundRectangle.push(a)};DvtMapLabel.prototype.hasBounds=function(){return 0<this._boundRectangle.length};
DvtMapLabel.prototype.update=function(a){for(var a=a.getA(),b=-1,c=DvtTextUtils.guessTextDimensions(this),d=!1,e=0;e<this._boundRectangle.length;e++){var g=this._boundRectangle[e].w*a;if(c.w<=g){b=e;break}else if(this.getParent()||(d=!0,this._parentContainer.addChild(this)),this.getDimensions().w<=g){b=e;break}}-1==b&&"on"==this._labelDisplay&&(b=this._boundRectangle.length-1);this._currentState!=b?(-1==b?this.reset():(this.getParent()||this._parentContainer.addChild(this),c=this._boundRectangle[b].getCenter(),
this.setCenter(c),this._leaderLines&&(this._parentContainer.removeChild(this._leaderLine),this._leaderLine=null,0<b?(this._leaderLine=this._leaderLines[b-1],this._parentContainer.addChild(this._leaderLine),d=this.getCSSStyle(),d.setStyle(DvtCSSStyle.COLOR,"#000000"),this.setCSSStyle(d),d=this._boundRectangle[b],e=this._leaderLine.getPoints(),g=e.length,d.x>e[g-2]?(this.alignLeft(),this.alignMiddle(),this.setCenter(new DvtPoint(d.x,c.y))):d.y>e[g-1]?(this.alignTop(),this.alignCenter(),this.setCenter(new DvtPoint(c.x,
d.y))):d.x+d.w<e[g-2]?(this.alignRight(),this.alignMiddle(),this.setCenter(new DvtPoint(d.x+d.w,c.y))):d.y+d.h<e[g-1]&&(this.alignBottom(),this.alignCenter(),this.setCenter(new DvtPoint(c.x,d.y+d.h)))):(this.alignCenter(),this.alignMiddle(),d=this.getCSSStyle(),d.setStyle(DvtCSSStyle.COLOR,this._labelColor),this.setCSSStyle(d)))),this._currentState=b):-1==b&&d&&this._parentContainer.removeChild(this);-1!=this._currentState&&(b=new DvtMatrix,b.translate(a*this._center.x-this._center.x,a*this._center.y-
this._center.y),this.setMatrix(b),this._leaderLine&&(this._leaderLine.setMatrix(new DvtMatrix(a,0,0,a)),this._bSupportsVectorEffects||(b=this._leaderLine.getStroke().clone(),b.setWidth(1/a),this._leaderLine.setStroke(b))))};DvtMapLabel.prototype.setCenter=function(a){this._center=a;this.setX(a.x);this.setY(a.y)};DvtMapLabel.prototype.getLeaderLine=function(){return this._leaderLine};DvtMapLabel.prototype.getCenter=function(){return this._center};
DvtMapLabel.prototype.setCSSStyle=function(a){DvtMapLabel.superclass.setCSSStyle.call(this,a);this._labelColor||(this._labelColor=a.getStyle(DvtCSSStyle.COLOR))};DvtMapLabel.prototype.reset=function(){this._parentContainer.removeChild(this);this._currentState=-1;this._leaderLine&&(this._parentContainer.removeChild(this._leaderLine),this._leaderLine=null)};var DvtMapDataObject=function(a,b,c,d,e){this.Init(a,b,c,d,e)};DvtObj.createSubclass(DvtMapDataObject,DvtContainer,"DvtMapDataObject");
DvtMapDataObject.prototype.Init=function(a,b,c,d,e){DvtMapDataObject.superclass.Init.call(this,a,null,d);this._categories=[];this.Shape=null;this._id=c;this._clientId=d;this.AreaId=e;this._selectionLayer=null;this._datatipColor="#000000";this.Zoom=1;this._hasAction=!1;this._dataLayer=b};DvtMapDataObject.prototype.getId=function(){return this._id};DvtMapDataObject.prototype.getClientId=function(){return this._clientId};DvtMapDataObject.prototype.getAreaId=function(){return this.AreaId};
DvtMapDataObject.prototype.setDisplayable=function(a){(this.Shape=a)&&this.Shape.setAriaRole("img")};DvtMapDataObject.prototype.setCenter=function(a){this.Center=a};DvtMapDataObject.prototype.getCenter=function(){return this.Center};DvtMapDataObject.prototype.getDisplayable=function(){return this.Shape};DvtMapDataObject.prototype.setLabel=function(a){this.Label=a};DvtMapDataObject.prototype.getLabel=function(){return this.Label};
DvtMapDataObject.prototype.setLabelPosition=function(a){this.LabelPos=a};DvtMapDataObject.prototype.setHasAction=function(a){this._hasAction=a};DvtMapDataObject.prototype.hasAction=function(){return this._hasAction};DvtMapDataObject.prototype.setAction=function(a){this._action=a};DvtMapDataObject.prototype.getAction=function(){return this._action};DvtMapDataObject.prototype.setVisible=function(a){DvtMapDataObject.superclass.setVisible.call(this,a);this.Label&&this.Label.setVisible(a)};
DvtMapDataObject.prototype.getDisplayables=function(){return[this.Shape]};DvtMapDataObject.prototype.getCategories=function(){return this._categories};DvtMapDataObject.prototype.addCategory=function(a){this._categories.push(a)};DvtMapDataObject.prototype.getDatatip=function(){return this._datatip};DvtMapDataObject.prototype.getDatatipColor=function(){return this._datatipColor};DvtMapDataObject.prototype.setDatatipColor=function(a){this._datatipColor=a;this.Shape&&this.Shape.setDataColor&&this.Shape.setDataColor(a)};
DvtMapDataObject.prototype.setDatatip=function(a){this._datatip=a;this.Shape&&this.Shape.setAriaProperty("label",a)};DvtMapDataObject.prototype.isSelectable=function(){return this.Shape.isSelectable()};DvtMapDataObject.prototype.isSelected=function(){return this.Shape.isSelected()};DvtMapDataObject.prototype.showHoverEffect=function(){};DvtMapDataObject.prototype.hideHoverEffect=function(){this._isShowingKeyboardFocusEffect||this.HideHoverEffect()};DvtMapDataObject.prototype.HideHoverEffect=function(){};
DvtMapDataObject.prototype.setShowPopupBehaviors=function(a){this._showPopupBehaviors=a};DvtMapDataObject.prototype.getShowPopupBehaviors=function(){return this._showPopupBehaviors};DvtMapDataObject.prototype.isDragAvailable=function(a){for(var b=this._dataLayer.getClientId(),c=0;c<a.length&&!(a[c]==b);c++);return b};DvtMapDataObject.prototype.getDataLayer=function(){return this._dataLayer};DvtMapDataObject.prototype.getDragTransferable=function(){return this._dataLayer.__getDragTransferable(this)};
DvtMapDataObject.prototype.getDragFeedback=function(){return this._dataLayer.__getDragFeedback()};DvtMapDataObject.prototype.getNextNavigable=function(a){return a.type==DvtMouseEvent.CLICK?this:a.keyCode==DvtKeyboardEvent.SPACE&&a.ctrlKey?this:DvtKeyboardHandler.getNextAdjacentNavigable(this,a,this.GetNavigables())};DvtMapDataObject.prototype.GetNavigables=function(){return null};
DvtMapDataObject.prototype.getKeyboardBoundingBox=function(){return this.Shape&&this.Shape.getParent()?this.Shape.getDimensions():new DvtRectangle(0,0,0,0)};DvtMapDataObject.prototype.showKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!0;this.showHoverEffect()};DvtMapDataObject.prototype.hideKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect&&(this._isShowingKeyboardFocusEffect=!1,this.hideHoverEffect())};DvtMapDataObject.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect};
DvtMapDataObject.prototype.HandleZoomEvent=function(a){this.Shape.getParent()&&(this.Zoom=a.getA(),this.recenter())};DvtMapDataObject.prototype.PositionLabel=function(){};DvtMapDataObject.prototype.recenter=function(){};var DvtMapDataArea=function(a,b,c,d,e){this.Init(a,b,c,d,e)};DvtObj.createSubclass(DvtMapDataArea,DvtMapDataObject,"DvtMapDataArea");DvtMapDataArea.prototype.Init=function(a,b,c,d,e){DvtMapDataArea.superclass.Init.call(this,a,b,c,d,e);this._isHoverEffectShowing=!1};
DvtMapDataArea.prototype.setDisplayable=function(a){DvtMapDataArea.superclass.setDisplayable.call(this,a)};DvtMapDataArea.prototype.setAreaLayer=function(a){this._dataAreaLayer=a};DvtMapDataArea.prototype.setSelected=function(a){a&&!this._isHoverEffectShowing&&this._dataAreaLayer.addChild(this.Shape);this.Shape.setSelected(a)};DvtMapDataArea.prototype.showHoverEffect=function(){this._dataAreaLayer.addChild(this.Shape);this.Shape.showHoverEffect();this._isHoverEffectShowing=!0};
DvtMapDataArea.prototype.HideHoverEffect=function(){this.isSelected()?this._dataAreaLayer.addChild(this.Shape):this._dataAreaLayer.addChildAt(this.Shape,0);this.Shape.hideHoverEffect();this._isHoverEffectShowing=!1};DvtMapDataArea.prototype.isDrilled=function(){return this.Shape.isDrilled()};DvtMapDataArea.prototype.setDrilled=function(a){(this._isDrilled=a)?this._dataAreaLayer.addChild(this.Shape):this._dataAreaLayer.addChildAt(this.Shape,0);this.Shape.setDrilled(a)};
DvtMapDataArea.prototype.HandleZoomEvent=function(a){this.Shape.getParent()&&(DvtMapDataArea.superclass.HandleZoomEvent.call(this,a),this.Shape.handleZoomEvent(a),this.isDrilled()||this.PositionLabel(a))};DvtMapDataArea.prototype.PositionLabel=function(a){this.Label&&this.Label.update(a)};DvtMapDataArea.prototype.GetNavigables=function(){return this.getDataLayer().getMap().getNavigableAreas()};var DvtMapDataMarker=function(a,b,c,d,e){this.Init(a,b,c,d,e)};DvtMapDataMarker.DEFAULT_MARKER_ALPHA=1;
DvtMapDataMarker.DEFAULT_MARKER_SIZE=8;DvtMapDataMarker.DEFAULT_MARKER_SHAPE="c";DvtMapDataMarker.DEFAULT_MARKER_SCALE=1;DvtObj.createSubclass(DvtMapDataMarker,DvtMapDataObject,"DvtMapDataMarker");DvtMapDataMarker.prototype.Init=function(a,b,c,d,e){DvtMapDataMarker.superclass.Init.call(this,a,b,c,d,e);this.InitCanvasZoom=1;this._size=0};DvtMapDataMarker.prototype.setSelected=function(a){this.Shape.setSelected(a)};DvtMapDataMarker.prototype.showHoverEffect=function(){this.Shape.showHoverEffect()};
DvtMapDataMarker.prototype.HideHoverEffect=function(){this.Shape.hideHoverEffect()};
DvtMapDataMarker.prototype.PositionLabel=function(){if(this.Label){this.Label.alignCenter();var a=(this.Shape.getX()+this.Shape.getScaledWidth()/2)*this.Zoom,b=this.Shape.getY()*this.Zoom,c=this.Shape.getScaledHeight(),d=this.Shape.getType();"top"==this.LabelPos?(b-=4,this.Label.alignBottom()):"bottom"==this.LabelPos?(b+=c,this.Label.alignTop()):(b=d==DvtMarker.TRIANGLE_UP?b+2*c/3:d==DvtMarker.TRIANGLE_DOWN?b+c/3:b+c/2,this.Label.alignMiddle());this.Label.setX(a);this.Label.setY(b)}};
DvtMapDataMarker.prototype.recenter=function(){var a=this.Shape.getParent(),b=this.Shape.getScaledWidth(),c=this.Shape.getScaledHeight();null!=b&&null!=c&&a&&(b=this.Shape.getRotation(),this.Label&&this.Shape.getRotation()?(a.setTranslate(this.Center.x*this.Zoom-this.Center.x,this.Center.y*this.Zoom-this.Center.y),DvtAgent.workaroundFirefoxRepaint(a)):(a=this.Center.x*Math.cos(b)-this.Center.y*Math.sin(b),b=this.Center.x*Math.sin(b)+this.Center.y*Math.cos(b),this.Shape.setTranslate(this.Center.x*
this.Zoom-a,this.Center.y*this.Zoom-b),DvtAgent.workaroundFirefoxRepaint(this.Shape)))};DvtMapDataMarker.prototype.GetNavigables=function(){return this.getDataLayer().getMap().getNavigableObjects()};DvtMapDataMarker.prototype.setSize=function(a){this._size=a};DvtMapDataMarker.prototype.getSize=function(){return this._size};var DvtMapDataImage=function(a,b,c,d,e){this.Init(a,b,c,d,e)};DvtObj.createSubclass(DvtMapDataImage,DvtMapDataObject,"DvtMapDataImage");
DvtMapDataImage.prototype.Init=function(a,b,c,d,e){DvtMapDataImage.superclass.Init.call(this,a,b,c,d,e)};DvtMapDataImage.prototype.onImageLoaded=function(a){a&&a.width&&a.height&&(this.Shape.getWidth()||this.Shape.setWidth(a.width),this.Shape.getHeight()||this.Shape.setHeight(a.height),this.setSize(a.width*a.height),this.Shape.setX(this.Center.x-a.width/2),this.Shape.setY(this.Center.y-a.height/2),this.recenter())};
DvtMapDataImage.prototype.recenter=function(){var a=this.Shape.getWidth(),b=this.Shape.getHeight();null!=a&&null!=b&&this.Shape.getParent()&&(a=this.Shape.getX()+a/2,b=this.Shape.getY()+b/2,this.Shape.setTranslate(a*this.Zoom-this.Center.x,b*this.Zoom-this.Center.y))};DvtMapDataImage.prototype.setSize=function(a){this._size=a};DvtMapDataImage.prototype.getSize=function(){return this._size};var DvtMapArea=function(a,b,c,d){this.Init(a,b,c,d)};DvtObj.createSubclass(DvtMapArea,DvtContainer,"DvtMapArea");
DvtMapArea._DEFAULT_STROKE_WIDTH=1;DvtMapArea.prototype.Init=function(a,b,c,d){DvtMapArea.superclass.Init.call(this,a);this._isSelected=this._bSelectable=!1;this._areaName=c;this._shape=b;this.addChild(this._shape);this._bSupportsVectorEffects=d;if(a=b.getStroke())this._areaStrokeWidth=a.getWidth();this._shape&&this._shape.setAriaRole("img")};DvtMapArea.prototype.getAreaName=function(){return this._areaName};DvtMapArea.prototype.getTooltip=function(){return this._tooltip};
DvtMapArea.prototype.setTooltip=function(a){this._tooltip=a;this._shape&&this._shape.setAriaProperty("label",a)};DvtMapArea.prototype.getStroke=function(){return this._shape instanceof DvtShape?this._shape.getStroke():null};DvtMapArea.prototype.setStroke=function(a){this._shape instanceof DvtShape&&this._shape.setStroke(a)};DvtMapArea.prototype.setFill=function(a){this._shape instanceof DvtShape&&this._shape.setFill(a)};
DvtMapArea.prototype.getFill=function(){return this._shape instanceof DvtShape?this._shape.getFill():null};DvtMapArea.prototype.getCmds=function(){return this._shape instanceof DvtPath?this._shape.getCmds():null};DvtMapArea.prototype.setCmds=function(a){this._shape instanceof DvtPath&&this._shape.setCmds(a)};DvtMapArea.prototype.setSrc=function(a){this._shape instanceof DvtImage&&this._shape.setSrc(a)};DvtMapArea.prototype.getDropSiteFeedback=function(){return this._shape.copyShape()};
DvtMapArea.prototype.contains=function(a,b){var c=this.getDimensions();return a>=c.x&&a<=c.x+c.w&&b>=c.y&&b<=c.y+c.h};DvtMapArea.prototype.HandleZoomEvent=function(a){if(!this._bSupportsVectorEffects&&this._shape&&this._areaStrokeWidth){var b=this._shape.getStroke().clone();b.setWidth(this._areaStrokeWidth/a.getA());this._shape.setStroke(b)}};var DvtMapLayer=function(a,b){this.Init(a,b)};DvtObj.createSubclass(DvtMapLayer,DvtObj,"DvtMapLayer");
DvtMapLayer.prototype.Init=function(a,b){this._tmap=a;this.LayerName="cities";this.ClientId=null;this.EventHandler=b;this.DataLayers={};this.PzcMatrix=new DvtMatrix};DvtMapLayer.prototype.addDataLayer=function(a){this.DataLayers[a.getClientId()]=a};DvtMapLayer.prototype.PreDataLayerUpdate=function(){};DvtMapLayer.prototype.PostDataLayerUpdate=function(){};
DvtMapLayer.prototype.updateDataLayer=function(a,b){this._animation&&(this._animationStopped=!0,this._animation.stop(!0));this.PzcMatrix=b;this._oldDataLayer=this.getDataLayer(a.getClientId());this.addDataLayer(a);a.render(this.PzcMatrix);a.HandleZoomEvent(new DvtZoomEvent(DvtZoomEvent.SUBTYPE_ZOOMED),this.PzcMatrix);if(this._oldDataLayer){var c=a.getAnimation(),d=a.getAnimationDuration();if(DvtBlackBoxAnimationHandler.isSupported(c)){for(var e=new DvtRectangle(0,0,this._tmap.GetWidth(),this._tmap.GetHeight()),
g=this._oldDataLayer.getNonScaledContainers(),h=0;h<g.length;h++){var k=new DvtRect(this._tmap.getCtx(),0,0,this._tmap.GetWidth(),this._tmap.GetHeight());k.setFill(null);g[h].addChild(k)}for(var m=a.getNonScaledContainers(),h=0;h<m.length;h++)k=new DvtRect(this._tmap.getCtx(),0,0,this._tmap.GetWidth(),this._tmap.GetHeight()),k.setFill(null),m[h].addChild(k);e=DvtBlackBoxAnimationHandler.getCombinedAnimation(this._tmap.getCtx(),c,g,m,e,d);g=new DvtRectangle(0,0,this._tmap.GetWidth()/this.PzcMatrix.getA(),
this._tmap.GetHeight()/this.PzcMatrix.getA());m=this._oldDataLayer.getScaledContainers();for(h=0;h<m.length;h++)k=new DvtRect(this._tmap.getCtx(),0,0,this._tmap.GetWidth()/this.PzcMatrix.getA(),this._tmap.GetHeight()/this.PzcMatrix.getA()),k.setFill(null),m[h].addChild(k);for(var n=a.getScaledContainers(),h=0;h<n.length;h++)k=new DvtRect(this._tmap.getCtx(),0,0,this._tmap.GetWidth()/this.PzcMatrix.getA(),this._tmap.GetHeight()/this.PzcMatrix.getA()),k.setFill(null),n[h].addChild(k);h=DvtBlackBoxAnimationHandler.getCombinedAnimation(this._tmap.getCtx(),
c,m,n,g,d);this._animation=new DvtParallelPlayable(this._tmap.getCtx(),[e,h])}else{c=this._oldDataLayer.getContainers();for(h=0;h<c.length;h++)c[h].getParent().removeChild(c[h]);this.PostDataLayerUpdate()}if(this._animation){this.EventHandler.removeListeners(this._callbackObj);var o=this;this._animation.setOnEnd(function(){o.OnAnimationEnd(a)},this);this.PreDataLayerUpdate();this._animation.play()}}else this.PostDataLayerUpdate(),this._tmap.OnUpdateLayerEnd()};
DvtMapLayer.prototype.getDataLayers=function(){return this.DataLayers};DvtMapLayer.prototype.getDataLayer=function(a){return this.DataLayers?this.DataLayers[a]:null};DvtMapLayer.prototype.getClientId=function(){return this.ClientId};DvtMapLayer.prototype.getLayerName=function(){return this.LayerName};DvtMapLayer.prototype.render=function(a){this.PzcMatrix=a;for(var b in this.DataLayers)this.DataLayers[b].render(a)};
DvtMapLayer.prototype.reset=function(a,b){for(var c in this.DataLayers)this.DataLayers[c].reset(a,b)};DvtMapLayer.prototype.HandleZoomEvent=function(a,b){this.PzcMatrix=b;for(var c in this.DataLayers)this.DataLayers[c].HandleZoomEvent(a,b)};DvtMapLayer.prototype.HandlePanEvent=function(a){this.PzcMatrix=a;for(var b in this.DataLayers)this.DataLayers[b].HandlePanEvent(a)};
DvtMapLayer.prototype.OnAnimationEnd=function(a){if(this._oldDataLayer)for(var b=this._oldDataLayer.getContainers(),c=0;c<b.length;c++){var d=b[c].getParent();d&&d.removeChild(b[c])}b=a.getNonScaledContainers();for(c=0;c<b.length;c++)b[c].removeChildAt(b[c].getNumChildren()-1);a=a.getScaledContainers();for(c=0;c<a.length;c++)a[c].removeChildAt(a[c].getNumChildren()-1);this.PostDataLayerUpdate();this._tmap.OnUpdateLayerEnd();this._animationStopped=!1;this._animation=null;this.EventHandler.addListeners(this._callbackObj)};
var DvtMapAreaLayer=function(a,b,c,d,e,g){this.Init(a,b,c,d,e,g)};DvtObj.createSubclass(DvtMapAreaLayer,DvtMapLayer,"DvtMapAreaLayer");DvtMapAreaLayer._SHORT_NAME=0;DvtMapAreaLayer._LONG_NAME=1;
DvtMapAreaLayer.prototype.Init=function(a,b,c,d,e,g){DvtMapAreaLayer.superclass.Init.call(this,a,g);this._labelDisplay=d;this.LayerName=b;this.ClientId=c;this._labelType=e;this._areaLabels={};this.Areas={};this.AreaShapes={};this._labelInfo=this.AreaNames=null;this._disclosed=[];this._renderArea={};this._renderLabel={};this._renderedLabels={};this.AreaContainer=new DvtContainer(this._tmap.getCtx());this.LabelContainer=new DvtContainer(this._tmap.getCtx());this._tmap.getAreaLayerContainer().addChildAt(this.AreaContainer,
0);this._tmap.getLabelContainer().addChildAt(this.LabelContainer,0);this._dropTarget=new DvtThematicMapDropTarget(this,this._tmap.getMapName())};DvtMapAreaLayer.prototype.setAnimation=function(a){this._animType=a};DvtMapAreaLayer.prototype.getAnimation=function(){return this._animType};DvtMapAreaLayer.prototype.setAnimationDuration=function(a){this._animDur=a};DvtMapAreaLayer.prototype.getAnimationDuration=function(){return this._animDur};DvtMapAreaLayer.prototype.getDropTarget=function(){return this._dropTarget};
DvtMapAreaLayer.prototype.getLabelType=function(){return this._labelType};DvtMapAreaLayer.prototype.setAreaShapes=function(a){this.AreaShapes=a};DvtMapAreaLayer.prototype.setAreaNames=function(a){this.AreaNames=a;for(var b in this.AreaNames)this.setAreaRendered(b,!0),this.setLabelRendered(b,!0)};DvtMapAreaLayer.prototype.getShortAreaName=function(a){return this.AreaNames[a][DvtMapAreaLayer._SHORT_NAME]};DvtMapAreaLayer.prototype.getLongAreaName=function(a){return this.AreaNames[a][DvtMapAreaLayer._LONG_NAME]};
DvtMapAreaLayer.prototype.setAreaLabelInfo=function(a){this._labelInfo=a};DvtMapAreaLayer.prototype.getLabelInfoForArea=function(a){return!this._labelInfo?null:this._labelInfo[a]};DvtMapAreaLayer.prototype.setAreaChildren=function(a){this._children=a};DvtMapAreaLayer.prototype.getChildrenForArea=function(a){return this._children[a]?this._children[a].split(","):[]};DvtMapAreaLayer.prototype.getArea=function(a){return this.Areas[a]};DvtMapAreaLayer.prototype.getAreaShape=function(a){return this.AreaShapes[a]};
DvtMapAreaLayer.prototype.getLabelDisplay=function(){return this._labelDisplay};DvtMapAreaLayer.prototype.setDropSiteCSSStyle=function(a){this._dropSiteCSSStyle=a};DvtMapAreaLayer.prototype.setLayerCSSStyle=function(a){this._layerCSSStyle=a};DvtMapAreaLayer.prototype.getLayerCSSStyle=function(){return this._layerCSSStyle};DvtMapAreaLayer.prototype.setAreaHoverStyle=function(a){this._areaHoverStyle=a};DvtMapAreaLayer.prototype.getAreaHoverStyle=function(){return this._areaHoverStyle};
DvtMapAreaLayer.prototype.setAreaSelectStyle=function(a){this._areaSelectStyle=a};DvtMapAreaLayer.prototype.getAreaSelectStyle=function(){return this._areaSelectStyle};DvtMapAreaLayer.prototype.setAreaDiscloseStyle=function(a){this._areaDiscloseStyle=a};DvtMapAreaLayer.prototype.getAreaDiscloseStyle=function(){return this._areaDiscloseStyle};DvtMapAreaLayer.prototype.setAreaRendered=function(a,b){this._renderArea[a]=b};
DvtMapAreaLayer.prototype.setLabelRendered=function(a,b){this._renderLabel[a]=b};DvtMapAreaLayer.prototype.setIsolatedArea=function(a){this._isolatedArea=a;this._layerDim=null;for(var b in this.AreaShapes)b!=a&&(this._renderArea[b]=!1)};
DvtMapAreaLayer.prototype.getLayerDim=function(){this._layerDim||(this._isolatedArea?this._layerDim=DvtPathUtils.getDimensions(DvtPathUtils.createPathArray(DvtBaseMapManager.getPathForArea(this._tmap.getMapName(),this.LayerName,this._isolatedArea))):("world"!=this._tmap.getMapName()&&"worldRegions"!=this._tmap.getMapName()&&(this._layerDim=DvtBaseMapManager.getBaseMapDim(this._tmap.getMapName(),this.LayerName)),this._layerDim||(this._layerDim=this.AreaContainer.getDimensions().getUnion(this._tmap.getDataAreaContainer().getDimensions()))));
return this._layerDim};
DvtMapAreaLayer.prototype._createAreaAndLabel=function(a,b){var c=this.AreaShapes[a];if(c){(b||!this.Areas[a])&&this.updateAreaShape(a);if(!this.Areas[a]){var d=this._tmap.getCtx(),d=new DvtMapArea(d,c,a,this._tmap.supportsVectorEffects());this.Areas[a]=d;this.EventHandler.associate(c,d);d.setTooltip(this.AreaNames&&this.AreaNames[a]?this.AreaNames[a][DvtMapAreaLayer._LONG_NAME]:null)}if(this._renderLabel[a]&&(d=this._areaLabels[a],!d&&"off"!=this._labelDisplay&&this.AreaNames&&(d="short"==this._labelType?
this.AreaNames[a][DvtMapAreaLayer._SHORT_NAME]:this.AreaNames[a][DvtMapAreaLayer._LONG_NAME])))this._labelInfo&&this._labelInfo[a]?d=new DvtMapLabel(this._tmap.getCtx(),d,this._labelInfo[a],this._labelDisplay,this.LabelContainer,this._tmap.supportsVectorEffects()):(c=DvtDisplayableUtils.getDimensionsForced(this._tmap.getCtx(),c),d=new DvtMapLabel(this._tmap.getCtx(),d,[[c.x,c.y,c.w,c.h]],this._labelDisplay,this.LabelContainer,this._tmap.supportsVectorEffects())),this._areaLabels[a]=d,this._layerCSSStyle&&
d.setCSSStyle(this._layerCSSStyle)}};DvtMapAreaLayer.prototype._addAreaAndLabel=function(a,b){if(this.AreaShapes[a]){this.AreaContainer.addChild(this.Areas[a]);var c=this._areaLabels[a];c&&(this._renderLabel[a]?c.update(this.PzcMatrix):c.reset(),this._renderedLabels[a]=this._renderLabel[a]);b&&(b.push(this.Areas[a]),c&&(b.push(c),b.push(c.getLeaderLine())))}};
DvtMapAreaLayer.prototype.updateAreaShape=function(a){if(!this._paths||this._bUpdateShapesForRender){this._bUpdateShapesForRender=!1;var b;this._paths=(b="world"==this._tmap.getMapName()||"worldRegions"==this._tmap.getMapName()?DvtBaseMapManager.getBaseMapDim(this._tmap.getMapName(),this.LayerName):this.getLayerDim())?DvtBaseMapManager.simplifyAreaPaths(DvtBaseMapManager.getAreaPaths(this._tmap.getMapName(),this.LayerName),b.w,b.h,this._tmap.GetWidth(),this._tmap.GetHeight(),this._tmap.getMaxZoomFactor()):
DvtBaseMapManager.getAreaPaths(this._tmap.getMapName(),this.LayerName)}b=this._paths[a];this.AreaShapes[a]&&b?this.AreaShapes[a].setCmds(b):delete this.AreaShapes[a]};DvtMapAreaLayer.prototype.resetRenderedAreas=function(){for(var a in this.AreaNames)this.setAreaRendered(a,!0),this.setLabelRendered(a,!0)};
DvtMapAreaLayer.prototype.updateDataLayer=function(a,b,c){DvtMapAreaLayer.superclass.updateDataLayer.call(this,a,b,c);if(c==this.getLayerName())for(var d in this.AreaShapes)this._createAreaAndLabel(d,!0),this._renderArea[d]&&this._addAreaAndLabel(d)};DvtMapAreaLayer.prototype.render=function(a){this._bUpdateShapesForRender=!0;for(var b in this.AreaShapes)this._createAreaAndLabel(b,!0),this._renderArea[b]&&this._addAreaAndLabel(b);DvtMapAreaLayer.superclass.render.call(this,a)};
DvtMapAreaLayer.prototype.PreDataLayerUpdate=function(){for(var a in this._renderArea)this._renderArea[a]||(this._createAreaAndLabel(a,!1),this._addAreaAndLabel(a))};DvtMapAreaLayer.prototype.PostDataLayerUpdate=function(){for(var a in this._renderArea)if(!this._renderArea[a]){this.AreaContainer.removeChild(this.Areas[a]);var b=this._areaLabels[a];b&&(this._renderedLabels[a]=!1,this.LabelContainer.removeChild(b),(b=b.getLeaderLine())&&this.LabelContainer.removeChild(b))}};
DvtMapAreaLayer.prototype._renderSelectedAreasAndLabels=function(a,b){for(var c=0;c<a.length;c++)this._createAreaAndLabel(a[c],!1),this._renderArea[a[c]]&&this._addAreaAndLabel(a[c],b)};DvtMapAreaLayer.prototype.discloseAreas=function(a,b){this._renderSelectedAreasAndLabels(a,b);for(var c in this.DataLayers)this.DataLayers[c].discloseAreas(a,b,this.PzcMatrix);this._disclosed=this._disclosed.concat(a)};
DvtMapAreaLayer.prototype.undiscloseAreas=function(a,b){for(var c in this.DataLayers)this.DataLayers[c].undiscloseAreas(a,b);c=this._tmap.getDrillChildLayer(this.LayerName);for(var d=0;d<a.length;d++){var e=a[d];if(this.Areas[e]){var g=DvtArrayUtils.getIndex(this._disclosed,e);-1!==g&&(this._disclosed.splice(g,1),b.push(this.Areas[e]))}c&&c.undiscloseAreas(this.getChildrenForArea(e),b)}};
DvtMapAreaLayer.prototype.reset=function(a,b){DvtMapAreaLayer.superclass.reset.call(this,a,b);"none"!=this._tmap.getDrillMode()&&(this.undiscloseAreas(this._disclosed,a),this._disclosed=[])};DvtMapAreaLayer.prototype.__getObjectUnderPoint=function(a,b){for(var c in this.Areas)if(this.Areas[c].contains(a,b))return this.Areas[c];return null};
DvtMapAreaLayer.prototype.__showDropSiteFeedback=function(a){this._dropSiteFeedback&&(this.AreaContainer.removeChild(this._dropSiteFeedback),this._dropSiteFeedback=null);if(a&&(this._dropSiteFeedback=a.getDropSiteFeedback()))this._dropSiteFeedback.setFill(new DvtSolidFill(this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BACKGROUND_COLOR))),a=this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BORDER_WIDTH)?this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BORDER_WIDTH).substring(0,this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BORDER_WIDTH).indexOf("px")):
1,this._tmap.supportsVectorEffects()||(a/=this.PzcMatrix.getA()),a=new DvtSolidStroke(this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BORDER_COLOR),1,a),this._tmap.supportsVectorEffects()&&a.setFixedWidth(!0),this._dropSiteFeedback.setStroke(a),this.AreaContainer.addChild(this._dropSiteFeedback);return this._dropSiteFeedback};
DvtMapAreaLayer.prototype.HandleZoomEvent=function(a,b){DvtMapAreaLayer.superclass.HandleZoomEvent.call(this,a,b);if(!this._tmap.supportsVectorEffects())for(var c in this.Areas)this.Areas[c].HandleZoomEvent(b);for(c in this._renderedLabels)if(this._renderedLabels[c]){var d=this._areaLabels[c];d&&d.update(b)}};var DvtMapCustomAreaLayer=function(a,b,c,d,e,g){this.Init(a,b,c,d,e,g)};DvtObj.createSubclass(DvtMapCustomAreaLayer,DvtMapAreaLayer,"DvtMapCustomAreaLayer");
DvtMapCustomAreaLayer.prototype.Init=function(a,b,c,d,e,g){DvtMapCustomAreaLayer.superclass.Init.call(this,a,b,c,d,e,g)};DvtMapCustomAreaLayer.prototype.updateAreaShape=function(){};DvtMapCustomAreaLayer.prototype.getLayerDim=function(){return new DvtRectangle(0,0,this._layerWidth,this._layerHeight)};
DvtMapCustomAreaLayer.prototype._selectImageBasedOnResolution=function(){for(var a=this._tmap.GetWidth(),b=this._tmap.GetHeight(),c=this._areaLayerImages,d=0;d<c.length;d++){var e=c[d],g=e.source,h=e.width,e=e.height;if(g&&-1<g.search(".svg")||h>=a&&e>=b||d==c.length-1)return g}};
DvtMapCustomAreaLayer.prototype.setAreaLayerImage=function(a){var b=null,c=DvtAgent.isRightToLeft(this._tmap.getCtx());if(a&&0<a.length){var b=a[0].width,d=a[0].height;this._layerWidth=b;this._layerHeight=d;for(var e=[],g=0;g<a.length;g++)c&&"rtl"==a[g].dir?e.push(a[g]):!c&&"ltr"==a[g].dir&&e.push(a[g]);this._areaLayerImages=0<e.length?e:a;this._imageSrc=this._selectImageBasedOnResolution();b=new DvtImage(this._tmap.getCtx(),this._imageSrc,0,0,b,d)}b&&(this.setAreaNames({image:[null,null]}),this.setAreaShapes({image:b}))};
DvtMapCustomAreaLayer.prototype.HandleZoomEvent=function(a,b){DvtMapCustomAreaLayer.superclass.HandleZoomEvent.call(this,a,b);if(this.Areas.image){var c=this._selectImageBasedOnResolution();c!=this._imageSrc&&(this._imageSrc=c,this.Areas[areaName].setSrc(this._imageSrc))}};var DvtMapDataLayer=function(a,b,c,d){this.Init(a,b,c,d)};DvtObj.createSubclass(DvtMapDataLayer,DvtObj,"DvtMapDataLayer");
DvtMapDataLayer.prototype.Init=function(a,b,c,d){this._tmap=a;this._clientId=c;this._areaObjs=[];this._dataObjs=[];this._eventHandler=d;this._dragSource=new DvtDragSource(a.getCtx());this._eventHandler.setDragSource(this._dragSource);this._dataAreaLayer=new DvtContainer(this._tmap.getCtx());this._dataPointLayer=new DvtContainer(this._tmap.getCtx());this._dataLabelLayer=new DvtContainer(this._tmap.getCtx());this._tmap.getDataAreaContainer().addChildAt(this._dataAreaLayer,0);this._tmap.getDataPointContainer().addChildAt(this._dataPointLayer,
0);this._tmap.getLabelContainer().addChildAt(this._dataLabelLayer,0);this._parentLayer=b;this._disclosed=[];this._drilled=[]};DvtMapDataLayer.prototype.getDragSource=function(){return this._dragSource};DvtMapDataLayer.prototype.getContainers=function(){return[this._dataAreaLayer,this._dataPointLayer,this._dataLabelLayer]};DvtMapDataLayer.prototype.getScaledContainers=function(){return[this._dataAreaLayer]};
DvtMapDataLayer.prototype.getNonScaledContainers=function(){var a=[this._dataLabelLayer];this._tmap.isMarkerZoomBehaviorFixed()&&a.push(this._dataPointLayer);return a};DvtMapDataLayer.prototype.getDataLabelContainer=function(){return this._dataLabelLayer};DvtMapDataLayer.prototype.getMapLayer=function(){return this._parentLayer};DvtMapDataLayer.prototype.getMap=function(){return this._tmap};DvtMapDataLayer.prototype.getAllObjects=function(){return this._dataObjs.concat(this._areaObjs)};
DvtMapDataLayer.prototype.getAreaObjects=function(){return this._areaObjs};DvtMapDataLayer.prototype.getDataObjects=function(){return this._dataObjs};DvtMapDataLayer.prototype.getNavigableAreaObjects=function(){for(var a=[],b=0;b<this._areaObjs.length;b++)this._areaObjs[b].isDrilled()||a.push(this._areaObjs[b]);return a};
DvtMapDataLayer.prototype.getNavigableDisclosedAreaObjects=function(){for(var a=[],b=0;b<this._areaObjs.length;b++)for(var c=0;c<this._disclosed.length;c++)this._areaObjs[b].getAreaId()==this._disclosed[c]&&(this._areaObjs[b].isDrilled()||a.push(this._areaObjs[b]));return a};DvtMapDataLayer.prototype.addDataObject=function(a){this._dataObjs.push(a);this._eventHandler.associate(a.getDisplayable(),a)};
DvtMapDataLayer.prototype.addAreaObject=function(a){this._areaObjs.push(a);this._eventHandler.associate(a.getDisplayable(),a);a.setAreaLayer(this._dataAreaLayer)};DvtMapDataLayer.prototype._removeAreaObject=function(a){a=this._areaObjs.indexOf(a);-1!==a&&this._areaObjs.splice(a,1)};DvtMapDataLayer.prototype.getClientId=function(){return this._clientId};DvtMapDataLayer.prototype.setAnimation=function(a){this._animType=a};DvtMapDataLayer.prototype.getAnimation=function(){return this._animType};
DvtMapDataLayer.prototype.setAnimationDuration=function(a){this._animDur=a};DvtMapDataLayer.prototype.getAnimationDuration=function(){return this._animDur};DvtMapDataLayer.prototype.setSelectionMode=function(a){if(this._selectionMode=a)this._selectionHandler=new DvtSelectionHandler(this._selectionMode),this._eventHandler.setSelectionHandler(this._clientId,this._selectionHandler)};DvtMapDataLayer.prototype.isSelectable=function(){return null!=this._selectionMode};
DvtMapDataLayer.prototype.setIsolatedAreaRowKey=function(a){this._isolatedAreaRowKey=a};DvtMapDataLayer.prototype._updateAreaShape=function(a){var b=a.getDisplayable(),c=this._parentLayer.getAreaShape(a.getAreaId());if(c)return b.setCmds(c.getCmds()),!0;this._removeAreaObject(a);return!1};
DvtMapDataLayer.prototype._renderAreaAndLabel=function(a){if(this._updateAreaShape(this._areaObjs[a])){var b=this._areaObjs[a].getDisplayable();this._dataAreaLayer.addChild(b);if(a=this._areaObjs[a].getLabel())a.hasBounds()||(b=b.getDimensions(),a.addBounds(b)),a.update(this._pzcMatrix);return!0}return!1};
DvtMapDataLayer.prototype.render=function(a){this._bFixPatterns=!0;this._pzcMatrix=a;var b={};this._dataObjs.sort(function(a,b){return a.getSize()<b.getSize()?1:a.getSize()>b.getSize()?-1:0});for(var c=0;c<this._dataObjs.length;c++){var d=this._dataObjs[c],e=d.getDisplayable(),g=d.getLabel();if(g){if(e.getRotation()){var h=new DvtContainer(e.getCtx());this._dataPointLayer.addChild(h);h.addChild(e);h.addChild(g)}else this._dataPointLayer.addChild(e),e.addChild(g);d.PositionLabel(a)}else this._dataPointLayer.addChild(e);
(d=d.getAreaId())&&(b[d]=!0)}for(c=0;c<this._areaObjs.length;c++)b[this._areaObjs[c].getAreaId()]&&this._areaObjs[c].setLabel(null),this._renderAreaAndLabel(c)||c--;this._initSelections&&this._processInitialSelections()};
DvtMapDataLayer.prototype.discloseAreas=function(a,b,c){this._pzcMatrix=c;for(var d=[],e=0;e<a.length;e++)for(var g=0;g<this._areaObjs.length;g++)if(this._areaObjs[g].getAreaId()==a[e]){d.push(this._areaObjs[g].getAreaId());this._renderAreaAndLabel(g);var h=this._areaObjs[g].getDisplayable();b.push(h);h.handleZoomEvent(c);if(g=this._areaObjs[g].getLabel())b.push(g),(g=g.getLeaderLine())&&b.push(g);break}for(g=0;g<this._dataObjs.length;g++)for(e=0;e<a.length;e++)c=this._dataObjs[g].getAreaId(),h=this._dataObjs[g].getDisplayable(),
null!=c?c==a[e]&&(this._dataPointLayer.addChild(h),b.push(h)):(this._dataPointLayer.addChild(h),b.push(h));this._disclosed=this._disclosed.concat(d)};
DvtMapDataLayer.prototype.undiscloseAreas=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<this._areaObjs.length;d++)if(this._areaObjs[d].getAreaId()==a[c]){this._areaObjs[d].isDrilled()&&this._areaObjs[d].setDrilled(!1);this._areaObjs[d].isSelected()&&this._selectionHandler.removeFromSelection(this._areaObjs[d]);var e=DvtArrayUtils.getIndex(this._disclosed,a[c]);if(-1<e&&(this._disclosed.splice(e,1),b.push(this._areaObjs[d].getDisplayable()),d=this._areaObjs[d].getLabel()))b.push(d),b.push(d.getLeaderLine());
break}};DvtMapDataLayer.prototype.drill=function(a,b){for(var c=0;c<this._areaObjs.length;c++)if(this._areaObjs[c].getAreaId()==a){this._areaObjs[c].setDrilled(!0);this._drilled.push(a);b.push(this._areaObjs[c].getDisplayable());if(c=this._areaObjs[c].getLabel())b.push(c),(c=c.getLeaderLine())&&b.push(c);break}for(c=0;c<this._dataObjs.length;c++)if(this._dataObjs[c].getAreaId()==a){b.push(this._dataObjs[c].getDisplayable());break}};
DvtMapDataLayer.prototype.undrill=function(a,b){for(var c=0;c<this._areaObjs.length;c++)if(this._areaObjs[c].getAreaId()==a){this._drilled.splice(DvtArrayUtils.getIndex(this._drilled,a),1);this._areaObjs[c].setDrilled(!1);var d=this._areaObjs[c].getDisplayable();this._dataAreaLayer.addChild(d);b.push(d);if(c=this._areaObjs[c].getLabel())c.update(this._pzcMatrix),b.push(c),b.push(c.getLeaderLine());break}for(c=0;c<this._dataObjs.length;c++)if(this._dataObjs[c].getAreaId()==a){d=this._dataObjs[c].getDisplayable();
this._dataPointLayer.addChild(d);b.push(d);break}};
DvtMapDataLayer.prototype.reset=function(a,b){if(this._selectionHandler)for(var c=this._selectionHandler.getSelection(),d=0;d<c.length;d++)(!b||b&&-1==DvtArrayUtils.getIndex(b,c[d].getAreaId()))&&this._selectionHandler.removeFromSelection(c[d]);if("none"!=this._tmap.getDrillMode())for(c=0;c<this._drilled.length;c++){for(d=0;d<this._areaObjs.length;d++)if(this._areaObjs[d].getAreaId()==this._drilled[c]){this._areaObjs[d].setDrilled(!1);var e=this._areaObjs[d].getDisplayable();this._dataAreaLayer.addChild(e);
a.push(e);if(d=this._areaObjs[d].getLabel())d.update(this._pzcMatrix),a.push(d),a.push(d.getLeaderLine());break}for(d=0;d<this._dataObjs.length;d++)if(this._dataObjs[d].getAreaId()==this._drilled[c]){e=this._dataObjs[d].getDisplayable();this._dataPointLayer.addChild(e);a.push(e);break}}this._drilled=[]};
DvtMapDataLayer.prototype.HandleZoomEvent=function(a,b){this._pzcMatrix=b;var c=b.getA(),d=a.getSubType();if(this._bFixPatterns&&d==DvtZoomEvent.SUBTYPE_ZOOMED){this._bFixPatterns=!1;for(d=0;d<this._areaObjs.length;d++){var e=this._areaObjs[d].getDisplayable(),g=e.getSavedPatternFill();if(g){var h=new DvtPatternFill;g.mergeProps(h);h.setMatrix(new DvtMatrix(1/c,null,null,1/c));e.setFill(h)}}}d=this.getAreaObjects();for(c=0;c<d.length;c++)d[c].HandleZoomEvent(b);if(this._tmap.isMarkerZoomBehaviorFixed()){d=
this.getDataObjects();for(c=0;c<d.length;c++)d[c].HandleZoomEvent(b)}};DvtMapDataLayer.prototype.HandlePanEvent=function(a){this._pzcMatrix=a};DvtMapDataLayer.prototype.setInitialSelections=function(a){this._initSelections=a};DvtMapDataLayer.prototype._processInitialSelections=function(){this._selectionHandler&&(this._selectionHandler.processInitialSelections(this._initSelections,this.getAllObjects()),this._initSelections=null)};
DvtMapDataLayer.prototype.__getDragTransferable=function(a){if(this._selectionHandler){a.isSelected()||(this._selectionHandler.processClick(a,!1),this._eventHandler.fireSelectionEvent(a));for(var a=[],b=this._selectionHandler.getSelection(),c=0;c<b.length;c++)a.push(b[c].getId());return a}return null};DvtMapDataLayer.prototype.__getDragFeedback=function(){for(var a=[],b=this._selectionHandler.getSelection(),c=0;c<b.length;c++)a.push(b[c].getDisplayable());return a};
DvtMapDataLayer.prototype.getSelectedAreas=function(a){for(var b=[],c=this.getAreaObjects(),d=0;d<a.length;d++)for(var e=0;e<c.length;e++)if(c[e].getId()==a[d]){b.push(c[e].getAreaId());break}return b};var DvtThematicMapKeyboardHandler=function(a,b){this.Init(a,b)};DvtObj.createSubclass(DvtThematicMapKeyboardHandler,DvtPanZoomCanvasKeyboardHandler,"DvtThematicMapKeyboardHandler");
DvtThematicMapKeyboardHandler.prototype.Init=function(a,b){DvtThematicMapKeyboardHandler.superclass.Init(a,b);this._tmap=a};DvtThematicMapKeyboardHandler.prototype.isSelectionEvent=function(a){return this.isNavigationEvent(a)&&!a.ctrlKey};
DvtThematicMapKeyboardHandler.prototype.processKeyDown=function(a){var b=a.keyCode;if(b==DvtKeyboardEvent.CLOSE_BRACKET){var b=this._eventManager.getFocus(),c=this._tmap.getNavigableObjects();b instanceof DvtMapDataArea&&0<c.length&&(b=DvtKeyboardHandler.getNextAdjacentNavigable(b,a,c));this._eventManager.setFocus(b);this._eventManager.SetClickInfo(b)}else b==DvtKeyboardEvent.OPEN_BRACKET?(b=this._eventManager.getFocus(),c=this._tmap.getNavigableAreas(),!(b instanceof DvtMapDataArea)&&0<c.length&&
(b=DvtKeyboardHandler.getNextAdjacentNavigable(b,a,c)),this._eventManager.setFocus(b),this._eventManager.SetClickInfo(b)):(b=DvtThematicMapKeyboardHandler.superclass.processKeyDown.call(this,a),this.isNavigationEvent(a)&&!a.ctrlKey&&this._eventManager.SetClickInfo(b));return b};DvtThematicMapKeyboardHandler.prototype.isMultiSelectEvent=function(a){return a.keyCode==DvtKeyboardEvent.SPACE&&a.ctrlKey};
DvtThematicMapKeyboardHandler.prototype.isNavigationEvent=function(a){var b=DvtThematicMapKeyboardHandler.superclass.isNavigationEvent.call(this,a);if(!b&&(a=a.keyCode,a==DvtKeyboardEvent.OPEN_BRACKET||a==DvtKeyboardEvent.CLOSE_BRACKET))b=!0;return b};var DvtThematicMapEventManager=function(a,b,c){this.Init(a,b,c)};DvtObj.createSubclass(DvtThematicMapEventManager,DvtEventManager,"DvtThematicMapEventManager");
DvtThematicMapEventManager.prototype.Init=function(a,b,c){DvtThematicMapEventManager.superclass.Init.call(this,a,b,c);this._selectionHandlers={};this._tmap=c;this._bDragged=!1};DvtThematicMapEventManager.prototype.getSelectionHandler=function(a){if(a&&a.getDataLayer)return this._selectionHandlers[a.getDataLayer().getClientId()]};DvtThematicMapEventManager.prototype.setSelectionHandler=function(a,b){this._selectionHandlers[a]=b};
DvtThematicMapEventManager.prototype.setDrillMode=function(a){this._drillMode=a};DvtThematicMapEventManager.prototype.setPanZoomCanvas=function(a){this._pzc=a};DvtThematicMapEventManager.prototype.removeFromSelection=function(a,b){var c=this._selectionHandlers[a];c&&c.removeFromSelection(b)};DvtThematicMapEventManager.prototype.clearSelection=function(a){(a=this._selectionHandlers[a])&&a.clearSelection()};
DvtThematicMapEventManager.prototype.setInitialFocus=function(a){a&&DvtThematicMapEventManager.superclass.setFocus.call(this,a)};DvtThematicMapEventManager.prototype.OnMouseOver=function(a){var b=this.GetLogicalObject(a.target);b&&b.getShowPopupBehaviors&&b.getDataLayer&&this._tmap.setEventClientId(b.getDataLayer().getClientId());DvtThematicMapEventManager.superclass.OnMouseOver.call(this,a)};
DvtThematicMapEventManager.prototype.OnMouseDown=function(a){this._bDragged=!1;DvtThematicMapEventManager.superclass.OnMouseDown.call(this,a)};DvtThematicMapEventManager.prototype.OnMouseMove=function(a){this._bDragged=!0;DvtThematicMapEventManager.superclass.OnMouseMove.call(this,a)};
DvtThematicMapEventManager.prototype.OnClick=function(a){if(!this._bDragged){var b=this.GetLogicalObject(a.target);this.SetClickInfo(b);if(!b||!b.isSelectable||!b.isSelectable())for(var c in this._selectionHandlers)if(this._selectionHandlers[c].processClick(null,a.ctrlKey)){var d=new DvtSelectionEvent([]);d.addParam("clientId",c);this._callback.call(this._callbackObj,d)}DvtThematicMapEventManager.superclass.OnClick.call(this,a);this._handleClick(b)}};
DvtThematicMapEventManager.prototype._handleClick=function(a){if(a instanceof DvtMapDataObject)if(a.hasAction()){var b=new DvtMapActionEvent(a.getClientId(),a.getId(),a.getAction());b.addParam("clientId",a.getDataLayer().getClientId());this.hideTooltip();this._callback.call(this._callbackObj,b)}else a.getShowPopupBehaviors()&&this._tmap.setEventClientId(a.getDataLayer().getClientId())};
DvtThematicMapEventManager.prototype.SetClickInfo=function(a){var b=null,c=null,d=null;a&&(a instanceof DvtMapDataObject?d=a.getDisplayable():a instanceof DvtMapArea&&(d=a),a.getDataLayer&&(a=a.getDataLayer(),b=a.getClientId(),c=a.getMapLayer().getLayerName()));this._tmap.setClickInfo(b,c,d)};
DvtThematicMapEventManager.prototype.OnDblClick=function(a){DvtThematicMapEventManager.superclass.OnDblClick.call(this,a);this.getSelectionHandler(this.GetLogicalObject(a.target))&&this._drillMode&&"none"!=this._drillMode&&this._callback.call(this._callbackObj,new DvtMapDrillEvent(DvtMapDrillEvent.DRILL_DOWN))};
DvtThematicMapEventManager.prototype.ProcessKeyboardEvent=function(a){var b=!0,c=a.keyCode;(c==DvtKeyboardEvent.ZERO||c==DvtKeyboardEvent.NUMPAD_ZERO)&&a.ctrlKey&&a.shiftKey?(this._tmap.resetMap(),a.preventDefault()):c==DvtKeyboardEvent.BACK_SLASH?((c=this._tmap.getLegendPanel())&&(c instanceof DvtCollapsiblePanel?c.setCollapsed(!c.isCollapsed()):c instanceof DvtPanelDrawer&&c.setDisclosed(!c.isDisclosed())),a.preventDefault()):c==DvtKeyboardEvent.ENTER?(a.shiftKey?this._tmap.drillUp():this._tmap.drillDown(),
a.preventDefault()):c==DvtKeyboardEvent.SPACE&&a.ctrlKey?(c=this.getFocus(),this.SetClickInfo(c),this.ProcessSelectionEventHelper(c,!0),a.preventDefault()):(c==DvtKeyboardEvent.ZERO||c==DvtKeyboardEvent.NUMPAD_ZERO)&&a.ctrlKey?(c=this.getFocus(),a.altKey?this._tmap.fitRegion(c.getDisplayable()):this._tmap.fitSelectedRegions(),a.preventDefault()):b=DvtThematicMapEventManager.superclass.ProcessKeyboardEvent.call(this,a);return b};
DvtThematicMapEventManager.prototype.OnComponentTouchClick=function(a){var b=this.GetLogicalObject(a.target);this.SetClickInfo(b);if(!b||b.isClearSelection)for(var c in this._selectionHandlers)if(this._selectionHandlers[c].processClick(null,a.ctrlKey)){for(var d=this._selectionHandlers[c].getSelection(),e=[],g=0;g<d.length;g++)e.push(d[g].getId());this._callback.call(this._callbackObj,new DvtSelectionEvent(e))}DvtThematicMapEventManager.superclass.OnComponentTouchClick.call(this,a);this._handleClick(b)};
DvtThematicMapEventManager.prototype.HandleTouchHoverOverInternal=function(a){(a=this.GetLogicalObject(a.target))&&a.getShowPopupBehaviors&&a.getDataLayer&&this._tmap.setEventClientId(a.getDataLayer().getClientId())};DvtThematicMapEventManager.prototype.OnComponentTouchDblClick=function(a){var b=this.GetLogicalObject(a.target);b&&this.getSelectionHandler(b)&&this._drillMode&&"none"!=this._drillMode&&(this.ProcessSelectionEventHelper(b,a.ctrlKey),this._callback.call(this._callbackObj,new DvtMapDrillEvent(DvtMapDrillEvent.DRILL_DOWN)))};
var DvtThematicMapParser=function(a){this.Init(a)};DvtObj.createSubclass(DvtThematicMapParser,DvtObj,"DvtThematicMapParser");DvtThematicMapParser._ELEM_MAP_PROPERTIES="mapProperties";DvtThematicMapParser._ELEM_LAYERS="layers";DvtThematicMapParser._ELEM_LAYER="layer";DvtThematicMapParser._ELEM_POINTS="points";DvtThematicMapParser._ELEM_POINT="point";DvtThematicMapParser._ELEM_LEGEND="legend";DvtThematicMapParser._ELEM_RESOURCES="resources";DvtThematicMapParser._ELEM_MAP_HIERARCHY="mapHierarchy";
DvtThematicMapParser._ELEM_MENUS="menus";DvtThematicMapParser.ELEM_COLOR_STYLES="colorStyles";DvtThematicMapParser.ELEM_GRADUATED_SYMBOL="graduatedSymbol";DvtThematicMapParser.ELEM_IMAGE="image";DvtThematicMapParser._ELEM_MARKER_DEF="markerDef";DvtThematicMapParser._ELEM_ROW="row";DvtThematicMapParser._ELEM_CUSTOM_LAYER="customLayer";DvtThematicMapParser._ELEM_AREA_LAYER="areaLayer";DvtThematicMapParser._ELEM_POINT_LAYER="pointLayer";DvtThematicMapParser._ELEM_SPB="spb";
DvtThematicMapParser._ELEM_CUSTOM_REGION="customRegion";DvtThematicMapParser._ELEM_P="p";DvtThematicMapParser._ELEM_STYLES="styles";DvtThematicMapParser._ELEM_REGION_LAYER="regionLayer";DvtThematicMapParser._ELEM_MARKER_STYLE="markerStyle";DvtThematicMapParser._ELEM_TMAP_RESOURCES="tmapResources";DvtThematicMapParser._ATTR_ANIM_DATA_CHANGE="animationDataChange";DvtThematicMapParser._ATTR_ANIM_ON_LAYER_CHANGE="animationOnLayerChange";DvtThematicMapParser.ATTR_ID="id";
DvtThematicMapParser._ATTR_CLIENT_ID="clientId";DvtThematicMapParser._ATTR_SELECTION_MODE="selectionMode";DvtThematicMapParser._ATTR_STYLE_ID="styleId";DvtThematicMapParser._ATTR_LAYER_NAME="layerName";DvtThematicMapParser._ATTR_LABEL="label";DvtThematicMapParser._ATTR_LABEL_DISPLAY="labelDisplay";DvtThematicMapParser._ATTR_LABEL_TYPE="labelType";DvtThematicMapParser._ATTR_LABEL_POSITION="labelPosition";DvtThematicMapParser._ATTR_ROW_KEY="rowKey";DvtThematicMapParser._ATTR_GROUP_ID="groupID";
DvtThematicMapParser._ATTR_SHORT_NAME="shortName";DvtThematicMapParser._ATTR_LONG_NAME="longName";DvtThematicMapParser._ATTR_PATH="d";DvtThematicMapParser._ATTR_ALIGN_ID="alignId";DvtThematicMapParser._ATTR_SHOW_WITH="showWith";DvtThematicMapParser._ATTR_SUB_REGIONS="subRegions";DvtThematicMapParser._ATTR_INLINE_STYLE="inlineStyle";DvtThematicMapParser._ATTR_HOVER_STYLE="hoverStyle";DvtThematicMapParser._ATTR_SELECT_STYLE="selectStyle";DvtThematicMapParser._ATTR_DISCLOSED_STYLE="disclosedStyle";
DvtThematicMapParser._ATTR_LABEL_STYLE="labelStyle";DvtThematicMapParser._ATTR_DROP_SITE_STYLE="dropTargetStyle";DvtThematicMapParser._ATTR_BASEMAP_NAME="baseMapName";DvtThematicMapParser._ATTR_ANIM_ON_DISP="animationOnDisplay";DvtThematicMapParser._ATTR_ANIM_ON_MAP_CHANGE="animationOnMapChange";DvtThematicMapParser._ATTR_ANIM_DUR="animationDuration";DvtThematicMapParser._ATTR_ANIM_ON_MAP_CHANGE="animationOnMapChange";DvtThematicMapParser._ATTR_ANIM_ON_DRILL="animationOnDrill";
DvtThematicMapParser._ATTR_DRILL_ZOOM_TO_FIT="drillZoomToFit";DvtThematicMapParser._ATTR_DRILL_MODE="drillMode";DvtThematicMapParser._ATTR_INITIAL_ZOOMING="initialZooming";DvtThematicMapParser._ATTR_CTRLPANEL_BEHAVIOR="controlPanelBehavior";DvtThematicMapParser._ATTR_TOOLTIP_DISPLAY="displayTooltips";DvtThematicMapParser._ATTR_FEATURES_OFF="featuresOff";DvtThematicMapParser._ATTR_LOCALE_L2R="localeL2R";DvtThematicMapParser._ATTR_CENTER_X="centerX";DvtThematicMapParser._ATTR_CENTER_Y="centerY";
DvtThematicMapParser._ATTR_CUR_ZOOM="curZoom";DvtThematicMapParser._ATTR_IS_FLASH_POSITION="isFlashPosition";DvtThematicMapParser._ATTR_INLINE_STYLE="inlineStyle";DvtThematicMapParser._ATTR_ISOLATED_ROW_KEY="isolatedRowKey";DvtThematicMapParser._ATTR_SOURCE="source";DvtThematicMapParser._ATTR_ZOOMING="zooming";DvtThematicMapParser._ATTR_PANNING="panning";DvtThematicMapParser._ATTR_EXTENDS_LAYER="extendsLayer";DvtThematicMapParser._SEMICOLON=";";
DvtThematicMapParser.prototype.Init=function(a){this._tmap=a;this._customMarkerDefs={};this._areaDiscloseStyle=this._areaSelectStyle=this._areaHoverStyle=this._areaLayerStyle=null;this._isMobile=DvtAgent.isTouchDevice()};
DvtThematicMapParser.prototype.loadXmlInitial=function(a){for(var a=a.getChildNodes(),b,c,d=0;d<a.length;d++)b=a[d],c=b.getName(),c==DvtThematicMapParser._ELEM_MAP_PROPERTIES?this.ParseMapProperties(b):c==DvtThematicMapParser._ELEM_CUSTOM_LAYER?this.ParseCustomRegionLayer(b):c==DvtThematicMapParser._ELEM_LAYERS?this.ParseDataLayers(b):c==DvtThematicMapParser._ELEM_LEGEND&&this.ParseLegend(b)};
DvtThematicMapParser.prototype.ParseMapProperties=function(a){this._setMapProps(a);this._tmap.parseComponentAttrs(a);for(var a=a.getChildNodes(),b,c,d=0;d<a.length;d++)if(b=a[d],c=b.getName(),c==DvtThematicMapParser._ELEM_RESOURCES)this.ParseResources(b);else if(c==DvtThematicMapParser._ELEM_MAP_HIERARCHY)this.ParseMapHierarchy(b);else if("panZoomCanvasProperties"==c)this.ParsePanZoomResources(b);else if(c==DvtThematicMapParser._ELEM_REGION_LAYER){if(c=b.getAttr(DvtThematicMapParser._ATTR_INLINE_STYLE))this._areaLayerStyle=
new DvtCSSStyle(c);if(c=b.getAttr(DvtThematicMapParser._ATTR_HOVER_STYLE))this._areaHoverStyle=new DvtCSSStyle(c);if(c=b.getAttr(DvtThematicMapParser._ATTR_SELECT_STYLE))this._areaSelectStyle=new DvtCSSStyle(c);if(c=b.getAttr(DvtThematicMapParser._ATTR_DISCLOSED_STYLE))this._areaDiscloseStyle=new DvtCSSStyle(c)}else c==DvtThematicMapParser._ELEM_MARKER_STYLE?this._tmap.setMarkerStyle(new DvtCSSStyle(b.getAttr(DvtThematicMapParser._ATTR_INLINE_STYLE))):"basemap"==c&&this._tmap.getMapName()=="$"+b.getAttr(DvtThematicMapParser.ATTR_ID)&&
this.ParseCustomBasemap(b)};
DvtThematicMapParser.prototype.ParseDataLayers=function(a,b,c){var d=a.getElementsByTagName(DvtThematicMapParser._ELEM_LAYER),a=a.getElementsByTagName(DvtThematicMapParser._ELEM_LEGEND);b&&a&&a[0]&&this.ParseLegend(a[0]);for(a=0;a<d.length;a++){var e=d[a].getAttr(DvtThematicMapParser._ATTR_CLIENT_ID),g=d[a].getAttr(DvtThematicMapParser.ATTR_ID),h=this._tmap.getLayer(g);h?h instanceof DvtMapAreaLayer&&h.resetRenderedAreas():(h=d[a].getAttr(DvtThematicMapParser._ATTR_SHOW_WITH))?h=this._tmap.getLayer(h):
(h=new DvtMapLayer(this._tmap,this._tmap.getEventHandler()),this._tmap.addPointLayer(h));var e=new DvtMapDataLayer(this._tmap,h,e,this._tmap.getEventHandler()),k=d[a].getAttr(DvtThematicMapParser._ATTR_SELECTION_MODE);"single"==k?e.setSelectionMode(DvtSelectionHandler.TYPE_SINGLE):"multiple"==k&&e.setSelectionMode(DvtSelectionHandler.TYPE_MULTIPLE);if(k=d[a].getAttr(DvtThematicMapParser._ATTR_ANIM_DATA_CHANGE)){var m=d[a].getAttr(DvtThematicMapParser._ATTR_ANIM_DUR);m&&(m=parseFloat(m));if(!m||isNaN(m))m=
1;e.setAnimation(k);e.setAnimationDuration(m)}k=null;h instanceof DvtMapAreaLayer&&(k=d[a].getAttr(DvtThematicMapParser._ATTR_ISOLATED_ROW_KEY));for(var m=[],n=[],o=this._parseStyles(d[a].getElementsByTagName(DvtThematicMapParser._ELEM_STYLES)),s=d[a].getElementsByTagName(DvtThematicMapParser._ELEM_ROW),t=this._parseShowPopupBehavior(d[a],o),u=0;u<s.length;u++){var v=s[u].getAttr(DvtThematicMapParser._ATTR_STYLE_ID);if(v=this._parseDataObject(h,e,g,s[u],o[v],m,n,k))v.getDisplayable().setSelectable(e.isSelectable()&&
!(v instanceof DvtMapDataImage)),0<t.length&&v.setShowPopupBehaviors(t),v instanceof DvtMapDataArea?e.addAreaObject(v):e.addDataObject(v)}k&&this._isolatedArea&&(e.setIsolatedAreaRowKey(k),h.setIsolatedArea(this._isolatedArea));e.isSelectable()&&0<m.length&&e.setInitialSelections(m);0<n.length&&this._tmap.addDrilledLayer(h.getLayerName(),[e.getClientId(),n]);b||h.getDataLayer(e.getClientId())?h.updateDataLayer(e,b,c):h.addDataLayer(e)}};DvtThematicMapParser.prototype.ParseLegend=function(a){this._tmap.setLegendXml(a)};
DvtThematicMapParser.prototype.ParseResources=function(a){this._tmap.setResources(a)};
DvtThematicMapParser.prototype.ParseMapHierarchy=function(a){for(var a=a.getChildNodes(),b=this._tmap.getMapName(),c,d,e,g,h=0;h<a.length;h++){var k=a[h];if(k.getName()!=DvtThematicMapParser._ELEM_POINT_LAYER){c=k.getAttr(DvtThematicMapParser._ATTR_LAYER_NAME);d=k.getAttr(DvtThematicMapParser._ATTR_LABEL_DISPLAY);e=k.getAttr(DvtThematicMapParser._ATTR_CLIENT_ID);g=k.getAttr(DvtThematicMapParser._ATTR_LABEL_TYPE);var m=k.getAttr("areaStyle");m&&this._areaLayerStyle.merge(new DvtCSSStyle(m));(m=k.getAttr(DvtThematicMapParser._ATTR_LABEL_STYLE))&&
this._areaLayerStyle.merge(new DvtCSSStyle(m));this._isCustomBasemap?d=new DvtMapCustomAreaLayer(this._tmap,c,e,d,g,this._tmap.getEventHandler()):(d=new DvtMapAreaLayer(this._tmap,c,e,d,g,this._tmap.getEventHandler()),m=DvtBaseMapManager.getAreaNames(b,c),d.setAreaShapes(this._createPathShapes(m)),d.setAreaNames(m),d.setAreaLabelInfo(DvtBaseMapManager.getAreaLabelInfo(b,c)),d.setAreaChildren(DvtBaseMapManager.getChildrenForLayerAreas(this._tmap.getMapName(),c)),d.setAreaHoverStyle(this._areaHoverStyle),
d.setAreaSelectStyle(this._areaSelectStyle),d.setAreaDiscloseStyle(this._areaDiscloseStyle));d.setLayerCSSStyle(this._areaLayerStyle);d.setDropSiteCSSStyle(this._areaDropSiteStyle);if(m=k.getAttr(DvtThematicMapParser._ATTR_ANIM_ON_LAYER_CHANGE)){(c=k.getAttr(DvtThematicMapParser._ATTR_ANIM_DUR))&&(c=parseFloat(c));if(!c||isNaN(c))c=1;d.setAnimation(m);d.setAnimationDuration(c)}d&&this._tmap.addLayer(d)}}};
DvtThematicMapParser.prototype.ParseCustomBasemap=function(a){for(var a=a.getChildNodes(),b,c,d=0;d<a.length;d++)b=a[d],c=b.getName(),c==DvtThematicMapParser._ELEM_LAYER?this._parseCustomLayer(b):c==DvtThematicMapParser._ELEM_POINTS&&this._parseCustomPoints(b)};
DvtThematicMapParser.prototype._parseCustomLayer=function(a){for(var b=a.getChildNodes(),a=a.getAttr(DvtThematicMapParser.ATTR_ID),c,d,e=[],g=0;g<b.length;g++)if(c=b[g],d=c.getName(),d==DvtThematicMapParser.ELEM_IMAGE){d={};d.source=c.getAttr("source");d.width=c.getAttr("width");d.height=c.getAttr("height");var h=c.getAttr("bidi");c=c.getAttr("dir");d.dir="true"==h||"rtl"==c?"rtl":"ltr";e.push(d)}this._tmap.getLayer(a).setAreaLayerImage(e)};
DvtThematicMapParser.prototype._parseCustomPoints=function(a){for(var a=a.getChildNodes(),b,c,d={},e={},g=0;g<a.length;g++)b=a[g],c=b.getName(),c==DvtThematicMapParser._ELEM_POINT&&(d[b.getAttr("name")]=[b.getAttr("x"),b.getAttr("y")],e[b.getAttr("name")]=[null,b.getAttr("longLabel")]);DvtBaseMapManager.registerBaseMapLayer(this._tmap.getMapName(),"cities",e,d,null,null,1)};DvtThematicMapParser.prototype.ParsePanZoomResources=function(a){this._tmap.setPanZoomResources(a)};
DvtThematicMapParser.prototype._createPathShapes=function(a){var b={},c=this._tmap.getCtx(),d;for(d in a)b[d]=new DvtPath(c),this._parseDataObjectFill(DvtThematicMapParser.ELEM_COLOR_STYLES,this._areaLayerStyle,b[d]);return b};
DvtThematicMapParser.prototype._setMapProps=function(a){var b;if(b=a.getAttr(DvtThematicMapParser._ATTR_SOURCE))this._isCustomBasemap=!0;(b=a.getAttr(DvtThematicMapParser._ATTR_BASEMAP_NAME))&&this._tmap.setMapName(this._isCustomBasemap?"$"+b:b);(b=a.getAttr(DvtThematicMapParser._ATTR_ANIM_ON_DISP))&&this._tmap.setAnimationOnDisplay(b);(b=a.getAttr(DvtThematicMapParser._ATTR_ANIM_ON_MAP_CHANGE))&&this._tmap.setAnimationOnMapChange(b);(b=a.getAttr(DvtThematicMapParser._ATTR_ANIM_DUR))&&this._tmap.setAnimationDuration(b);
(b=a.getAttr(DvtThematicMapParser._ATTR_TOOLTIP_DISPLAY))&&this._tmap.setDisplayTooltips(b);if(b=a.getAttr(DvtThematicMapParser._ATTR_DROP_SITE_STYLE))this._areaDropSiteStyle=new DvtCSSStyle(b);(b=a.getAttr(DvtThematicMapParser._ATTR_CTRLPANEL_BEHAVIOR))&&this._tmap.setControlPanelBehavior(b);(b=a.getAttr(DvtThematicMapParser._ATTR_FEATURES_OFF))&&this._tmap.setFeaturesOff(b);(b=a.getAttr(DvtThematicMapParser._ATTR_CENTER_X))&&this._tmap.setInitialCenterX(b);(b=a.getAttr(DvtThematicMapParser._ATTR_CENTER_Y))&&
this._tmap.setInitialCenterY(b);(b=a.getAttr(DvtThematicMapParser._ATTR_CUR_ZOOM))&&this._tmap.setInitialZoom(b);(b=a.getAttr(DvtThematicMapParser._ATTR_ANIM_ON_DRILL))&&this._tmap.setAnimationOnDrill(b);(b=a.getAttr(DvtThematicMapParser._ATTR_DRILL_MODE))&&this._tmap.setDrillMode(b);(b=a.getAttr(DvtThematicMapParser._ATTR_DRILL_ZOOM_TO_FIT))&&this._tmap.setDrillZoomToFit(b);b=a.getAttr(DvtThematicMapParser._ATTR_INITIAL_ZOOMING);"auto"==b&&this._tmap.setInitialZooming(!0);b=a.getAttr(DvtThematicMapParser._ATTR_ZOOMING);
"none"==b&&this._tmap.setZooming(!1);b=a.getAttr(DvtThematicMapParser._ATTR_PANNING);"none"==b&&this._tmap.setPanning(!1);b=parseFloat(a.getAttr("maxZoom"));isNaN(b)||this._tmap.setMaxZoomFactor(b);(b=a.getAttr("markerZoomBehavior"))&&this._tmap.setMarkerZoomBehavior(b)};DvtThematicMapParser.prototype._parseStyles=function(a){var b={};if(a&&0<a.length)for(var a=a[0].getChildNodes(),c=0;c<a.length;c++){var d=a[c].getAttr(DvtThematicMapParser.ATTR_ID);b[d]=a[c]}return b};
DvtThematicMapParser.prototype._parseShowPopupBehavior=function(a,b){for(var c=a.getElementsByTagName(DvtThematicMapParser._ELEM_SPB),d=[],e=0;e<c.length;e++){var g=c[e].getAttr(DvtThematicMapParser._ATTR_ALIGN_ID),h=DvtShowPopupBehavior.newInstance(c[e]),k;for(k in b)if(g==k){h=new DvtShowPopupBehavior(h.getPopupId(),h.getTriggerType(),null,h.getAlign());break}d.push(h)}return d};
DvtThematicMapParser.prototype._parseDataObject=function(a,b,c,d,e,g,h,k){var m=this._tmap.getCtx(),n=d.getAttr(DvtThematicMapParser._ATTR_ROW_KEY),o=d.getAttr(DvtThematicMapParser._ATTR_CLIENT_ID),s=d.getAttr(DvtThematicMapParser.ATTR_ID),t,u=e.getName();if(u==DvtThematicMapParser.ELEM_COLOR_STYLES){if(k){if(k!=n)return null;this._isolatedArea=s}a.setAreaRendered(s,!1);t=new DvtMapDataArea(m,b,n,o,s);this._parseMapArea(m,s,a,d,t)}else u==DvtThematicMapParser.ELEM_GRADUATED_SYMBOL?(t=new DvtMapDataMarker(m,
b,n,o,s),this._parseMapMarker(m,e,c,d,t)):u==DvtThematicMapParser.ELEM_IMAGE&&(t=new DvtMapDataImage(m,b,n,o,s),this._parseMapImage(m,c,d,t));e=t.getDisplayable();if(!e)return null;if(k=parseInt(d.getAttr("rotation")))k=k*Math.PI/180,e.setRotation(k),o=t.getCenter(),e.setTranslate(o.x-(o.x*Math.cos(k)-o.y*Math.sin(k)),o.y-(o.x*Math.sin(k)+o.y*Math.cos(k)));s&&a instanceof DvtMapAreaLayer&&a.setLabelRendered(s,!1);k="true"==d.getAttr("hasAction");t.setHasAction(k);k&&t.setAction(d.getAttr("action"));
if(k=d.getAttr("destination"))o=[],o.destination=k,o.targetFrame="_blank",o.focusable=!0,e.setHyperlink(o);"true"==d.getAttr("selected")&&g.push(n);"true"==d.getAttr("drilled")&&(h.push(d.getAttr(DvtThematicMapParser.ATTR_ID)),this._tmap.addDisclosedRowKey(n));g=d.getAttr(DvtThematicMapParser._ATTR_LABEL);h="off";g?h="on":u==DvtThematicMapParser.ELEM_COLOR_STYLES&&(h=a.getLabelDisplay());!g&&s&&"off"!=h&&(g="long"==a.getLabelType()?a.getLongAreaName(s):a.getShortAreaName(s));if(g){var v;a.getLabelInfoForArea&&
(v=a.getLabelInfoForArea(s));var w;w=v?new DvtMapLabel(m,g,v,h,b.getDataLabelContainer(),this._tmap.supportsVectorEffects()):u!=DvtThematicMapParser.ELEM_COLOR_STYLES?new DvtOutputText(m,g,0,0):new DvtMapLabel(m,g,null,h,b.getDataLabelContainer(),this._tmap.supportsVectorEffects());(b=d.getAttr(DvtThematicMapParser._ATTR_LABEL_POSITION))&&t.setLabelPosition(b);b=new DvtCSSStyle;u==DvtThematicMapParser.ELEM_COLOR_STYLES?b.merge(a.getLayerCSSStyle()):u==DvtThematicMapParser.ELEM_GRADUATED_SYMBOL&&b.merge(this._tmap.getMarkerStyle());
(a=d.getAttr(DvtThematicMapParser._ATTR_LABEL_STYLE))&&b.merge(new DvtCSSStyle(a));w instanceof DvtMapLabel&&(b.getStyle(DvtCSSStyle.COLOR)||b.setStyle(DvtCSSStyle.COLOR,DvtColorUtils.getContrastingTextColor(t.getDatatipColor())));w.setCSSStyle(b)}t.setLabel(w);w=this._tmap.getDisplayTooltips();if("none"!=w){d=d.getAttr("shortDesc");if("auto"==w){var z;s&&(z="cities"==c||this._isCustomBasemap?DvtBaseMapManager.getCityLabel(this._tmap.getMapName(),s):DvtBaseMapManager.getLongAreaLabel(this._tmap.getMapName(),
c,s));z&&(d=d?z+": "+d:z)}d&&t.setDatatip(d)}return t};DvtThematicMapParser.prototype._parseCenter=function(a,b,c){var d=this._tmap.getMapName(),e=b.getAttr(DvtThematicMapParser.ATTR_ID);if(e)return c?DvtBaseMapManager.getAreaCenter(d,a,e):DvtBaseMapManager.getCityCoordinates(d,e);a=parseFloat(b.getAttr("x"));b=parseFloat(b.getAttr("y"));return new DvtPoint(a,b)};
DvtThematicMapParser.prototype._parseMapImage=function(a,b,c,d){var e=c.getAttr("url"),g=null;if(b=this._parseCenter(b,c,"cities"!=b)){g=new DvtImage(a,e);d.setCenter(b);d.setDisplayable(g);var h,k;if(c=c.getAttr(DvtThematicMapParser._ATTR_INLINE_STYLE))k=new DvtCSSStyle(c),(h=k.getStyle("width").substring(0,k.getStyle("width").indexOf("px")))&&g.setWidth(h),(k=k.getStyle("height").substring(0,k.getStyle("height").indexOf("px")))&&g.setHeight(k),null!=h&&null!=k&&(g.setX(b.x-h/2),g.setY(b.y-k/2),
d.setSize(h*k));(!h||!k)&&DvtImageLoader.loadImage(a,e,DvtObj.createCallback(d,d.onImageLoaded))}};
DvtThematicMapParser.prototype._parseMapArea=function(a,b,c,d,e){if(c.getAreaShape(b)){var b=new DvtCSSStyle(d.getAttr(DvtThematicMapParser._ATTR_INLINE_STYLE)),a=new DvtDrillablePath(a,this._tmap.supportsVectorEffects()),g=c.getAreaHoverStyle(),d=c.getAreaSelectStyle(),c=c.getAreaDiscloseStyle(),g=new DvtSolidStroke(g.getStyle(DvtCSSStyle.BORDER_COLOR),1,DvtDrillablePath.HOVER_STROKE_WIDTH),h=new DvtSolidStroke(d.getStyle(DvtCSSStyle.INNER_COLOR),1,DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH),d=
new DvtSolidStroke(d.getStyle(DvtCSSStyle.OUTER_COLOR),1,DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH);a.setHoverStroke(g,null).setSelectedStroke(h,d);c&&(d=new DvtSolidStroke(c.getStyle(DvtCSSStyle.INNER_COLOR),1,DvtDrillablePath.DISCLOSED_INNER_STROKE_WIDTH),c=new DvtSolidStroke(c.getStyle(DvtCSSStyle.OUTER_COLOR),1,DvtDrillablePath.DISCLOSED_OUTER_STROKE_WIDTH),a.setDisclosedStroke(d,c));e.setDisplayable(a);this._parseDataObjectFill(DvtThematicMapParser.ELEM_COLOR_STYLES,b,a,e)}};
DvtThematicMapParser.prototype._parseMapMarker=function(a,b,c,d,e){var g=null;if(c=this._parseCenter(c,d,"cities"!=c)){if(g=d.getAttr(DvtThematicMapParser._ATTR_SOURCE))g=[g,d.getAttr("sourceSelected"),d.getAttr("sourceHover"),d.getAttr("sourceHoverSelected")];else if(g=d.getAttr("shapeType"),g||(g=DvtMapDataMarker.DEFAULT_MARKER_SHAPE),!DvtMarker.isBuiltInShape(g))for(var b=b.getElementsByTagName(DvtThematicMapParser._ELEM_MARKER_DEF),h=0;h<b.length;h++)!this._customMarkerDefs[g]&&b[h].getAttr(DvtThematicMapParser.ATTR_ID)==
g&&(this._customMarkerDefs[g]=DvtMarkerUtils.createMarkerDef(a,b[h]));var b=d.getAttr("scaleX"),b=isNaN(b)?DvtMapDataMarker.DEFAULT_MARKER_SCALE:parseFloat(b),h=d.getAttr("scaleY"),h=isNaN(h)?DvtMapDataMarker.DEFAULT_MARKER_SCALE:parseFloat(h),k=d.getAttr("width"),m=d.getAttr("height"),k=!k||isNaN(k)?DvtMapDataMarker.DEFAULT_MARKER_SIZE:parseInt(k),m=!m||isNaN(m)?DvtMapDataMarker.DEFAULT_MARKER_SIZE:parseInt(m),n,o;n=c.x-k*b/2;o=c.y-m*h/2;g=new DvtMarker(a,g,this._tmap.getSkinName(),n,o,k,m,null,
b,h);e.setCenter(c);e.setDisplayable(g);e.setSize(k*b*m*h);if(a=d.getAttr(DvtThematicMapParser._ATTR_INLINE_STYLE))a=new DvtCSSStyle(a),this._parseDataObjectFill(DvtThematicMapParser.ELEM_GRADUATED_SYMBOL,a,g,e)}};
DvtThematicMapParser.prototype._parseDataObjectFill=function(a,b,c,d){b||(b={});var e=b.getStyle("pattern"),g=b.getStyle("pattern-color"),h=b.getStyle("background-color"),k=this._isMobile||this._tmap.getSkinName()==DvtCSSStyle.SKIN_ALTA?!1:b.getStyle("gradient");h&&d?d.addCategory(h):g&&d&&d.addCategory(g);var m;m=b.getStyle("opacity")?parseFloat(b.getStyle("opacity")):a==DvtThematicMapParser.ELEM_GRADUATED_SYMBOL?DvtMapDataMarker.DEFAULT_MARKER_ALPHA:1;d&&d.setDatatipColor(h?h:g);if(a==DvtThematicMapParser.ELEM_GRADUATED_SYMBOL&&
DvtMarker.isBuiltInShape(c.getType())){a=this._tmap.getMarkerStyle();if("none"!=(b.getStyle("border-style")?b.getStyle("border-style"):a.getStyle("border-style")))d=b.getStyle("border-color")?b.getStyle("border-color"):a.getStyle("border-color"),(b=b.getStyle("border-width")?b.getStyle("border-width"):a.getStyle("border-width"))&&(b=parseFloat(b.substring(0,b.indexOf("px")))),b=new DvtSolidStroke(d,DvtMapDataMarker.DEFAULT_MARKER_ALPHA,b),this._tmap.isMarkerZoomBehaviorFixed()||b.setFixedWidth(!0),
c.setStroke(b);"true"==k&&h?c.setFill(new DvtMarkerGradient.createMarkerGradient(h,c,m)):e?c.setFill(new DvtPatternFill(e,g,h)):h?c.setSolidFill(h,m):c.setSolidFill(a.getStyle("background-color"),m)}else if(a==DvtThematicMapParser.ELEM_COLOR_STYLES){if((k=b.getStyle("border-color"))&&"transparent"!=k)b=new DvtSolidStroke(k),this._tmap.supportsVectorEffects()&&b.setFixedWidth(!0),c.setStroke(b);e?c.savePatternFill(new DvtPatternFill(e,g,h)):h&&"transparent"!=h?c.setSolidFill(h,m):c.setFill(null)}};
var DvtThematicMapJsonParser=function(a){this.Init(a)};DvtObj.createSubclass(DvtThematicMapJsonParser,DvtObj,"DvtThematicMapJsonParser");DvtThematicMapJsonParser.prototype.Init=function(a){this._tmap=a;this._isCustomBasemap=!1;this._areaLayerStyle=null;this._isMobile=DvtAgent.isTouchDevice();this._customAreaLayerImages={}};
DvtThematicMapJsonParser.prototype.parse=function(a){a.skin="alta";this.ParseMapProperties(a);this.ParseStyles(a.styleDefaults);if(this._isCustomBasemap){var b=(new DvtXmlParser(this._tmap.getCtx())).parse(a.sourceXml);b&&this.ParseCustomBasemap(b)}this.ParseAreaLayers(a.areaLayers);this.ParseDataLayers(a.pointDataLayers,null,!1)};
DvtThematicMapJsonParser.prototype.ParseMapProperties=function(a){this._tmap.setAnimationDuration(a.animationDuration/1E3);this._tmap.setAnimationOnDisplay("auto"==a.animationOnDisplay?"alphaFade":a.animationOnDisplay);this._tmap.setAnimationOnMapChange("auto"==a.animationOnMapChange?"alphaFade":a.animationOnMapChange);this._isCustomBasemap=null!=a.source;this._tmap.setMapName(this._isCustomBasemap?"$"+a.basemap:a.basemap);this._tmap.setControlPanelBehavior(a.controlPanelBehavior);this._tmap.setDrillMode("none");
this._tmap.setInitialZooming("auto"==a.initialZooming);this._tmap.setMarkerZoomBehavior(a.markerZoomBehavior);this._tmap.setPanning("auto"==a.panning);var b=a.tooltipDisplay;"shortDesc"==b?b="shortDescOnly":"labelAndShortDesc"==b&&(b="auto");this._tmap.setDisplayTooltips(b);this._tmap.setZooming("auto"==a.zooming)};
DvtThematicMapJsonParser.prototype.ParseAreaLayers=function(a){for(var b=this._tmap.getMapName(),c=0;c<a.length;c++){var d=this._tmap.Defaults.calcAreaLayerOptions(a[c]),e=d.layer;if(e){var g;d.areaStyle&&this._areaLayerStyle.parseInlineStyle(d.areaStyle);if(this._isCustomBasemap)g=new DvtMapCustomAreaLayer(this._tmap,e,null,d.labelDisplay,d.labelType,this._tmap.getEventHandler()),g.setAreaLayerImage(this._customAreaLayerImages[e]);else{g=new DvtMapAreaLayer(this._tmap,e,null,d.labelDisplay,d.labelType,
this._tmap.getEventHandler());var h=DvtBaseMapManager.getAreaNames(b,e);g.setAreaShapes(this._createPathShapes(h));g.setAreaNames(h);g.setAreaLabelInfo(DvtBaseMapManager.getAreaLabelInfo(b,e));g.setAreaChildren(DvtBaseMapManager.getChildrenForLayerAreas(this._tmap.getMapName(),e))}g.setLayerCSSStyle(this._areaLayerStyle);g.setAnimation("auto"==d.animationOnLayerChange?"alphaFade":d.animationOnLayerChange);g.setAnimationDuration(this._tmap.getAnimationDuration());this._tmap.addLayer(g);d.areaDataLayer&&
this.ParseDataLayers([d.areaDataLayer],g,!0);d.pointDataLayers&&this.ParseDataLayers(d.pointDataLayers,g,!1)}}};
DvtThematicMapJsonParser.prototype.ParseDataLayers=function(a,b,c){if(a)for(var d=0;d<a.length;d++){var e=this._tmap.Defaults.calcDataLayerOptions(a[d]);b?b instanceof DvtMapAreaLayer&&b.resetRenderedAreas():(b=new DvtMapLayer(this._tmap,this._tmap.getEventHandler()),this._tmap.addPointLayer(b));var g=new DvtMapDataLayer(this._tmap,b,e.id,this._tmap.getEventHandler()),h=e.selection;"single"==h?g.setSelectionMode(DvtSelectionHandler.TYPE_SINGLE):"multiple"==h&&g.setSelectionMode(DvtSelectionHandler.TYPE_MULTIPLE);
g.setAnimation("auto"==e.animationOnDataChange?"alphaFade":e.animationOnDataChange);g.setAnimationDuration(this._tmap.getAnimationDuration());var k=null;b instanceof DvtMapAreaLayer&&(k=e.isolatedItem);var m=e.disclosedItems,h=[],n,o=e.areas;if(o)for(var s=0;s<o.length;s++){var t=o[s].location;if(k)if(k!=o[s].id)continue;else n=t;m&&-1!=m.indexOf(o[s].id)&&h.push(t);if(t=this._parseMapArea(b,g,o[s])){if(g.isSelectable()){var u=t.getDisplayable();u.setSelectable(!0)}g.addAreaObject(t)}}if(m=e.markers)for(s=
0;s<m.length;s++){t=m[s].location;if(c&&k)if(k!=m[s].id)continue;else n=t;if(t=this._parseMapMarker(b,g,m[s],c))g.isSelectable()&&(u=t.getDisplayable(),u.setSelectable(!0)),g.addDataObject(t)}n&&(g.setIsolatedAreaRowKey(k),b.setIsolatedArea(n));(e=e.selectedItems)&&0<e.length&&g.setInitialSelections(e);h&&0<h.length&&this._tmap.addDrilledLayer(b.getLayerName(),[g.getClientId(),h]);b.addDataLayer(g)}};
DvtThematicMapJsonParser.prototype.ParseStyles=function(a){this._areaLayerStyle=new DvtCSSStyle(a.areaStyle+a.labelStyle);this._tmap.setComponentStyle(new DvtCSSStyle("fill-type:solid;background-color:"+a.backgroundColor));this._tmap.setStyleDefaults(a)};DvtThematicMapJsonParser.prototype.ParseCustomBasemap=function(a){for(var a=a.getChildNodes(),b,c,d=0;d<a.length;d++)b=a[d],c=b.getName(),c==DvtThematicMapParser._ELEM_LAYER?this._parseCustomLayer(b):c==DvtThematicMapParser._ELEM_POINTS&&this._parseCustomPoints(b)};
DvtThematicMapJsonParser.prototype._parseCustomLayer=function(a){for(var b=a.getChildNodes(),a=a.getAttr(DvtThematicMapParser.ATTR_ID),c,d,e=[],g=0;g<b.length;g++)if(c=b[g],d=c.getName(),d==DvtThematicMapParser.ELEM_IMAGE){d={};d.source=c.getAttr("source");d.width=c.getAttr("width");d.height=c.getAttr("height");var h=c.getAttr("bidi");c=c.getAttr("dir");d.dir="true"==h||"rtl"==c?"rtl":"ltr";e.push(d)}this._customAreaLayerImages[a]=e};
DvtThematicMapJsonParser.prototype._parseCustomPoints=function(a){for(var a=a.getChildNodes(),b,c,d={},e={},g=0;g<a.length;g++)b=a[g],c=b.getName(),c==DvtThematicMapParser._ELEM_POINT&&(d[b.getAttr("name")]=[b.getAttr("x"),b.getAttr("y")],e[b.getAttr("name")]=[null,b.getAttr("longLabel")]);DvtBaseMapManager.registerBaseMapLayer(this._tmap.getMapName(),"cities",e,d,null,null,1)};
DvtThematicMapJsonParser.prototype._createPathShapes=function(a){var b={},c=this._tmap.getCtx(),d;for(d in a)b[d]=new DvtPath(c),this._styleDisplayable(this._areaLayerStyle,b[d]);return b};
DvtThematicMapJsonParser.prototype._parseMapArea=function(a,b,c){var d=c.location;if(a.getAreaShape(d)&&c.color){a.setAreaRendered(d,!1);var e=this._tmap.getCtx(),g=new DvtDrillablePath(e,this._tmap.supportsVectorEffects()),c=DvtJSONUtils.merge(c,this._tmap.getStyleDefaults().dataAreaDefaults);c.labelStyle||(c.labelStyle=this._tmap.getStyleDefaults().labelStyle);var h=new DvtSolidStroke(c.hoverColor,1,DvtDrillablePath.HOVER_STROKE_WIDTH),k=new DvtSolidStroke(c.selectedInnerColor,1,DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH),
m=new DvtSolidStroke(c.selectedOuterColor,1,DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH);g.setHoverStroke(h,null).setSelectedStroke(k,m);h=new DvtSolidStroke(c.drilledInnerColor,1,DvtDrillablePath.DISCLOSED_INNER_STROKE_WIDTH);k=new DvtSolidStroke(c.drilledOuterColor,1,DvtDrillablePath.DISCLOSED_OUTER_STROKE_WIDTH);g.setDisclosedStroke(h,k);d=new DvtMapDataArea(e,b,c.id,c.clientId,d);d.setDisplayable(g);this._parseCommonData(a,b,c,g,d,!0);return d}return null};
DvtThematicMapJsonParser.prototype._parseMapMarker=function(a,b,c,d){var e=this._getCenter(a.getLayerName(),c,d);if(!e)return null;var g=this._tmap.getCtx();dataObj=new DvtMapDataMarker(g,b,c.id,c.clientId,c.location);dataObj.setCenter(e);var c=DvtJSONUtils.merge(c,this._tmap.getStyleDefaults().dataMarkerDefaults),h;(h=c.source)?h=[h,c.sourceSelected,c.sourceHover,c.sourceHoverSelected]:(h=c.shape,h||(h=DvtMapDataMarker.DEFAULT_MARKER_SHAPE));var k=c.scaleX;isNaN(k)&&(k=DvtMapDataMarker.DEFAULT_MARKER_SCALE);
var m=c.scaleY;isNaN(m)&&(m=DvtMapDataMarker.DEFAULT_MARKER_SCALE);var n=c.width,o=c.height;if(!n||isNaN(n))n=DvtMapDataMarker.DEFAULT_MARKER_SIZE;if(!o||isNaN(o))o=DvtMapDataMarker.DEFAULT_MARKER_SIZE;marker=new DvtMarker(g,h,"alta",e.x-n*k/2,e.y-o*m/2,n,o,null,k,m);dataObj.setDisplayable(marker);dataObj.setSize(n*k*o*m);dataObj.setLabelPosition(c.labelPosition);if(e=c.rotation)g=e*Math.PI/180,marker.setRotation(g),e=dataObj.getCenter(),marker.setTranslate(e.x-(e.x*Math.cos(g)-e.y*Math.sin(g)),e.y-
(e.x*Math.sin(g)+e.y*Math.cos(g)));this._parseCommonData(a,b,c,marker,dataObj,d);return dataObj};
DvtThematicMapJsonParser.prototype._parseCommonData=function(a,b,c,d,e,g){var h=c.location;g&&"auto"==a.getLabelDisplay()&&a.setLabelRendered(h,!1);c.action&&(e.setHasAction(!0),e.setAction(c.action));if(h=c.destination){var k=[];k.destination=h;k.targetFrame="_blank";k.focusable=!0;d.setHyperlink(k)}this._setDatatip(a,b,c,e,g);h=new DvtCSSStyle;h.setStyle("background-color",c.color);h.setStyle("pattern",c.pattern);h.setStyle("border-color",c.borderColor);h.setStyle("border-style",c.borderStyle);
c.borderWidth&&h.setStyle("border-width",c.borderWidth);h.setStyle("opacity",c.opacity);this._styleDisplayable(h,d,e);this._setLabel(a,b,c,e,g)};
DvtThematicMapJsonParser.prototype._setLabel=function(a,b,c,d,e){var g=c.location,h=c.label,k=h?"on":"off";e&&(k=a.getLabelDisplay());!h&&d instanceof DvtMapDataArea&&"off"!=k&&(h="long"==a.getLabelType()?a.getLongAreaName(g):a.getShortAreaName(g));if(h){var m=this._tmap.getCtx(),m=d instanceof DvtMapDataMarker?new DvtOutputText(m,h,0,0):new DvtMapLabel(m,h,a.getLabelInfoForArea?a.getLabelInfoForArea(g):null,k,b.getDataLabelContainer(),this._tmap.supportsVectorEffects()),a=new DvtCSSStyle(c.labelStyle);
m instanceof DvtMapLabel&&(a.getStyle(DvtCSSStyle.COLOR)||a.setStyle(DvtCSSStyle.COLOR,DvtColorUtils.getContrastingTextColor(d.getDatatipColor())));m.setCSSStyle(a)}d.setLabel(m)};
DvtThematicMapJsonParser.prototype._setDatatip=function(a,b,c,d,e){var g=this._tmap.getDisplayTooltips();if("none"!=g){b=c.shortDesc;if("auto"==g){var h;(c=c.location)&&(h=!e||this._isCustomBasemap?DvtBaseMapManager.getCityLabel(this._tmap.getMapName(),c):DvtBaseMapManager.getLongAreaLabel(this._tmap.getMapName(),a.getLayerName(),c));h&&(b=b?h+": "+b:h)}b&&d.setDatatip(b)}};
DvtThematicMapJsonParser.prototype._styleDisplayable=function(a,b,c){a||(a={});var d=a.getStyle("pattern"),e=a.getStyle("background-color");c&&c.setDatatipColor(e);if(b instanceof DvtMarker&&DvtMarker.isBuiltInShape(b.getType())){"none"!=a.getStyle("border-style")&&(c=new DvtSolidStroke(a.getStyle("border-color"),DvtMapDataMarker.DEFAULT_MARKER_ALPHA,a.getStyle("border-width")),this._tmap.isMarkerZoomBehaviorFixed()||c.setFixedWidth(!0),b.setStroke(c));var g=a.getStyle("opacity");!1=="true"&&e?b.setFill(new DvtMarkerGradient.createMarkerGradient(e,
b,g)):d?b.setFill(new DvtPatternFill(d,e,"#FFFFFF")):e?b.setSolidFill(e,g):b.setSolidFill(a.getStyle("background-color"),g)}else if(b instanceof DvtPath){if((a=a.getStyle("border-color"))&&"transparent"!=a)c=new DvtSolidStroke(a),this._tmap.supportsVectorEffects()&&c.setFixedWidth(!0),b.setStroke(c);d?b.savePatternFill(new DvtPatternFill(d,e,"#FFFFFF")):"transparent"!=e?b.setSolidFill(e,g):b.setFill(null)}};
DvtThematicMapJsonParser.prototype._getCenter=function(a,b,c){var d=this._tmap.getMapName(),e=b.location;return e?c?DvtBaseMapManager.getAreaCenter(d,a,e):DvtBaseMapManager.getCityCoordinates(d,e):DvtThematicMapProjections.project(b.x,b.y,this._tmap.getMapName())};var DvtThematicMapProjections={};DvtObj.createSubclass(DvtThematicMapProjections,DvtObj,"DvtThematicMapProjections");DvtThematicMapProjections._VIEWPORT_BOUNDS=new DvtRectangle(0,0,800,500);DvtThematicMapProjections._RADIUS=6378206.4;
DvtThematicMapProjections._NEW_ZEALAND_RECT=new DvtRectangle(500,200,200,200);DvtThematicMapProjections._NEW_ZEALAND_BOUNDS=new DvtRectangle(163,-49,17,17);DvtThematicMapProjections._AFRICA_BOUNDS=new DvtRectangle(-17.379205428479874,-37.201510854305546,68.66391442808313,77.50071544582713);DvtThematicMapProjections._ASIA_BOUNDS=new DvtRectangle(-0.8436866097568272,-0.7626456732012923,1.8336308036296942,1.5748427214611724);
DvtThematicMapProjections._AUSTRALIA_BOUNDS=new DvtRectangle(113.29667079927977,-52.89550592498755,65.25257389065216,42.123114617504626);DvtThematicMapProjections._EUROPE_BOUNDS=new DvtRectangle(-0.47944476148667076,-0.0014669405958800579,0.7364925893845453,0.6293972741802124);DvtThematicMapProjections._N_AMERICA_BOUNDS=new DvtRectangle(-0.6154469465354344,-0.24589767758847714,1.2448236795108683,1.2631535127174947);
DvtThematicMapProjections._S_AMERICA_BOUNDS=new DvtRectangle(-80.60817722658722,-60.796273249672765,46.608687602908056,66.96595767361796);DvtThematicMapProjections._APAC_BOUNDS=new DvtRectangle(68.20516856593524,-52.89892708045518,111.65739821771903,116.55460214469134);DvtThematicMapProjections._EMEA_BOUNDS=new DvtRectangle(-24.543831069368586,-37.202500659225905,204.54283106936856,164.9634493690208);
DvtThematicMapProjections._L_AMERICA_BOUNDS=new DvtRectangle(-117.12451221229134,-54.95921623126266,82.33223251442891,87.67786623127876);DvtThematicMapProjections._USA_CANADA_BOUNDS=new DvtRectangle(-0.6154656300926513,0.0507209798775865,1.0153104799231851,0.966537441082997);DvtThematicMapProjections._WORLD_BOUNDS=new DvtRectangle(-171.9,-62.6,349.8,150.8);DvtThematicMapProjections._ALASKA1_RECT=new DvtRectangle(172,51,8,3);DvtThematicMapProjections._ALASKA2_RECT=new DvtRectangle(-180,51,51,21);
DvtThematicMapProjections._HAWAII_RECT=new DvtRectangle(-178.5,18.9,35,11);DvtThematicMapProjections._USA_RECT=new DvtRectangle(-124.8,24.4,58,25.5);DvtThematicMapProjections._ALASKA_BOUNDS=new DvtRectangle(-187.5517578125,59.82610321044922,57.562225341796875,43.83738708496094);DvtThematicMapProjections._HAWAII_BOUNDS=new DvtRectangle(-160.23606872558594,18.91549301147461,5.4374847412109375,3.3189010620117188);DvtThematicMapProjections._USA_BOUNDS=new DvtRectangle(-2386803.25,-1183550.5,4514111,2908402);
DvtThematicMapProjections._HAWAII_WINDOW=new DvtRectangle(165,400,100,100);DvtThematicMapProjections._ALASKA_WINDOW=new DvtRectangle(-75,350,240,150);DvtThematicMapProjections._ROBINSON_COORDINATES=[[1,0],[0.9986,0.0314],[0.9954,0.0629],[0.99,0.0943],[0.9822,0.1258],[0.973,0.1572],[0.96,0.1887],[0.9427,0.2201],[0.9216,0.2515],[0.8962,0.2826],[0.8679,0.3132],[0.835,0.3433],[0.7986,0.3726],[0.7597,0.4008],[0.6732,0.4532],[0.6213,0.4765],[0.5722,0.4951],[0.5322,0.5072]];
DvtThematicMapProjections.project=function(a,b,c){var d;switch(c){case "africa":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._AFRICA_BOUNDS,DvtThematicMapProjections._getMercatorProjection(a,b));break;case "asia":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._ASIA_BOUNDS,DvtThematicMapProjections._getAlbersEqualAreaConicProjection(40,95,20,60,a,b),DvtThematicMapProjections.toRadians(5));break;case "australia":d=DvtThematicMapProjections._getAustraliaProjection(a,
b);break;case "europe":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._EUROPE_BOUNDS,DvtThematicMapProjections._getAlbersEqualAreaConicProjection(35,25,40,65,a,b),DvtThematicMapProjections.toRadians(10));break;case "northAmerica":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._N_AMERICA_BOUNDS,DvtThematicMapProjections._getAlbersEqualAreaConicProjection(23,-96,20,60,a,b));break;case "southAmerica":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._S_AMERICA_BOUNDS,
new DvtPoint(a,b),DvtThematicMapProjections.toRadians(5));break;case "apac":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._APAC_BOUNDS,DvtThematicMapProjections._getMercatorProjection(a,b));break;case "emea":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._EMEA_BOUNDS,DvtThematicMapProjections._getMercatorProjection(a,b));break;case "latinAmerica":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._L_AMERICA_BOUNDS,new DvtPoint(a,
b));break;case "usaAndCanada":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._USA_CANADA_BOUNDS,DvtThematicMapProjections._getAlbersEqualAreaConicProjection(23,-96,20,60,a,b));break;case "worldRegions":d=DvtThematicMapProjections._getWorldProjection(a,b);break;case "usa":d=DvtThematicMapProjections._getUSAProjection(a,b);break;case "world":d=DvtThematicMapProjections._getWorldProjection(a,b)}return d?new DvtPoint(10*d.x,10*d.y):new DvtPoint(a,b)};
DvtThematicMapProjections._getUSAProjection=function(a,b){var c;if(DvtThematicMapProjections._ALASKA1_RECT.containsPoint(a,b)||DvtThematicMapProjections._ALASKA2_RECT.containsPoint(a,b))return c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._ALASKA_BOUNDS,DvtThematicMapProjections._ALASKA_WINDOW),DvtThematicMapProjections._applyAffineTransform(c,DvtThematicMapProjections._getMercatorProjection(a,b));if(DvtThematicMapProjections._HAWAII_RECT.containsPoint(a,b))return c=
DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._HAWAII_BOUNDS,DvtThematicMapProjections._HAWAII_WINDOW),DvtThematicMapProjections._applyAffineTransform(c,new DvtPoint(a,b));return DvtThematicMapProjections._USA_RECT.containsPoint(a,b)?(c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._USA_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS),DvtThematicMapProjections._applyAffineTransform(c,DvtThematicMapProjections._getOrthographicProjection(new DvtPoint(-95,
36),a,b))):new DvtPoint(a,b)};DvtThematicMapProjections._getWorldProjection=function(a,b){var c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._WORLD_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS);return DvtThematicMapProjections._applyAffineTransform(c,DvtThematicMapProjections._getRobinsonProjection(a,b))};
DvtThematicMapProjections._getAustraliaProjection=function(a,b){var c;c=DvtThematicMapProjections._NEW_ZEALAND_BOUNDS.containsPoint(a,b)?DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._NEW_ZEALAND_BOUNDS,DvtThematicMapProjections._NEW_ZEALAND_RECT):DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._AUSTRALIA_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS);return DvtThematicMapProjections._applyAffineTransform(c,DvtThematicMapProjections._getMercatorProjection(a,
b))};DvtThematicMapProjections._getAffineProjection=function(a,b,c){a=DvtThematicMapProjections._getViewPortTransformation(a,DvtThematicMapProjections._VIEWPORT_BOUNDS);if(c){var d=new DvtMatrix;d.rotate(c);a=DvtThematicMapProjections._concatAffineTransforms(a,d)}return a.transformPoint(b)};
DvtThematicMapProjections._getAlbersEqualAreaConicProjection=function(a,b,c,d,e,g){var b=DvtThematicMapProjections.toRadians(b),h=DvtThematicMapProjections.toRadians(a),c=DvtThematicMapProjections.toRadians(c),d=DvtThematicMapProjections.toRadians(d),d=0.5*(Math.sin(c)+Math.sin(d)),a=Math.pow(Math.cos(c),2)+2*d*Math.sin(c),c=a-2*d*Math.sin(h),c=Math.sqrt(c)/d,e=DvtThematicMapProjections.toRadians(e),g=DvtThematicMapProjections.toRadians(g),b=d*(e-b),g=a-2*d*Math.sin(g),g=Math.sqrt(g)/d,d=g*Math.sin(b),
g=c-g*Math.cos(b);return new DvtPoint(d,g)};DvtThematicMapProjections._getMercatorProjection=function(a,b){var c=Math.log(Math.tan(0.25*Math.PI+0.5*DvtThematicMapProjections.toRadians(b)));return new DvtPoint(a,DvtThematicMapProjections.toDegrees(c))};
DvtThematicMapProjections._getOrthographicProjection=function(a,b,c){var b=DvtThematicMapProjections.toRadians(b),c=DvtThematicMapProjections.toRadians(c),d=DvtThematicMapProjections.toRadians(a.x),e=DvtThematicMapProjections.toRadians(a.y),a=Math.cos(c)*Math.sin(b-d),b=Math.cos(e)*Math.sin(c)-Math.sin(e)*Math.cos(c)*Math.cos(b-d);return new DvtPoint(a*DvtThematicMapProjections._RADIUS,b*DvtThematicMapProjections._RADIUS)};
DvtThematicMapProjections._getRobinsonProjection=function(a,b){var c=Math.floor(Math.abs(b)/5);c>=DvtThematicMapProjections._ROBINSON_COORDINATES.length-1&&(c=DvtThematicMapProjections._ROBINSON_COORDINATES.length-2);var d=(Math.abs(b)-5*c)/5,e=a*(DvtThematicMapProjections._ROBINSON_COORDINATES[c][0]+d*(DvtThematicMapProjections._ROBINSON_COORDINATES[c+1][0]-DvtThematicMapProjections._ROBINSON_COORDINATES[c][0])),c=DvtThematicMapProjections._ROBINSON_COORDINATES[c][1]+d*(DvtThematicMapProjections._ROBINSON_COORDINATES[c+
1][1]-DvtThematicMapProjections._ROBINSON_COORDINATES[c][1]);0>b&&(c*=-1);return new DvtPoint(e,180*c)};DvtThematicMapProjections._applyAffineTransform=function(a,b){return new DvtPoint(b.x*a.getA()+a.getTx(),b.y*a.getD()+a.getTy())};DvtThematicMapProjections._concatAffineTransforms=function(a,b){var c=a.getA(),d=b.getA()*c,e=b.getB()*c,c=a.getTx()+b.getTx()*c,g=a.getD(),h=b.getC()*g,k=b.getD()*g,g=a.getTy()+b.getTy()*g;return new DvtMatrix(d,e,h,k,c,g)};
DvtThematicMapProjections._getViewPortTransformation=function(a,b){var c=b.x,d=b.y,e=a.w,g=a.h,h=0,h=b.w/e,k=b.h/g,h=h<=k?h:k,c=c-a.x*h,d=d+a.y*h,c=c+(b.w-e*h)/2,d=d+(b.h-(b.h-g*h)/2);return new DvtMatrix(h,0,0,-h,c,d)};DvtThematicMapProjections.toRadians=function(a){return a*(Math.PI/180)};DvtThematicMapProjections.toDegrees=function(a){return a*(180/Math.PI)};
DvtThematicMapProjections.inverseProject=function(a,b,c){var d,a=a/10,b=b/10;switch(c){case "africa":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._AFRICA_BOUNDS,new DvtPoint(a,b));d=DvtThematicMapProjections._getInverseMercatorProjection(d.x,d.y);break;case "asia":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._ASIA_BOUNDS,new DvtPoint(a,b),DvtThematicMapProjections.toRadians(5));d=DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection(40,
95,20,60,d.x,d.y);break;case "australia":d=DvtThematicMapProjections._getInverseAustraliaProjection(a,b);break;case "europe":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._EUROPE_BOUNDS,new DvtPoint(a,b),DvtThematicMapProjections.toRadians(10));d=DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection(35,25,40,65,d.x,d.y);break;case "northAmerica":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._N_AMERICA_BOUNDS,new DvtPoint(a,
b));d=DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection(23,-96,20,60,d.x,d.y);break;case "southAmerica":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._S_AMERICA_BOUNDS,new DvtPoint(a,b),DvtThematicMapProjections.toRadians(5));break;case "apac":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._APAC_BOUNDS,new DvtPoint(a,b));d=DvtThematicMapProjections._getInverseMercatorProjection(d.x,d.y);break;case "emea":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._EMEA_BOUNDS,
new DvtPoint(a,b));d=DvtThematicMapProjections._getInverseMercatorProjection(d.x,d.y);break;case "latinAmerica":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._L_AMERICA_BOUNDS,new DvtPoint(a,b));break;case "usaAndCanada":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._USA_CANADA_BOUNDS,new DvtPoint(a,b));d=DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection(23,-96,20,60,d.x,d.y);break;case "worldRegions":d=DvtThematicMapProjections._getInverseWorldProjection(a,
b);break;case "usa":d=DvtThematicMapProjections._getInverseUSAProjection(a,b);break;case "world":d=DvtThematicMapProjections._getInverseWorldProjection(a,b)}return d?d:new DvtPoint(a,b)};
DvtThematicMapProjections._getInverseUSAProjection=function(a,b){var c;if(DvtThematicMapProjections._ALASKA_WINDOW.containsPoint(a,b))return c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._ALASKA_BOUNDS,DvtThematicMapProjections._ALASKA_WINDOW),c.invert(),c=c.transformPoint(new DvtPoint(a,b)),DvtThematicMapProjections._getInverseMercatorProjection(c.x,c.y);if(DvtThematicMapProjections._HAWAII_WINDOW.containsPoint(a,b))return c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._HAWAII_BOUNDS,
DvtThematicMapProjections._HAWAII_WINDOW),c.invert(),c.transformPoint(new DvtPoint(a,b));return DvtThematicMapProjections._VIEWPORT_BOUNDS.containsPoint(a,b)?(c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._USA_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS),c.invert(),c=c.transformPoint(new DvtPoint(a,b)),DvtThematicMapProjections._getInverseOrthographicProjection(new DvtPoint(-95,36),c.x,c.y)):new DvtPoint(a,b)};
DvtThematicMapProjections._getInverseWorldProjection=function(a,b){var c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._WORLD_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS);c.invert();c=c.transformPoint(new DvtPoint(a,b));return DvtThematicMapProjections._getInverseRobinsonProjection(c.x,c.y)};
DvtThematicMapProjections._getInverseAustraliaProjection=function(a,b){var c;c=DvtThematicMapProjections._NEW_ZEALAND_RECT.containsPoint(a,b)?DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._NEW_ZEALAND_BOUNDS,DvtThematicMapProjections._NEW_ZEALAND_RECT):DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._AUSTRALIA_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS);c.invert();c=c.transformPoint(new DvtPoint(a,b));return DvtThematicMapProjections._getInverseMercatorProjection(c.x,
c.y)};DvtThematicMapProjections._getInverseAffineProjection=function(a,b,c){a=DvtThematicMapProjections._getViewPortTransformation(a,DvtThematicMapProjections._VIEWPORT_BOUNDS);if(c){var d=new DvtMatrix;d.rotate(c);a=DvtThematicMapProjections._concatAffineTransforms(a,d)}a.invert();return a.transformPoint(b)};
DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection=function(a,b,c,d,e,g){var b=DvtThematicMapProjections.toRadians(b),a=DvtThematicMapProjections.toRadians(a),c=DvtThematicMapProjections.toRadians(c),d=DvtThematicMapProjections.toRadians(d),d=0.5*(Math.sin(c)+Math.sin(d)),c=Math.pow(Math.cos(c),2)+2*d*Math.sin(c),h=c-2*d*Math.sin(a),h=Math.sqrt(h)/d,a=Math.sqrt(e*e+(h-g)*(h-g)),e=Math.atan(e/(h-g)),g=Math.asin((c-a*a*d*d)/(2*d));return new DvtPoint(DvtThematicMapProjections.toDegrees(b+
e/d),DvtThematicMapProjections.toDegrees(g))};DvtThematicMapProjections._getInverseMercatorProjection=function(a,b){var c=2*Math.atan(Math.exp(DvtThematicMapProjections.toRadians(b)))-0.5*Math.PI;return new DvtPoint(a,DvtThematicMapProjections.toDegrees(c))};
DvtThematicMapProjections._getInverseOrthographicProjection=function(a,b,c){var b=b/DvtThematicMapProjections._RADIUS,c=c/DvtThematicMapProjections._RADIUS,d=DvtThematicMapProjections.toRadians(a.x),e=DvtThematicMapProjections.toRadians(a.y),g=Math.sqrt(b*b+c*c),h=Math.asin(g),a=Math.asin(Math.cos(h)*Math.sin(e)+c*Math.sin(h)*Math.cos(e)/g),b=d+Math.atan(b*Math.sin(h)/(g*Math.cos(e)*Math.cos(h)-c*Math.sin(e)*Math.sin(h)));return new DvtPoint(DvtThematicMapProjections.toDegrees(b),DvtThematicMapProjections.toDegrees(a))};
DvtThematicMapProjections._getInverseRobinsonProjection=function(a,b){var c=Math.floor(Math.abs(b)/5);c>=DvtThematicMapProjections._ROBINSON_COORDINATES.length-1&&(c=DvtThematicMapProjections._ROBINSON_COORDINATES.length-2);var d=DvtThematicMapProjections._ROBINSON_COORDINATES[c+1][0]-DvtThematicMapProjections._ROBINSON_COORDINATES[c][0],e=DvtThematicMapProjections._ROBINSON_COORDINATES[c+1][1]-DvtThematicMapProjections._ROBINSON_COORDINATES[c][1],g=(Math.abs(b/180)-DvtThematicMapProjections._ROBINSON_COORDINATES[c][1])/
e,e=5*g+5*c,c=a/(DvtThematicMapProjections._ROBINSON_COORDINATES[c][0]+g*d);0>b&&(e*=-1);return new DvtPoint(c,e)};var DvtMapControlButton=function(a,b,c,d,e,g,h){this.Init(a,b,c,d,e,g,h)};DvtObj.createSubclass(DvtMapControlButton,DvtBasePanZoomControl,"DvtMapControlButton");DvtMapControlButton.BUTTON_TYPE_DRILLUP=0;DvtMapControlButton.BUTTON_TYPE_DRILLDOWN=1;DvtMapControlButton.BUTTON_TYPE_RESET=2;
DvtMapControlButton.prototype.Init=function(a,b,c,d,e,g,h){DvtMapControlButton.superclass.Init.call(this,a,d,g);this._btype=e;this._button=b;this._eventManager=h;this._button.setCallback(this.HandleOnClick,this);this._button.setCursor(DvtSelectionEffectUtils.getSelectingCursor());this._eventManager.associate(this._button,new DvtPanZoomControlPanelEventHandlerProxy(this,null,null,null,null,null,this._getTooltipText()));this.addChild(this._button);this._mapCallback=c;this._isEnabled=!0};
DvtMapControlButton.prototype.setEnabled=function(a){this.setAlpha(a?1:0.4);this._button.setCursor(a?DvtSelectionEffectUtils.getSelectingCursor():null);this._isEnabled=a;this._button.setEnabled(a);this._button.initState()};DvtMapControlButton.prototype.HandleOnClick=function(a){DvtEventManager.consumeEvent(a);this._isEnabled&&this._mapCallback&&this._mapCallback()};
DvtMapControlButton.prototype._getTooltipText=function(){return this._btype==DvtMapControlButton.BUTTON_TYPE_DRILLUP?this.getResources().getControlPanelDrillUpTooltip():this._btype==DvtMapControlButton.BUTTON_TYPE_DRILLDOWN?this.getResources().getControlPanelDrillDownTooltip():this._btype==DvtMapControlButton.BUTTON_TYPE_RESET?this.getResources().getControlPanelResetTooltip():null};var DvtThematicMapControlPanel=function(a,b,c,d,e,g,h,k){this.Init(a,b,c,d,e,g,h,k)};
DvtObj.createSubclass(DvtThematicMapControlPanel,DvtPanZoomControlPanel,"DvtThematicMapControlPanel");
DvtThematicMapControlPanel.prototype.Init=function(a,b,c,d,e,g,h,k){DvtThematicMapControlPanel.superclass.Init.call(this,a,e,c,g,h,k);this.setResources(new DvtThematicMapControlPanelResources(g));this._drillMode=b;this._buttonImages=c;this._drillUpCallback=d[0];this._drillDownCallback=d[1];this._resetCallback=d[2];this._drillDownButton=this._drillUpButton=this._resetButton=null;this._drillUpButtonEnabled=this._drillDownButtonEnabled=!1;this._styleMap=k.getControlPanelStyleMap()};
DvtThematicMapControlPanel.prototype.setEnabledDrillDownButton=function(a){this._drillDownButtonEnabled=a;this._drillDownButton&&this._drillDownButton.setEnabled(a)};DvtThematicMapControlPanel.prototype.setEnabledDrillUpButton=function(a){this._drillUpButtonEnabled=a;this._drillUpButton&&this._drillUpButton.setEnabled(a)};
DvtThematicMapControlPanel.prototype.setResources=function(a){DvtThematicMapControlPanel.superclass.setResources.call(this,a);this._drillDownButton&&this._drillDownButton.setResources(a);this._drillUpButton&&this._drillUpButton.setResources(a);this._resetButton&&this._resetButton.setResources(a)};
DvtThematicMapControlPanel.prototype.PopulateHorzContentBar=function(a){if(this._drillMode&&"none"!=this._drillMode){var b=DvtStyleUtils.getStyle(this._styleMap,DvtPanZoomControlPanel.CP_BUTTON_WIDTH,0);this._resetButton=DvtButtonLAFUtils.createResetButton(this.getCtx(),this._resetCallback,this._panZoomCanvas,DvtMapControlButton.BUTTON_TYPE_RESET,this.getResources(),this._buttonImages,this._eventManager,this._styleMap);a.addChild(this._resetButton);this._drillDownButton=DvtButtonLAFUtils.createDrillDownButton(this.getCtx(),
this._drillDownCallback,this._panZoomCanvas,DvtMapControlButton.BUTTON_TYPE_DRILLDOWN,this.getResources(),this._buttonImages,this._eventManager,this._styleMap);this._drillDownButton.setTranslateX(b);this._drillDownButton.setEnabled(this._drillDownButtonEnabled);a.addChild(this._drillDownButton);this._drillUpButton=DvtButtonLAFUtils.createDrillUpButton(this.getCtx(),this._drillUpCallback,this._panZoomCanvas,DvtMapControlButton.BUTTON_TYPE_DRILLUP,this.getResources(),this._buttonImages,this._eventManager,
this._styleMap);this._drillUpButton.setTranslateX(2*b);this._drillUpButton.setEnabled(this._drillUpButtonEnabled);a.addChild(this._drillUpButton)}};var DvtThematicMapControlPanelResources=function(a){this.Init(a)};DvtObj.createSubclass(DvtThematicMapControlPanelResources,DvtPanZoomControlPanelResources,"DvtThematicMapControlPanelResources");
DvtThematicMapControlPanelResources.prototype.Init=function(a){DvtThematicMapControlPanelResources.superclass.Init.call(this,a);a?(this._controlPanelDrillUpTooltip=a.getAttr("pdu"),this._controlPanelDrillDownTooltip=a.getAttr("pdd"),this._controlPanelResetTooltip=a.getAttr("res")):(this._controlPanelDrillUpTooltip="Show Control Panel (/)",this._controlPanelDrillDownTooltip="Hide (/)",this._controlPanelResetTooltip="Zoom and Center (Ctrl+Alt+0)")};
DvtThematicMapControlPanelResources.prototype.getControlPanelDrillUpTooltip=function(){return this._controlPanelDrillUpTooltip};DvtThematicMapControlPanelResources.prototype.setPanControlDrillUpTooltip=function(a){this._controlPanelDrillUpTooltip=a};DvtThematicMapControlPanelResources.prototype.getControlPanelDrillDownTooltip=function(){return this._controlPanelDrillDownTooltip};
DvtThematicMapControlPanelResources.prototype.setPanControlDrillDownTooltip=function(a){this._controlPanelDrillDownTooltip=a};DvtThematicMapControlPanelResources.prototype.getControlPanelResetTooltip=function(){return this._controlPanelResetTooltip};DvtThematicMapControlPanelResources.prototype.setPanControlResetTooltip=function(a){this._controlPanelResetTooltip=a};